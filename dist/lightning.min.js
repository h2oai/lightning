(function(){var n,t,e,i,r,o,u,a,s,c,l,h,f,d,g,v,p,m,w,b,y,k,x,C,q,S,W,O,T,E,N,Y,X,A,M,P,I,F,j,z,R,B,L,V,D,G,H,U,J,K,Q,Z,nt,tt,et,it,rt,ot,ut,at,st,ct,lt,ht,ft,dt,gt,vt,pt,mt,wt,bt,yt,_t,kt,xt,Ct,qt,St,Wt,Ot,Tt,Et,Nt,Yt,Xt,At,Mt,Pt,It,Ft,jt,zt,Rt,Bt,Lt,Vt,Dt,Gt,Ht,Ut,$t,Jt,Kt,Qt,Zt,ne,te,ee,ie,re,oe,ue,ae,se,ce,le,he,fe,de,ge,ve,pe,me,we,be,ye,_e,ke,xe,Ce,qe,Se,We,Oe,Te,Ee,Ne,Ye,Xe,Ae,Me,Pe,Ie,Fe,je,ze,Re,Be,Le,Ve,De,Ge,He,Ue,$e,Je,Ke,Qe,Ze,ni,ti,ei,ii,ri,oi,ui,ai,si,ci,li,hi,fi,di,gi,vi,pi,mi,wi,bi,yi,_i,ki,xi,Ci,qi,Si,Wi,Oi,Ti,Ei,Ni,Yi,Xi,Ai,Mi,Pi,Ii,Fi,ji,zi,Ri,Bi,Li,Vi,Di,Gi,Hi,Ui,$i,Ji,Ki,Qi,Zi,nr,tr,er,ir,rr,or,ur,ar,sr,cr,lr,hr,fr,dr,gr,vr,pr,mr,wr,br,yr,_r,kr,xr,Cr,qr,Sr,Wr,Or,Tr,Er,Nr,Yr,Xr,Ar,Mr,Pr,Ir,Fr,jr,zr,Rr,Br,Lr,Vr,Dr,Gr,Hr,Ur,$r,Jr,Kr,Qr,Zr,no,to,eo,io,ro,oo,uo,ao,so,co,lo,ho,fo,go,vo,po,mo,wo,bo,yo,_o,ko,xo,Co,qo,So,Wo,Oo,To,Eo,No,Yo,Xo,Ao,Mo,Po,Io,Fo,jo,zo,Ro,Bo,Lo,Vo,Do,Go,Ho,Uo,$o,Jo,Ko,Qo,Zo,nu,tu,eu,iu,ru,ou,uu,au,su,cu,lu,hu,fu,du,gu,vu,pu,mu,wu,bu,yu,_u,ku,xu,Cu,qu,Su,Wu,Ou,Tu,Eu,Nu,Yu,Xu,Au,Mu,Pu,Iu,Fu,ju,zu,Ru,Bu,Lu,Vu,Du,Gu,Hu,Uu=[].slice,$u=function(n,t){function e(){this.constructor=n}for(var i in t)Ju.call(t,i)&&(n[i]=t[i]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n},Ju={}.hasOwnProperty;Ru=Math.PI,Bu=2*Ru,it=Ru/2,zu=1e-6,V=zu*zu,Xt=Ru/180,F=180/Ru,Ce=Math.tan(30*Xt),ue=Math.sqrt(3),y=16581375,We="transparent",ke="undefined",me="null",de="Boolean",_e="String",we="Number",pe="Function",be="Object",fe="Array",he="Arguments",ge="Date",ye="RegExp",ve="Error",Fu=function(n){var t;if(t=Object.prototype.toString.call(n),null===n)return me;if(void 0===n)return ke;if(n===!0||n===!1||"[object Boolean]"===t)return de;switch(t){case"[object String]":return _e;case"[object Number]":return we;case"[object Function]":return pe;case"[object Object]":return be;case"[object Array]":return fe;case"[object Arguments]":return he;case"[object Date]":return ge;case"[object RegExp]":return ye;case"[object Error]":return ve;default:return t}},mt=function(){function n(n,t){this.match=n,this.func=t}return n}(),tr=function(){var n,t;return n=function(t){var e,i,r;switch(i=Fu(t)){case ke:return function(n){return void 0===n};case me:return function(n){return null===n};case de:return function(n){return t===Boolean||n===t};case _e:return function(n){return t===String||n===t};case we:return function(n){return t===Number||n===t||_.isNaN(n)&&_.isNaN(t)};case ye:return function(){return t===RegExp};case Error:return function(){return t===Error};case ge:return function(n){return t===Date||n===t};case fe:return 1===t.length&&pe===(r=Fu(t[0]))?(e=n(t[0]),function(n){var t,i,r;if(fe!==Fu(n))return!1;for(i=0,r=n.length;r>i;i++)if(t=n[i],!e(t))return!1;return!0}):function(n){return t===Array||Ke(t,n)};case pe:return function(n){var e;return n instanceof t?!0:n&&n.constructor===t?!0:(e=Fu(n),t===Boolean&&e===de||t===String&&e===_e||t===Number&&e===we)};case be:return function(n){var e,i;for(e in t)if(i=t[e],n[e]!==i)return!1;return!0};default:return function(){return!1}}},t=function(t){var e;return e=_.map(t,n),function(n){var t,i,r,o;if(0===n.length)return!1;if(n.length!==e.length)return!1;for(i=r=0,o=e.length;o>r;i=++r)if(t=e[i],!t(n[i]))return!1;return!0}},function(){var n,e;return n=1<=arguments.length?Uu.call(arguments,0):[],e=_.map(n,function(n){var e,i,r;return i=2<=n.length?Uu.call(n,0,r=n.length-1):(r=0,[]),e=n[r++],new mt(t(i),e)}),function(){var n,t,i,r;for(n=1<=arguments.length?Uu.call(arguments,0):[],i=0,r=e.length;r>i;i++)if(t=e[i],t.match(n))return t.func.apply(null,n);throw new Error("Pattern match failure for args [ "+_.map(n,function(n){return""+n+":"+Fu(n)}).join(", ")+" ]")}}}(),g=function(){function n(n,t){this.put=n,this.test=t}return n}(),pt=function(){function n(n,t){this.put=n,this.test=t}return n}(),te=function(){function n(n,t){this.width=n,this.height=t}return n}(),Pt=function(){function n(n,t,e,i){this.left=n,this.top=t,this.width=e,this.height=i}return n}(),je=function(){function n(n,t,e,i,r,o,u){this.name=n,this.label=t,this.type=e,this.at=i,this.count=r,this.domain=o,this.format=u}return n}(),G=function(n){function t(n,e,i,r,o,u,a,s){this.valueAt=o,t.__super__.constructor.call(this,n,e,i,r,u,a,s)}return $u(t,n),t}(je),ht=function(n){function t(n,e,i,r,o,u){t.__super__.constructor.call(this,n,e,be,i,r,o,u)}return $u(t,n),t}(je),tt=function(){function n(){}return n}(),Z=function(){function n(n,t,e,i,r,o,u,a,s){this.label=n,this.vectors=t,this.schema=e,this.indices=i,this.cube=r,this.at=o,this.evaluate=u,this.attach=a,this.metadata=s}return n}(),Oe=function(){function n(n){this.value=n}return n}(),wt=function(n){function t(n){t.__super__.constructor.call(this,n)}return $u(t,n),t}(Oe),ae=function(n){function t(n){t.__super__.constructor.call(this,n)}return $u(t,n),t}(Oe),I=function(n){function t(n){t.__super__.constructor.call(this,n)}return $u(t,n),t}(Oe),o=function(n){function t(n){t.__super__.constructor.call(this,n)}return $u(t,n),t}(Oe),U=function(){function n(n){this.name=n}return n}(),ft=function(n){function t(n){this.evaluate=n}return $u(t,n),t}(U),Ft=function(n){function t(n){this.evaluate=n}return $u(t,n),t}(U),J=function(){function n(n,t){this.color=n,this.opacity=t}return n}(),se=function(){function n(n,t,e){this.color=n,this.opacity=t,this.size=e}return n}(),xe=function(){function n(n){this.fields=n}return n}(),Mt=function(){function n(n){this.index=n}return n}(),vt=function(){function n(){}return n}(),St=function(n){function t(n,t,e,i,r,o,u,a){this.position=n,this.shape=t,this.size=e,this.fillColor=i,this.fillOpacity=r,this.strokeColor=o,this.strokeOpacity=u,this.lineWidth=a}return $u(t,n),t}(vt),_t=function(n){function t(n,t,e,i){this.position=n,this.strokeColor=t,this.strokeOpacity=e,this.lineWidth=i}return $u(t,n),t}(vt),zt=function(n){function t(n,t,e,i){this.position=n,this.strokeColor=t,this.strokeOpacity=e,this.lineWidth=i}return $u(t,n),t}(vt),It=function(n){function t(n,t,e,i,r,o,u,a){this.position=n,this.width=t,this.height=e,this.fillColor=i,this.fillOpacity=r,this.strokeColor=o,this.strokeOpacity=u,this.lineWidth=a}return $u(t,n),t}(vt),gt=function(){function n(){}return n}(),Ot=function(n){function t(n,t,e,i,r,o,u,a,s,c){this.space=n,this.positionX=t,this.positionY=e,this.shape=i,this.size=r,this.fillColor=o,this.fillOpacity=u,this.strokeColor=a,this.strokeOpacity=s,this.lineWidth=c,this.geometry=Wt}return $u(t,n),t}(gt),Lt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.space=n,this.q0=t,this.q1=e,this.q2=i,this.q3=r,this.qn=o,this.positionY=u,this.height=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=Bt}return $u(t,n),t}(gt),Gt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.space=n,this.positionX=t,this.q0=e,this.q1=i,this.q2=r,this.q3=o,this.qn=u,this.width=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=Dt}return $u(t,n),t}(gt),m=function(n){function t(n,t,e,i,r,o,u,a,s,c){this.space=n,this.positionX=t,this.positionY1=e,this.positionY2=i,this.width=r,this.fillColor=o,this.fillOpacity=u,this.strokeColor=a,this.strokeOpacity=s,this.lineWidth=c,this.geometry=p}return $u(t,n),t}(gt),r=function(n){function t(n,t,e,r,o,u,a,s,c,l){this.space=n,this.positionX1=t,this.positionX2=e,this.positionY=r,this.height=o,this.fillColor=u,this.fillOpacity=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=i}return $u(t,n),t}(gt),xt=function(n){function t(n,t,e,i,r,o){this.space=n,this.positionX=t,this.positionY=e,this.strokeColor=i,this.strokeOpacity=r,this.lineWidth=o,this.geometry=kt}return $u(t,n),t}(gt),qe=function(n){function t(n,t,e,i,r,o,u){this.space=n,this.positionX=t,this.positionY=e,this.text=i,this.size=r,this.fillColor=o,this.fillOpacity=u,this.geometry=TextGeometry}return $u(t,n),t}(gt),L=function(){function n(){}return n}(),qt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.positionX=n,this.positionY=t,this.shape=e,this.size=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return $u(t,n),t}(L),Rt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.q0=n,this.q1=t,this.q2=e,this.q3=i,this.qn=r,this.positionY=o,this.height=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return $u(t,n),t}(L),Vt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.positionX=n,this.q0=t,this.q1=e,this.q2=i,this.q3=r,this.qn=o,this.width=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return $u(t,n),t}(L),v=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.positionX=n,this.positionY1=t,this.positionY2=e,this.width=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return $u(t,n),t}(L),e=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.positionX1=n,this.positionX2=t,this.positionY=e,this.height=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return $u(t,n),t}(L),yt=function(n){function t(n,t,e,i,r,o){this.positionX=n,this.positionY=t,this.stroke=e,this.strokeColor=i,this.strokeOpacity=r,this.lineWidth=o}return $u(t,n),t}(L),oe=function(){function n(n,t){this.x=n,this.y=t}return n}(),re=function(){function n(n,t,e){this.type=n,this.vectors=t,this.domain=e}return n}(),t=function(){function n(){}return n}(),c=function(n){function t(n,t,e,i,r,o,u){this.type=n,this.label=t,this.scale=e,this.domain=i,this.range=r,this.rect=o,this.guide=u}return $u(t,n),t}(t),lt=function(n){function t(n,t,e,i,r,o,u){this.type=n,this.label=t,this.scale=e,this.domain=i,this.range=r,this.rect=o,this.guide=u}return $u(t,n),t}(t),Se=function(){function n(n,t){this.value=n,this.label=t}return n}(),B=function(){function n(n,t){this.label=n,this.encode=t}return n}(),C=function(n){function t(n){this.value=n,t.__super__.constructor.call(this,"Constant",Je(this.value))}return $u(t,n),t}(B),Te=function(n){function t(n,e,i){this.vector=i,t.__super__.constructor.call(this,n,e)}return $u(t,n),t}(B),Et=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return $u(t,n),t}(Te),b=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return $u(t,n),t}(Te),bt=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return $u(t,n),t}(Te),ie=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return $u(t,n),t}(Te),Qt=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return $u(t,n),t}(Te),d=function(){function n(){}return n}(),w=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),A=function(n){function t(n){this.field=n}return $u(t,n),t}(d),Tt=function(n){function t(n){this.coordinates=n}return $u(t,n),t}(d),K=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),Q=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),ce=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),le=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),ee=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),Le=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),ot=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),ct=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),Kt=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(d),q=function(n){function t(n){this.value=n}return $u(t,n),t}(K),Ee=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(K),S=function(n){function t(n){this.value=n}return $u(t,n),t}(Q),Ne=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(Q),N=function(n){function t(n){this.value=n}return $u(t,n),t}(ce),Pe=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(ce),Y=function(n){function t(n){this.value=n}return $u(t,n),t}(le),Ie=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(le),E=function(n){function t(n){this.value=n}return $u(t,n),t}(ee),Me=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(ee),X=function(n){function t(n){this.value=n}return $u(t,n),t}(Le),Fe=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(Le),W=function(n){function t(n){this.value=n}return $u(t,n),t}(ot),Ye=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(ot),O=function(n){function t(n){this.value=n}return $u(t,n),t}(ct),Xe=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(ct),T=function(n){function t(n){this.value=n}return $u(t,n),t}(Kt),Ae=function(n){function t(n,t){this.field=n,this.range=t}return $u(t,n),t}(Kt),D=function(){function n(n,t){this.min=n,this.max=t}return n}(),At=function(){function n(){}return n}(),l=function(n){function t(n){this.values=n}return $u(t,n),t}(At),Nt=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(At),Jt=function(n){function t(n,t){this.min=n,this.max=t}return $u(t,n),t}(Nt),R=function(n){function t(n,t,e){this.min=n,this.mid=t,this.max=e}return $u(t,n),t}(Nt),x=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return $u(t,n),t}(At),$t=function(n){function t(n,t){this.min=n,this.max=t}return $u(t,n),t}(x),z=function(n){function t(n,t,e){this.min=n,this.mid=t,this.max=e}return $u(t,n),t}(x),nt=function(){function n(n,t,e,i,r){this.encode=n,this.mask=t,this.highlight=e,this.render=i,this.select=r}return n}(),P=function(){function n(n){this.read=n}return n}(),s=function(){function n(n,t,e,i){this.element=n,this.context=t,this.bounds=e,this.ratio=i}return n}(),ze=function(){function n(n,t,e,i,r,o,u,a,s,c,l){this.box=n,this.container=t,this.baseCanvas=e,this.highlightCanvas=i,this.hoverCanvas=r,this.maskCanvas=o,this.clipCanvas=u,this.marquee=a,this.tooltip=s,this.mask=c,this.clip=l}return n}(),at=function(){function n(n,t,e,i,r,o){this.encodings=n,this.encoders=t,this.mask=e,this.highlight=i,this.render=r,this.select=o}return n}(),Re=function(){function n(n,t,e,i,r,o,u,a){this.viewport=n,this.frame=t,this.test=e,this.highlight=i,this.hover=r,this.selectAt=o,this.selectWithin=u,this.render=a}return n}(),Ct=function(){function n(n,t,e){this.element=n,this.subscribe=t,this.unsubscribe=e}return n}(),u=function(){function n(n,t){this.width=n,this.height=t}return n}(),jt=function(){function n(n,t,e,i,r){this.center=n,this.left=t,this.top=e,this.right=i,this.bottom=r}return n}(),dt=function(){function n(n,t,e,i){this.left=n,this.top=t,this.right=e,this.bottom=i}return n}(),a=function(){function n(n,t,e){var i;this.width=n,this.height=t,this.margin=e,this.regions=new jt(i=new Pt(e.left,e.top,n-e.left-e.right,t-e.top-e.bottom),new Pt(0,e.top,e.left,i.height),new Pt(e.left+i.width,e.top,e.right,i.height),new Pt(e.left,0,i.width,e.top),new Pt(e.left,e.top+i.height,i.width,e.bottom))}return n}(),Yt=function(){function n(n,t,e,i){this.select=n,this.where=t,this.group=e,this.having=i}return n}(),h=function(){function n(n,t){this.key=n,this.value=t}return n}(),n=new h(0,"All"),M=function(){function n(n,t,e,i){this.frame=n,this.hierarchy=t,this.cells=e,this.dimension=i}return n}(),st=function(){function n(n,t,e){this.category=n,this.indices=t,this.children=e}return n}(),f=function(){function n(n,t){this.levels=n,this.indices=t}return n}(),H=function(){function n(n,t,e,i,r){this.at=n,this.valueAt=t,this.count=e,this.domain=i,this.format=r}return n}(),et=function(){function n(n){this.fields=n}return n}(),Ut=function(){function n(n,t,e){this.name=n,this.fields=t,this.func=e}return n}(),Be=function(){function n(n,t){this.fields=n,this.predicate=t}return n}(),rt=function(){function n(n,t){this.fields=n,this.predicate=t}return n}(),ut=function(){function n(n,t){this.vectors=n,this.index=t}return n}(),Ht=function(){function n(n,t){this.vectors=n,this.indices=t}return n}(),j=function(){function n(n){this.vectors=n}return n}(),Pu=function(n){return n*n},ei=function(n,t){return function(e){return n>e?n:e>t?t:e}},ti=ei(0,1),nr=8,pi=function(n){return n.slice(0)},Vr=function(n,t){var e,i,r,o,u,a,s,c;for(r=[],o=0,a=n.length;a>o;o++)for(e=n[o],c=t(e),u=0,s=c.length;s>u;u++)i=c[u],r.push(i);return r},fo=function(){var n,t;return t=arguments[0],n=2<=arguments.length?Uu.call(arguments,1):[],function(){return t.apply(null,n)}},Je=function(n){return function(){return n}},Ke=function(n,t){var e,i,r,o;if(n&&t&&n.length===t.length){for(e=r=0,o=n.length;o>r;e=++r)if(i=n[e],i!==t[e])return!1;return!0}return!1},Rr=function(){var n,t,e,i,r,o,u,a,s;for(t=arguments[0],r=2<=arguments.length?Uu.call(arguments,1):[],e=[],o=0,a=t.length;a>o;o++)for(n=t[o],u=0,s=r.length;s>u;u++)i=r[u],n instanceof i&&e.push(n);return e},Lr=function(){var n,t,e,i,r,o,u,a;for(t=arguments[0],i=2<=arguments.length?Uu.call(arguments,1):[],r=0,u=t.length;u>r;r++)for(n=t[r],o=0,a=i.length;a>o;o++)if(e=i[o],n instanceof e)return n},Oi=function(n,t){return t>n?new D(n,t):new D(t,n)},fi=function(n){var t,e,i,r,o;for(e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,r=0,o=n.length;o>r;r++)i=n[r],void 0!==i&&(e>=i&&(e=i),i>=t&&(t=i));return new D(e,t)},vi=function(n){return function(t){return t.min>=n&&t.max>n?1:t.min<n&&t.max<=n?-1:0}},gi=vi(0),ci=function(n,t){return new D(Math.min(n.min,t.min),Math.max(n.max,t.max))},Zr=function(n){return function(t){return t.min>n&&t.max>n?new D(n,t.max):t.min<n&&t.max<n?new D(t.min,n):t}},Qr=Zr(0),Mi=function(n,t,e){var i,r,o;return r=function(){return t.length},i=function(n){return t[n]},o=e?function(n){return e(t[n],n)}:i,new ht(n,n,i,r,t,o)},Ki=function(n,t,e,i){return Gu(n,n,t,e,i)},Gu=function(n,t,e,i,r){var o,u,a,s;return a=fi(i),u=function(){return i.length},o=function(n){return i[n]},s=r?function(n){return r(i[n],n)}:o,new je(n,t,e,o,u,a,s)},zr=function(n,t,e){var i,r,o,u,a,s,c,l,f,d,g,v,p;for(p=0,g={},l=t(),o=new Array(l),u=function(){var n,t,i;for(i=[],n=0,t=e.length;t>n;n++)f=e[n],i.push(g[f]=new h(p++,f));return i}(),c=v=0;l>=0?l>v:v>l;c=l>=0?++v:--v)a=n(c),f=void 0!==a?a:"?",(r=g[f])||u.push(g[f]=r=new h(p++,f)),o[c]=r;return i=function(n){return o[n]},d=function(n){return o[n].value},s=function(n){return o[n].value},new H(i,d,t,u,s)},Ti=function(n,t,e,i){var r,o,u;return o=function(){return e.length},r=function(n){return e[n]},u=zr(r,o,i||[]),new G(n,n,t,u.at,u.valueAt,o,u.domain,u.format)},Yi=function(n,t,e,i,r){var o,u;return u=_.indexBy(t,function(n){return n.name}),o=new Z(n,t,u,e,i,null,null,null,r||{}),o.evaluate=function(t){var e,r,a,s;return r=_.isArray(t)?t:[t],a=function(){var a,c,l;for(l=[],a=0,c=r.length;c>a;a++)if(e=r[a],e instanceof ft)l.push(o.evaluate(e.evaluate(o)));else if(e instanceof Ft){if(!i)throw new Error("Cannot compute aggregate ["+e.name+"] on an unaggregated frame.");l.push(o.evaluate(e.evaluate(o,i)))}else{if(!(e instanceof U))throw new Error("Cannot evaluate ["+t+"] on frame ["+n+"].");if(!(s=u[e.name]))throw new Error("Vector ["+e.name+"] does not exist in frame ["+n+"].");l.push(s)}return l}(),_.flatten(a)},o.attach=function(e){if(u[e.name])throw new Error("Cannot attach vector ["+e.name+"]: a vector by that name already exists in frame ["+n+"]");return t.push(e),u[e.name]=e,e},o.exists=function(n){return u[n]?!0:!1},o},wr=function(n){var t,e,i,r,o,u,a,s,c,l,h;for(u=new Array(n.indices.length),e=_.map(n.vectors,function(n){return n instanceof G?n.valueAt:n.at}),h=n.indices,a=0,c=h.length;c>a;a++)for(i=h[a],u[i]=o=new Array(n.vectors.length),r=s=0,l=e.length;l>s;r=++s)t=e[r],o[r]=t(i);return u},Bi=function(n){return new Yt(Rr(n,Ut),Rr(n,Be),Rr(n,et),Rr(n,rt))},Ni=function(n){return _.map(n,function(n){return new U(n)})},Ei=function(n){return new ft(function(t){var e,i,r,o,u,a,s,c;if(s=_.head(t.evaluate(n)),s instanceof G)return n;for(u=s.count(),e=s.at,r=new Array(u),o=c=0;u>=0?u>c:c>u;o=u>=0?++c:--c)void 0!==(a=e(o))&&(r[o]=""+a);return t.attach(i=Ti("factor("+s.label+")",_e,r)),[new U(i.name)]})},So=tr([String,function(n){return So(new U(n))}],[U,function(n){return Ei(n)}]),Ui=function(n,t){return new ft(function(e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p,m,w,b,y,k,x,C,q,S;if(b=_.head(e.evaluate(n)),b instanceof G)throw new Error("Cannot stack factor ["+b.label+"]: expecting vector.");for(d=b.count(),m=new Array(d),c=new Array(d),p="low("+b.name+", "+t+")",s="high("+b.name+", "+t+")",i=b.at,o=e.cube,t=Math.min(t,o.dimension),r=o.cells,v=a=0,y=new Array(t),S=e.indices,k=0,q=S.length;q>k;k++){for(l=S[k],g=r[l].levels,h=x=0;t>=0?t>x:x>t;h=t>=0?++x:--x)if(y[h]!==g[h].category){for(v=a=0,f=C=0;t>=0?t>C:C>t;f=t>=0?++C:--C)y[f]=g[f].category;break}w=i(l),0>w?(m[l]=v,c[l]=v+=w):(m[l]=a,c[l]=a+=w)}return u=function(n,t){return b.format(t)},e.attach(Gu(p,b.name,b.type,m,u)),e.attach(Gu(s,b.name,b.type,c,u)),[new U(p),new U(s)]})},tu=tr([String,Number,function(n,t){return tu(new U(n),t)}],[U,Number,function(n,t){return Ui(n,t)}]),lu=function(n){var t;return t=ei(0,n.length-1),function(e){return n[t(-1+Math.round(e*n.length))]}},di=function(n){var t,e,i,r,o,u,a,s;return s=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)a=n[t],(a||0===a)&&i.push(a);return i}(),s.sort(function(n,t){return n-t}),e=s[0],t=s[s.length-1],u=lu(s),i=u(.25),r=u(.5),o=u(.75),[e,i,r,o,t]},De=function(n){var t,e,i,r,o;for(e=0,t=0,r=0,o=n.length;o>r;r++)i=n[r],void 0!==i&&(e+=i,t++);return e/t},Ge=function(n){var t,e,i,r;for(t=0,i=0,r=n.length;r>i;i++)e=n[i],void 0!==e&&t++;return t},He=function(n){var t,e,i,r;for(t=Number.NEGATIVE_INFINITY,i=0,r=n.length;r>i;i++)e=n[i],void 0!==e&&e>=t&&(t=e);return t},Ue=function(n){var t,e,i,r;for(t=Number.POSITIVE_INFINITY,i=0,r=n.length;r>i;i++)e=n[i],void 0!==e&&t>=e&&(t=e);return t},$e=function(n){var t,e,i,r;for(t=0,i=0,r=n.length;r>i;i++)e=n[i],void 0!==e&&(t+=e);return t},mi=function(n,t,e,i,r){return new Ft(function(o,u){var a,s,c,l,h,f,d,g,v,p,m,w,b,y,k,x;if(d=t+"("+n.name+")",o.exists(d))return new U(d);for(p=_.head(u.frame.evaluate(n)),a=p.at,l=new Array(u.cells.length),k=u.cells,f=m=0,b=k.length;b>m;f=++m){for(s=k[f],v=[],x=s.indices,w=0,y=x.length;y>w;w++)h=x[w],void 0!==(g=a(h))&&v.push(g);l[f]=r(v)}return o.attach(c=Ki(d,e,l,i)),[new U(c.name)]})},yo=function(n,t,e,i){return tr([String,function(r){return mi(new U(r),n,t,e,i)}],[U,function(r){return mi(r,n,t,e,i)}])},ko=yo("count",we,_.identity,Ge),_o=yo("avg",we,_.identity,De),zo=yo("max",we,_.identity,He),Ro=yo("min",we,_.identity,Ue),ru=yo("sum",we,_.identity,$e),No=function(){var n,t,e;return t=1<=arguments.length?Uu.call(arguments,0):[],e=function(){var e,i,r;for(r=[],e=0,i=t.length;i>e;e++)if(n=t[e],n instanceof U)r.push(n);else{if(!_.isString(n))throw new Error("Cannot group by ["+n+"]");r.push(new U(n))}return r}(),new et(e)},wo=tr([String,[String],Function,function(n,t,e){return new Ut(n,Ni(t),e)}]),Qo=function(){var n,t,e,i;return e=arguments[0],t=3<=arguments.length?Uu.call(arguments,1,i=arguments.length-1):(i=1,[]),n=arguments[i++],wo(e,t.length?t:[e],n)},bo=tr([[String],Function,function(n,t){return new Be(Ni(n),t)}]),au=function(){var n,t,e;return t=2<=arguments.length?Uu.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],bo(t,n)},mo=tr([[String],Function,function(n,t){return new rt(Ni(n),t)}],[[U],Function,function(n,t){return new rt(n,t)}]),Xo=function(){var n,t,e;return t=2<=arguments.length?Uu.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],mo(t,n)},qo=function(n){return function(t){return t===n}},Bo=function(n){return function(t){return t!==n}},jo=function(n){return function(t){return n>t}},Yo=function(n){return function(t){return t>n}},Po=function(n){return function(t){return n>=t}},Eo=function(n){return function(t){return t>=n}},Io=function(n){if(ye!==Fu(n))throw new Error("like ["+n+"]: expecting RegExp");return function(t){return n.test(t)}},Mo=function(){var n;return n=1<=arguments.length?Uu.call(arguments,0):[],function(t){var e,i,r;for(i=0,r=n.length;r>i;i++)if(e=n[i],e===t)return!0;return!1}},Lo=function(){var n;return n=1<=arguments.length?Uu.call(arguments,0):[],function(t){var e,i,r;for(i=0,r=n.length;r>i;i++)if(e=n[i],e===t)return!1;return!0}},hu=function(t,e){var i,r,o,u,a,s,c,l,h;return c=e.where.length?Yi(t.label,t.vectors,Br(t,e.where)):t,e.group.length?(s=Vr(e.group,function(n){return n.fields}),u=function(){var n,t,e;for(e=[],n=0,t=s.length;t>n;n++){if(a=s[n],h=_.head(c.evaluate(a)),!(h instanceof G))throw new Error("Cannot group by ["+a.name+"]: not a Factor.");e.push(h)}return e}(),l={0:new st(n,c.indices,{})},Qe(l,u,0),r=[],oi(l[0].children,s.length-1,r,0,new Array(s.length)),o=new M(c,l,r,s.length),i=Ve(c.label+"'",o,u),e.having.length?Yi(i.label,i.vectors,Br(i,e.having),i.cube):i):c},Br=function(n,t){var e,i,r,o,u,a,s,c,l,h,f,d,g,v,p,m;for(f=n.indices,h=0,v=t.length;v>h;h++){for(c=t[h],a=[],l=function(){var t,e,i,r;for(i=c.fields,r=[],t=0,e=i.length;e>t;t++)o=i[t],r.push(_.head(n.evaluate(o)));return r}(),r=_.map(l,function(n){return n instanceof G?n.valueAt:n.at}),d=0,p=f.length;p>d;d++){for(u=f[d],e=new Array(l.length),s=g=0,m=r.length;m>g;s=++g)i=r[s],e[s]=i(u);c.predicate.apply(null,e)&&a.push(u)}f=a}return f},Ve=function(n,t,e){var i,r,o;return i=_.range(t.cells.length),o=function(){var n,i,o;for(o=[],r=n=0,i=t.dimension;i>=0?i>n:n>i;r=i>=0?++n:--n)o.push(jr(t,e[r],r));return o}(),Yi(n,o,i,t)},Qe=function(n,t,e){var i,r,o,u,a,s,c,l,h,f;i=t[e].at;for(s in n){for(c=n[s],u=c.children,f=c.indices,l=0,h=f.length;h>l;l++)a=f[l],r=i(a),(o=u[r.key])||(u[r.key]=o=new st(r,[],{})),o.indices.push(a);e<t.length-1&&Qe(u,t,e+1)}},oi=function(n,t,e,i,r){var o,u;for(o in n)u=n[o],r[i]=u,i===t?e.push(new f(pi(r),u.indices)):oi(u.children,t,e,i+1,r)},jr=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v;for(a=new Array(n.cells.length),s={},c=[],v=n.cells,h=d=0,g=v.length;g>d;h=++d)o=v[h],a[h]=r=o.levels[e].category,s[r.value]||(s[r.value]=r,c.push(r));return i=function(n){return a[n]},f=function(n){return a[n].value},l=function(n){return a[n].value},u=function(){return a.length},new G(t.label,t.label,t.type,i,f,u,c,l)},k={c10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],c20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],c20b:["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],c20c:["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"]},go=function(n){return n>10?k.c20:k.c10},ri=function(n){var t,e,i,r;return r=n.rgb(),i=r[0],e=r[1],t=r[2],chroma.rgb(i,e,t)},ai=function(n){return n.css()},si=function(n,t){return ri(n).alpha(t).css()},lr=function(n,t,e,i){var r;return r=Math.sqrt(i/Ru),n.beginPath(),n.arc(t,e,r,0,Bu,!1),n.closePath()},dr=function(n,t,e,i){var r;return r=.5*Math.sqrt(i),n.save(),n.translate(t,e),n.beginPath(),n.moveTo(r,r),n.lineTo(-r,r),n.lineTo(-r,-r),n.lineTo(r,-r),n.closePath(),n.restore()},hr=function(n,t,e,i){var r,o;return r=.5*Math.sqrt(i/5),o=3*r,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(o,r),n.lineTo(r,r),n.lineTo(r,o),n.lineTo(-r,o),n.lineTo(-r,r),n.lineTo(-o,r),n.lineTo(-o,-r),n.lineTo(-r,-r),n.lineTo(-r,-o),n.lineTo(r,-o),n.lineTo(r,-r),n.lineTo(o,-r),n.closePath(),n.restore()},fr=function(n,t,e,i){var r,o;return o=Math.sqrt(i/(2*Ce)),r=o*Ce,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(r,0),n.lineTo(0,o),n.lineTo(-r,0),n.lineTo(0,-o),n.closePath(),n.restore()},mr=function(n,t,e,i){var r,o;return r=Math.sqrt(i/ue),o=r*ue/2,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(0,-o),n.lineTo(r,o),n.lineTo(-r,o),n.closePath(),n.restore()},gr=function(n,t,e,i){var r,o;return r=Math.sqrt(i/ue),o=r*ue/2,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(0,o),n.lineTo(r,-o),n.lineTo(-r,-o),n.closePath(),n.restore()},pr=function(n,t,e,i){var r,o;return o=Math.sqrt(i/ue),r=o*ue/2,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(r,0),n.lineTo(-r,o),n.lineTo(-r,-o),n.closePath(),n.restore()},vr=function(n,t,e,i){var r,o;return o=Math.sqrt(i/ue),r=o*ue/2,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(-r,0),n.lineTo(r,-o),n.lineTo(r,o),n.closePath(),n.restore()},ne={circle:lr,square:dr,cross:hr,diamond:fr,triangleUp:mr,triangleDown:gr,triangleLeft:vr,triangleRight:pr},Zt={c8:["circle","square","cross","diamond","triangleUp","triangleDown","triangleLeft","triangleRight"]},vo=function(){return Zt.c8},Eu=function(n){return function(t){return void 0!==t?n(t):void 0}},Fi=function(n,t){var e;return e=d3.scale.linear().domain([n.min,n.max]).range([t.min,t.max]).nice(),[Eu(e),e.tickFormat,e.ticks]},ji=function(n,t){var e,i,r,o,u,a,s;for(a=0,o={},u=0,s=n.length;s>u;u++)e=n[u],o[e.key]=a++;return i=(t.max-t.min)/n.length/2,r=t.min,Eu(function(n){return r+2*o[n.key]*i+i})},_i=function(n,t){var e,i;return i=t.values,e=i.length,Eu(function(n){return i[n.key%e]})},Gi=function(n,t){return Eu(d3.scale.linear().domain([n.min,n.max]).range([t.min,t.max]))},Si=function(n,t){return Eu(d3.scale.linear().domain([n.min,n.mid,n.max]).range([t.min,t.mid,t.max]))},Di=function(n,t){return Eu(chroma.scale([t.min,t.max]).domain([n.min,n.max]).mode("lch"))},qi=function(n,t){var e,i;return e=chroma.scale([t.min,t.mid]).domain([n.min,n.mid]).mode("lch"),i=chroma.scale([t.mid,t.max]).domain([n.mid,n.max]).mode("lch"),function(t){return void 0!==t?t<n.mid?e(t):i(t):void 0}},xi=tr([Jt,x,Di],[R,x,qi]),Ai=tr([Jt,Jt,Gi],[R,R,Si]),Ze=function(n){var t;return t=n.toString(16),1===t.length?"0"+t:t},ki=function(n){var t,e,i,r;return t=n.context,i=n.ratio,e=function(){return"#fff"},r=function(n,e){var r,o,u,a,s;return s=t.getImageData(n*i,e*i,1,1).data,a=s[0],u=s[1],o=s[2],r=s[3],255===a&&255===u&&255===o&&255===r},new g(e,r)},Ii=function(n){var t,e,i,r,o,u;return t=n.context,r=n.ratio,u=0,e={},i=function(n){var t,i,r,o;return i=u++,u>=y&&(u=0),e[i]=n,o=i>>16&255,r=i>>8&255,t=255&i,"#"+Ze(o)+Ze(r)+Ze(t)},o=function(n,i){var o,u,a,s,c,l;return l=t.getImageData(n*r,i*r,1,1).data,c=l[0],s=l[1],u=l[2],o=l[3],255===o?(a=(c<<16)+(s<<8)+u,e[a]):void 0},new pt(i,o)},Er=function(n,t){var e,i,r,o,u,a,s;return s=n.scale,i=n.domain,a=n.range,o=n.guide,u=t.label,e=t.at,r=function(n){return s(e(n))},new Et(u,r,t,i,a,o)},xr=function(n,t){return new C(n.scale(t))},kr=function(n,t){var e,i,r,o,u,a,s;return t instanceof Ee||t instanceof Pe?(s=_.head(n.evaluate(t.field)),s instanceof G?(t.range||(t.range=new l(go(s.domain.length))),u=_i(s.domain,t.range),e=s.at,r=function(n){return chroma(u(e(n)))},new b(s.label,r,s,s.domain,t.range,null)):(i=function(){switch(gi(s.domain)){case 1:return new Jt(s.domain.min,s.domain.max);case-1:return new Jt(s.domain.min,s.domain.max);default:return new R(s.domain.min,0,s.domain.max)}}(),a=gi(i),o=t.range?t.range instanceof z?i instanceof Jt?1===a?new $t(t.range.mid,t.range.max):new $t(t.range.min,t.range.mid):t.range:(i instanceof R?i=new Jt(i.min,i.max):void 0,t.range):i instanceof Jt?1===a?new $t("#deebf7","#3182bd"):new $t("#e6550d","#fee6ce"):new z("#fc8d59","#ffffbf"),u=xi(i,o),e=s.at,r=function(n){return u(e(n))},new b(s.label,r,s,i,o,null))):new C(t.value)},Wr=function(n,t){var e,i,r,o,u,a;if(t instanceof Ne||t instanceof Ie){if(a=_.head(n.evaluate(t.field)),a instanceof G)throw new Error("Could not encode opacity. Vector ["+a.label+"] is a Factor.");
return i=new Jt(a.domain.min,a.domain.max),o=t.range?new Jt(ti(t.range.min),ti(t.range.max)):t.range=new Jt(.05,1),u=Ai(i,o),e=a.at,r=function(n){return u(e(n))},new bt(a.label,r,a,i,o,null)}return new C(ti(t.value))},Pr=function(n,t){var e,i;return n&&t?(e=n.encode,i=t.encode,new Te("("+n.label+", "+t.label+")",function(n){var t,r;return t=e(n),r=i(n),r>=0&&1>r?si(t,r):ai(t)})):void 0},Fr=function(n,t){return function(e,i,r){var o,u,a,s,c,l;if(i instanceof n){if(l=_.head(e.evaluate(i.field)),l instanceof G)throw new Error("Could not encode size. Vector ["+l.label+"] is a Factor.");return u=new Jt(l.domain.min,l.domain.max),s=i.range?new Jt(ti(i.range.min),ti(i.range.max)):i.range=new Jt(.05,1),c=Ai(u,s),o=l.at,a=function(n){return r*c(o(n))},new t(l.label,a,u,s,null)}return new C(r*ti(i.value))}},Ar=Fr(Me,ie),Ir=Fr(Fe,ie),qr=Fr(Ye,ie),br=function(n,t){var e,i,r,o,u,a;if(t instanceof Me){if(a=_.head(n.evaluate(t.field)),a instanceof G)throw new Error("Could not encode size. Vector ["+a.label+"] is a Factor.");return i=new Jt(a.domain.min,a.domain.max),o=t.range?new Jt(Pu(t.range.min),Pu(t.range.max)):t.range=new Jt(Pu(nr),Pu(30)),u=Ai(i,o),e=a.at,r=function(n){return u(e(n))},new ie(a.label,r,a,i,o,null)}return new C(Pu(t.value))},Sr=function(n,t){var e,i,r,o,u,a;if(t instanceof Xe){if(a=_.head(n.evaluate(t.field)),a instanceof G)throw new Error("Could not encode lineWidth. Vector ["+a.label+"] is a Factor.");return i=new Jt(a.domain.min,a.domain.max),o=t.range?new Jt(t.range.min,t.range.max):t.range=new Jt(1.5,15),u=Ai(i,o),e=a.at,r=function(n){return u(e(n))},new ie(a.label,r,a,i,o,null)}return new C(t.value)},Xr=function(n,t){var e,i,r,o;if(t instanceof Ae){if(o=_.head(n.evaluate(t.field)),!(o instanceof G))throw new Error("Could not encode shape. Vector ["+o.label+"] is not a Factor.");return t.range||(t.range=new l(vo(o.domain.length))),r=_i(o.domain,t.range),e=o.at,i=function(n){return ne[r(e(n))]},new Qt(o.label,i,o,o.domain,t.range,null)}return new C(ne[t.value]||ne.circle)},no=function(n,t){return[null!=n?n:new q(chroma(_.head(k.c10))),null!=t?t:new S(1)]},eo=function(n,t,e){return[null!=n?n:new N(chroma(_.head(k.c10))),null!=t?t:new Y(1),null!=e?e:new O(1.5)]},to=function(n,t,e,i,r,o,u){var a,s,c,l;return a=n||t,s=e||i||r,a||s||(o&&(a=!0),u&&(s=!0)),a&&(c=no(n,t),n=c[0],t=c[1]),s&&(l=eo(e,i,r),e=l[0],i=l[1],r=l[2]),[n,t,e,i,r]},Cr=function(n,t){var e,i;return t.fillColor||t.fillOpacity?[e=kr(n,t.fillColor),i=Wr(n,t.fillOpacity),Pr(e,i)]:[]},Mr=function(n,t){var e,i;return t.strokeColor||t.strokeOpacity||t.lineWidth?[e=kr(n,t.strokeColor),i=Wr(n,t.strokeOpacity),Pr(e,i),Sr(n,t.lineWidth)]:[]},ii=function(n,t,e,i,r){return n.beginPath(),n.rect(t,e,i,r),n.clip()},cr=function(n,t,e){return n.lineWidth=e,n.strokeStyle=t,n.stroke()},ir=function(n,t){return n.fillStyle=t,n.fill()},rr=function(n,t,e,i,r){return n.beginPath(),n.moveTo(t,e),n.lineTo(i,r),n.stroke()},ur=function(n,t,e,i,r){return n.beginPath(),i>e?n.rect(t-r/2,e,r,i-e):n.rect(t-r/2,i,r,e-i),n.closePath()},or=function(n,t,e,i,r){return n.beginPath(),e>t?n.rect(t,i-r/2,e-t,r):n.rect(e,i-r/2,t-e,r),n.closePath()},ar=function(n,t,e,i,r,o,u,a,s,c){var l,h;return void 0!==t&&void 0!==e&&void 0!==i&&void 0!==r&&void 0!==o&&void 0!==u&&void 0!==a&&void 0!==s&&void 0!==c?(n.strokeStyle=s,n.lineWidth=c,or(n,e,r,u,a),n.stroke(),l=a/2,h=a/4,rr(n,i,u-l,i,u+l),rr(n,e,u,t,u),rr(n,r,u,o,u),rr(n,t,u-h,t,u+h),rr(n,o,u-h,o,u+h)):void 0},sr=function(n,t,e,i,r,o,u,a,s,c){var l,h;return void 0!==t&&void 0!==e&&void 0!==i&&void 0!==r&&void 0!==o&&void 0!==u&&void 0!==a&&void 0!==s&&void 0!==c?(n.strokeStyle=s,n.lineWidth=c,ur(n,t,i,o,a),n.stroke(),l=a/2,h=a/4,rr(n,t-l,r,t+l,r),rr(n,t,i,t,e),rr(n,t,o,t,u),rr(n,t-h,e,t+h,e),rr(n,t-h,u,t+h,u)):void 0},Ri=function(n,t){var e,i,r,o,u,a,s,c,l,h,f,d,g;return o=t[0],u=t[1],c=new oe([o],[u]),a=null!=(f=n.shape)?f:new T("circle"),s=null!=(d=n.size)?d:new E(nr),g=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!1,!0),e=g[0],i=g[1],l=g[2],h=g[3],r=g[4],new Ot(c,o,u,a,s,e,i,l,h,r)},Tr=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,v,p;return s=Er(e,t.positionX),c=Er(i,t.positionY),l=Xr(n,t.shape),h=br(n,t.size),v=Cr(n,t),o=v[0],u=v[1],r=v[2],p=Mr(n,t),d=p[0],g=p[1],f=p[2],a=p[3],new qt(s,c,l,h,r,o,u,f,d,g,a)},$r=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p;for(u=t.positionX,a=t.positionY,s=t.shape,c=t.size,i=t.fill,l=t.stroke,o=t.lineWidth,e.save(),d=0,v=n.length;v>d;d++)r=n[d],h=u(r),f=a(r),void 0!==h&&void 0!==f&&(s(r)(e,h,f,c(r)),e.lineWidth=2+(l?o(r):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",g=0,p=n.length;p>g;g++)r=n[g],h=u(r),f=a(r),void 0!==h&&void 0!==f&&(s(r)(e,h,f,c(r)),l&&(e.lineWidth=o(r),e.stroke()),i&&e.fill());return e.restore()},co=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,v;for(a=t.positionX,s=t.positionY,c=t.shape,l=t.size,h=t.stroke,o=t.lineWidth,e.save(),g=0,v=n.length;v>g;g++)r=n[g],f=a(r),d=s(r),void 0!==f&&void 0!==d&&(u=i.put(r),c(r)(e,f,d,l(r)),e.fillStyle=u,e.fill(),h&&(e.lineWidth=o(r),e.strokeStyle=u,e.stroke()));return e.restore()},Cu=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g;for(u=t.positionX,a=t.positionY,s=t.shape,c=t.size,i=t.fill,l=t.stroke,o=t.lineWidth,e.save(),d=0,g=n.length;g>d;d++)r=n[d],h=u(r),f=a(r),void 0!==h&&void 0!==f&&(s(r)(e,h,f,c(r)),l&&(e.lineWidth=o(r),e.strokeStyle=l(r),e.stroke()),i&&(e.fillStyle=i(r),e.fill()));return e.restore()},Xu=function(n,t,e,i,r,o){var u,a,s,c,l,h,f,d;for(a=t.positionX,s=t.positionY,c=[],f=0,d=n.length;d>f;f++)u=n[f],l=a(u),h=s(u),void 0!==l&&void 0!==h&&l>=e&&r>=l&&h>=i&&o>=h&&c.push(u);return c},Iu=function(n){return _.map(n,function(n){return n.type}).join(", ")},Li=function(n,t){var e,i,o,u,a,s,c,l,h,f,d,g,v,p,w,b,y,_,k,x,C,q,S;switch(p=Iu(t)){case"String, Number":return a=t[0],f=t[1],d=new oe([a],[f]),w=null!=(b=n.width)?b:new X(.8),y=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!0,!1),e=y[0],i=y[1],g=y[2],v=y[3],u=y[4],new m(d,a,void 0,f,w,e,i,g,v,u);case"String, Number, Number":return a=t[0],h=t[1],f=t[2],d=new oe([a],[h,f]),w=null!=(_=n.width)?_:new X(.8),k=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!0,!1),e=k[0],i=k[1],g=k[2],v=k[3],u=k[4],new m(d,a,h,f,w,e,i,g,v,u);case"Number, String":return c=t[0],l=t[1],d=new oe([c],[l]),o=null!=(x=n.height)?x:new W(.8),C=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!0,!1),e=C[0],i=C[1],g=C[2],v=C[3],u=C[4],new r(d,void 0,c,l,o,e,i,g,v,u);case"Number, Number, String":return s=t[0],c=t[1],l=t[2],d=new oe([s,c],[l]),o=null!=(q=n.height)?q:new W(.8),S=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!0,!1),e=S[0],i=S[1],g=S[2],v=S[3],u=S[4],new r(d,s,c,l,o,e,i,g,v,u);default:throw new Error("Cannot create rect marks with vectors of type ["+p+"]")}},_r=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,p,m;return s=Er(e,t.positionX),c=t.positionY1?Er(i,t.positionY1):xr(i,0),l=Er(i,t.positionY2),g=Ar(n,t.width,e.rect.width/e.domain.length),p=Cr(n,t),o=p[0],u=p[1],r=p[2],m=Mr(n,t),f=m[0],d=m[1],h=m[2],a=m[3],new v(s,c,l,g,r,o,u,h,f,d,a)},yr=function(n,t,i,r){var o,u,a,s,c,l,h,f,d,g,v,p,m,w,b,y,_;switch(t.space.x.length){case 1:m=t.space.x[0],l=xr(i,0),h=Er(i,m);break;default:b=t.space.x,p=b[0],m=b[1],l=Er(i,p),h=Er(i,m)}return w=t.space.y[0],f=Er(r,w),s=Ar(n,t.height,r.rect.height/r.domain.length),y=Cr(n,t),u=y[0],a=y[1],o=y[2],_=Mr(n,t),g=_[0],v=_[1],d=_[2],c=_[3],new e(l,h,f,s,o,u,a,d,g,v,c)},Hr=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p,m,w;for(u=t.positionX,a=t.positionY1,s=t.positionY2,h=t.width,i=t.fill,c=t.stroke,o=t.lineWidth,e.save(),v=0,m=n.length;m>v;v++)r=n[v],f=u(r),d=a(r),g=s(r),l=h(r),void 0!==f&&void 0!==d&&void 0!==g&&void 0!==l&&(ur(e,f,d,g,l),e.lineWidth=2+(c?o(r):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",p=0,w=n.length;w>p;p++)r=n[p],f=u(r),d=a(r),g=s(r),l=h(r),void 0!==f&&void 0!==d&&void 0!==g&&void 0!==l&&(ur(e,f,d,g,l),c&&(e.lineWidth=o(r),e.stroke()),i&&e.fill());return e.restore()},Gr=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p,m,w;for(s=t.positionX1,c=t.positionX2,l=t.positionY,o=t.height,i=t.fill,h=t.stroke,a=t.lineWidth,e.save(),v=0,m=n.length;m>v;v++)u=n[v],f=s(u),d=c(u),g=l(u),r=o(u),void 0!==f&&void 0!==d&&void 0!==g&&void 0!==r&&(or(e,f,d,g,r),e.lineWidth=2+(h?a(u):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",p=0,w=n.length;w>p;p++)u=n[p],f=s(u),d=c(u),g=l(u),r=o(u),void 0!==f&&void 0!==d&&void 0!==g&&void 0!==r&&(or(e,f,d,g,r),h&&(e.lineWidth=a(u),e.stroke()),i&&e.fill());return e.restore()},ao=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,v,p,m;for(a=t.positionX,s=t.positionY1,c=t.positionY2,f=t.width,l=t.stroke,o=t.lineWidth,e.save(),p=0,m=n.length;m>p;p++)r=n[p],d=a(r),g=s(r),v=c(r),h=f(r),void 0!==d&&void 0!==g&&void 0!==v&&void 0!==h&&(u=i.put(r),ur(e,d,g,v,h),ir(e,u),l&&cr(e,u,o(r)));return e.restore()},uo=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,v,p,m;for(c=t.positionX1,l=t.positionX2,h=t.positionY,o=t.height,f=t.stroke,a=t.lineWidth,e.save(),p=0,m=n.length;m>p;p++)u=n[p],d=c(u),g=l(u),v=h(u),r=o(u),void 0!==d&&void 0!==g&&void 0!==v&&void 0!==r&&(s=i.put(u),or(e,d,g,v,r),ir(e,s),f&&cr(e,s,a(u)));return e.restore()},mu=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p;for(u=t.positionX,a=t.positionY1,s=t.positionY2,h=t.width,i=t.fill,c=t.stroke,o=t.lineWidth,e.save(),v=0,p=n.length;p>v;v++)r=n[v],f=u(r),d=a(r),g=s(r),l=h(r),void 0!==f&&void 0!==d&&void 0!==g&&void 0!==l&&(ur(e,f,d,g,l),c&&cr(e,c(r),o(r)),i&&ir(e,i(r)));return e.restore()},pu=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p;for(s=t.positionX1,c=t.positionX2,l=t.positionY,o=t.height,i=t.fill,h=t.stroke,a=t.lineWidth,e.save(),v=0,p=n.length;p>v;v++)u=n[v],f=s(u),d=c(u),g=l(u),r=o(u),void 0!==f&&void 0!==d&&void 0!==g&&void 0!==r&&(or(e,f,d,g,r),h&&cr(e,h(u),a(u)),i&&ir(e,i(u)));return e.restore()},Yu=function(n,t,e,i,r,o){var u,a,s,c,l,h,f,d,g,v,p,m,w,b,y;for(a=t.positionX,s=t.positionY1,c=t.positionY2,f=t.width,l=[],b=0,y=n.length;y>b;b++)u=n[b],d=a(u),p=s(u),m=c(u),p>m&&(w=p,p=m,m=w),h=f(u),void 0!==d&&void 0!==p&&void 0!==m&&void 0!==h&&(g=d-h/2,v=d+h/2,e>v||g>r||i>m||p>o||l.push(u));return l},Nu=function(n,t,e,i,r,o){var u,a,s,c,l,h,f,d,g,v,p,m,w,b,y;for(c=t.positionX1,l=t.positionX2,h=t.positionY,a=t.height,f=[],b=0,y=n.length;y>b;b++)s=n[b],d=c(s),g=l(s),p=h(s),d>g&&(v=d,d=g,g=v),u=a(s),void 0!==d&&void 0!==g&&void 0!==p&&void 0!==u&&(m=p-u/2,w=p+u/2,e>g||d>r||i>w||m>o||f.push(s));return f},Vi=function(n,t){var e,i,r,o,u,a,s,c,l,h,f,d,g,v,p,m,w,b;switch(f=Iu(t)){case"String, Number, Number, Number, Number, Number":return g=t[0],r=t[1],o=t[2],u=t[3],a=t[4],s=t[5],c=new oe([g],[r,o,u,a,s]),d=null!=(p=n.width)?p:new X(.8),m=eo(n.strokeColor,n.strokeOpacity,n.lineWidth),l=m[0],h=m[1],i=m[2],new Gt(c,g,r,o,u,a,s,d,l,h,i);case"Number, Number, Number, Number, Number, String":return r=t[0],o=t[1],u=t[2],a=t[3],s=t[4],v=t[5],c=new oe([r,o,u,a,s],[v]),e=null!=(w=n.height)?w:new X(.8),b=eo(n.strokeColor,n.strokeOpacity,n.lineWidth),l=b[0],h=b[1],i=b[2],new Lt(c,r,o,u,a,s,v,e,l,h,i)}},Nr=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,v;return u=Er(e,t.q0),a=Er(e,t.q1),s=Er(e,t.q2),c=Er(e,t.q3),l=Er(e,t.qn),g=Er(i,t.positionY),r=Ar(n,t.height,i.rect.height/i.domain.length),v=Mr(n,t),f=v[0],d=v[1],h=v[2],o=v[3],new Rt(u,a,s,c,l,g,r,h,f,d,o)},Jr=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p;for(u=t.positionY,a=t.q0,s=t.q1,c=t.q2,l=t.q3,h=t.qn,i=t.height,f=t.stroke,o=t.lineWidth,e.save(),d=0,v=n.length;v>d;d++)r=n[d],ar(e,a(r),s(r),c(r),l(r),h(r),u(r),i(r),f(r),2+(f?o(r):1));for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.strokeStyle="black",g=0,p=n.length;p>g;g++)r=n[g],ar(e,a(r),s(r),c(r),l(r),h(r),u(r),i(r),f(r),o(r));return e.restore()},lo=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,v,p,m,w,b,y;for(c=t.positionY,l=t.q0,h=t.q1,f=t.q2,d=t.q3,g=t.qn,o=t.height,v=t.stroke,a=t.lineWidth,e.save(),b=0,y=n.length;y>b;b++)u=n[b],p=l(u),m=g(u),w=c(u),r=o(u),void 0!==p&&void 0!==m&&void 0!==w&&void 0!==r&&(s=i.put(u),or(e,p,m,w,r),ir(e,s),cr(e,s,a(u)));return e.restore()},Su=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g;for(u=t.positionY,a=t.q0,s=t.q1,c=t.q2,l=t.q3,h=t.qn,i=t.height,f=t.stroke,o=t.lineWidth,e.save(),d=0,g=n.length;g>d;d++)r=n[d],ar(e,a(r),s(r),c(r),l(r),h(r),u(r),i(r),f(r),o(r));return e.restore()},Au=function(n,t,e,i,r,o){var u,a,s,c,l,h,f,d,g,v,p,m,w,b,y,_,k,x,C,q;for(l=t.positionY,h=t.q0,f=t.q1,d=t.q2,g=t.q3,v=t.qn,a=t.height,m=t.stroke,c=t.lineWidth,p=[],C=0,q=n.length;q>C;C++)s=n[C],w=h(s),b=v(s),_=l(s),w>b&&(y=w,w=b,b=y),u=a(s),void 0!==w&&void 0!==b&&void 0!==_&&void 0!==u&&(k=_-u/2,x=_+u/2,e>b||w>r||i>x||k>o||p.push(s));return p},Yr=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,v;return g=Er(e,t.positionX),o=Er(i,t.q0),u=Er(i,t.q1),a=Er(i,t.q2),s=Er(i,t.q3),c=Er(i,t.qn),d=Ar(n,t.width,e.rect.width/e.domain.length),v=Mr(n,t),h=v[0],f=v[1],l=v[2],r=v[3],new Vt(g,o,u,a,s,c,d,l,h,f,r)},Kr=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p;for(o=t.positionX,u=t.q0,a=t.q1,s=t.q2,c=t.q3,l=t.qn,f=t.width,h=t.stroke,r=t.lineWidth,e.save(),d=0,v=n.length;v>d;d++)i=n[d],sr(e,o(i),u(i),a(i),s(i),c(i),l(i),f(i),h(i),2+(h?r(i):1));for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.strokeStyle="black",g=0,p=n.length;p>g;g++)i=n[g],sr(e,o(i),u(i),a(i),s(i),c(i),l(i),f(i),h(i),r(i));return e.restore()},ho=function(n,t,e,i){var r,o,u,a,s,c,l,h,f,d,g,v,p,m,w,b,y;for(a=t.positionX,s=t.q0,c=t.q1,l=t.q2,h=t.q3,f=t.qn,v=t.width,d=t.stroke,o=t.lineWidth,e.save(),b=0,y=n.length;y>b;b++)r=n[b],p=a(r),m=s(r),w=f(r),g=v(r),void 0!==p&&void 0!==m&&void 0!==w&&void 0!==g&&(u=i.put(r),ur(e,p,m,w,g),ir(e,u),cr(e,u,o(r)));return e.restore()},Wu=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g;for(o=t.positionX,u=t.q0,a=t.q1,s=t.q2,c=t.q3,l=t.qn,f=t.width,h=t.stroke,r=t.lineWidth,e.save(),d=0,g=n.length;g>d;d++)i=n[d],sr(e,o(i),u(i),a(i),s(i),c(i),l(i),f(i),h(i),r(i));return e.restore()},Mu=function(n,t,e,i,r,o){var u,a,s,c,l,h,f,d,g,v,p,m,w,b,y,_,k,x,C,q;for(s=t.positionX,c=t.q0,l=t.q1,h=t.q2,f=t.q3,d=t.qn,m=t.width,v=t.stroke,a=t.lineWidth,g=[],C=0,q=n.length;q>C;C++)u=n[C],w=s(u),_=c(u),k=d(u),_>k&&(x=_,_=k,k=x),p=m(u),void 0!==w&&void 0!==_&&void 0!==k&&void 0!==p&&(b=w-p/2,y=w+p/2,e>y||b>r||i>k||_>o||g.push(u));return g},zi=function(n,t){var e,i,r,o,u,a,s;return i=t[0],r=t[1],o=new oe([i],[r]),s=eo(n.strokeColor,n.strokeOpacity,n.lineWidth),u=s[0],a=s[1],e=s[2],new xt(o,i,r,u,a,e)},Or=function(n,t,e,i){var r,o,u,a,s,c,l;return o=Er(e,t.positionX),u=Er(i,t.positionY),l=Mr(n,t),s=l[0],c=l[1],a=l[2],r=l[3],new yt(o,u,a,s,c,r)},Ur=function(n,t,e){var i,r,o,u,a,s,c;for(r=t.positionX,o=t.positionY,e.save(),s=0,c=n.length;c>s;s++)i=n[s],u=r(i),a=o(i),e.lineWidth=1.5,e.strokeStyle="black",void 0!==u&&void 0!==a&&(lr(e,u,a,64),e.stroke());return e.restore()},so=function(n,t,e,i){var r,o,u,a,s,c,l;for(o=t.positionX,u=t.positionY,e.save(),c=0,l=n.length;l>c;c++)r=n[c],a=o(r),s=u(r),void 0!==a&&void 0!==s&&(lr(e,a,s,64),e.fillStyle=i.put(r),e.fill());return e.restore()},ku=function(n,t,e){var i,r,o,u,a,s,c,l,h,f,d,g,v,p,m,w,b,y,_;if(u=t.positionX,a=t.positionY,s=t.stroke,o=t.lineWidth,s instanceof C&&o instanceof C){for(e.strokeStyle=s(),e.lineWidth=o(),e.save(),w=!1,m=0,y=n.length;y>m;m++)r=n[m],h=u(r),g=a(r),void 0!==h&&void 0!==g?w?e.lineTo(h,g):(e.beginPath(),w=!0,e.moveTo(h,g)):(w&&e.stroke(),w=!1);return e.restore()}for(e.save(),e.lineCap="round",w=!1,f=void 0,v=void 0,c=void 0,b=0,_=n.length;_>b;b++)r=n[b],d=u(r),p=a(r),void 0!==d&&void 0!==p?(l=s(r),w&&(l!==c?(i=e.createLinearGradient(f,v,d,p),i.addColorStop(0,c||We),i.addColorStop(1,l||We),e.strokeStyle=i):e.strokeStyle=l,e.lineWidth=o(r),e.beginPath(),e.moveTo(f,v),e.lineTo(d,p),e.stroke()),w=!0,f=d,v=p,c=l):w=!1;return e.restore()},Pi=tr([St,Array,Ri],[_t,Array,zi],[It,Array,Li],[zt,Array,Vi]),Wt=new nt(Tr,co,$r,Cu,Xu),kt=new nt(Or,so,Ur,ku,Xu),p=new nt(_r,ao,Hr,mu,Yu),i=new nt(yr,uo,Gr,pu,Nu),Bt=new nt(Nr,lo,Jr,Su,Au),Dt=new nt(Yr,ho,Kr,Wu,Mu),To=tr([Z,_.identity],[Function,function(n){return new P(n)}]),uu=tr([Number,function(n){return new wt(n)}],[Boolean,function(n){return new o(n)}],[Date,function(n){return new I(n)}],[String,function(n){return new ae(n)}]),Co=function(){var n;n=1<=arguments.length?Uu.call(arguments,0):[]},Uo=tr([Array,function(n){return new l(n)}],[Number,function(n){return n>0?new Jt(0,n):0>n?new Jt(n,0):new R(-1,0,1)}],[String,function(n){return new $t(n,"black")}],[Number,Number,function(n,t){return t>=n?new Jt(n,t):new Jt(t,n)}],[String,String,function(n,t){return new $t(n,t)}],[Number,Number,Number,function(n,t,e){var i,r,o,u;return u=_.sortBy([n,t,e],_.identity),i=u[0],r=u[1],o=u[2],new R(i,r,o)}],[String,String,String,function(n,t,e){return new z(n,t,e)}]),ui=function(n){var t,e,i,r,o;for(o=[],i=0,r=n.length;r>i;i++)if(t=n[i],t instanceof U)o.push(t);else{if(_e!==(e=Fu(t)))throw new Error("Cannot create vector reference from ["+t+"] of type ["+e+"].");o.push(new U(t))}return o},Ho=function(){var n,t;return n=1<=arguments.length?Uu.call(arguments,0):[],new Tt(function(){var e,i,r,o;for(r=ui(n),o=[],e=0,i=r.length;i>e;e++)t=r[e],o.push(new A(t));return o}())},Wo=tr([ae,function(n){return new q(chroma(n.value))}],[String,function(n){return new Ee(new U(n))}],[U,function(n){return new Ee(n)}],[String,x,function(n,t){return new Ee(new U(n),t)}],[U,x,function(n,t){return new Ee(n,t)}],[String,l,function(n,t){return new Ee(new U(n),t)}],[U,l,function(n,t){return new Ee(n,t)}]),Oo=tr([wt,function(n){return new S(n.value)}],[String,function(n){return new Ne(new U(n))}],[U,function(n){return new Ne(n)}],[String,Jt,function(n,t){return new Ne(new U(n),t)}],[U,Jt,function(n,t){return new Ne(n,t)}]),eu=tr([ae,function(n){return new N(chroma(n.value))}],[String,function(n){return new Pe(new U(n))}],[U,function(n){return new Pe(n)}],[String,x,function(n,t){return new Pe(new U(n),t)}],[U,x,function(n,t){return new Pe(n,t)}],[String,l,function(n,t){return new Pe(new U(n),t)}],[U,l,function(n,t){return new Pe(n,t)}]),iu=tr([wt,function(n){return new Y(n.value)}],[String,function(n){return new Ie(new U(n))}],[U,function(n){return new Ie(n)}],[String,Jt,function(n,t){return new Ie(new U(n),t)}],[U,Jt,function(n,t){return new Ie(n,t)}]),er=function(n,t){return tr([wt,function(t){return new n(t.value)}],[String,function(n){return new t(new U(n))}],[U,function(n){return new t(n)}],[String,Jt,function(n,e){return new t(new U(n),e)}],[U,Jt,function(n,e){return new t(n,e)}])},nu=er(E,Me),su=er(X,Fe),Ao=er(W,Ye),Fo=tr([wt,function(n){return new O(n.value)}],[String,function(n){return new Xe(new U(n))}],[U,function(n){return new Xe(n)}],[String,Jt,function(n,t){return new Xe(new U(n),t)}],[U,Jt,function(n,t){return new Xe(n,t)}]),Zo=tr([ae,function(n){return new T(n.value)}],[String,function(n){return new Ae(new U(n))}],[U,function(n){return new Ae(n)}],[String,l,function(n,t){return new Ae(new U(n),t)}],[U,l,function(n,t){return new Ae(n,t)}]),ou=function(){var n;return n=1<=arguments.length?Uu.call(arguments,0):[],new xe(ui(n))},$o=function(n){return null==n&&(n=0),new Mt(n)},Go=function(){var n,t,e,i,r,o,u,a,s;return i=1<=arguments.length?Uu.call(arguments,0):[],r=Lr(i,Tt),o=Lr(i,Kt),u=Lr(i,ee),n=Lr(i,K),t=Lr(i,Q),a=Lr(i,ce),s=Lr(i,le),e=Lr(i,ct),new St(r,o,u,n,t,a,s,e)},Jo=function(){var n,t,e,i,r,o,u,a,s;return r=1<=arguments.length?Uu.call(arguments,0):[],o=Lr(r,Tt),s=Lr(r,Le),e=Lr(r,ot),n=Lr(r,K),t=Lr(r,Q),u=Lr(r,ce),a=Lr(r,le),i=Lr(r,ct),new It(o,s,e,n,t,u,a,i)},Do=function(){var n,t,e,i,r;return t=1<=arguments.length?Uu.call(arguments,0):[],e=Lr(t,Tt),i=Lr(t,ce),r=Lr(t,le),n=Lr(t,ct),new _t(e,i,r,n)},Ko=function(){var n,t,e,i,r,o,u;return e=1<=arguments.length?Uu.call(arguments,0):[],i=Lr(e,Tt),u=Lr(e,Le),n=Lr(e,ot),r=Lr(e,ce),o=Lr(e,le),t=Lr(e,ct),new zt(i,u,n,r,o,t)},Vo=function(n,t){var e;return e=function(n,t){var i,r,o,u;if(_.isArray(n)){for(r=n.length,o=[];r--;)i=n[r],null!==i&&_.isObject(i)?(e(i,t),o.push(t(i))):o.push(void 0);return o}u=[];for(r in n)Ju.call(n,r)&&(i=n[r],null!==i&&_.isObject(i)?(e(i,t),u.push(t(i))):u.push(void 0));return u},function(i){var r;return r=n.parse(i),e(r,function(n){var t;"CallExpression"===n.type&&"Identifier"===n.callee.type?_.isFunction(po[t=n.callee.name])&&(n.callee={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"plot"},property:{type:"Identifier",name:t}}):"Identifier"===n.type&&_.isFunction(po[t=n.name])&&(delete n.name,n.type="MemberExpression",n.computed=!1,n.object={type:"Identifier",name:"plot"},n.property={type:"Identifier",name:t})}),t.generate(r)}},xo={maxCanvasSize:new te(795,600),visualizationSize:new te(300,300),axisLabelFont:"10px monospace",axisTickColor:"#4d4d4d",axisTitleFont:"bold 10px monospace",axisLabelColor:"#4d4d4d",gridLineColor:"#eee"},cu=function(n){return Math.round(n)+"px"},Ci=function(n,t){var e,i,r,o;e=document.createElement(n),r=e.style;for(i in t)o=t[i],r[i]=o;return e},fu=function(n){for(var t;t=n.firstChild;)n.removeChild(t)},$i=function(n){var t,e,i,r,o,u,a,s;u=function(){var t;t=[];for(o in n)a=n[o],i=function(){var n;n=[];for(r in a)s=a[r],n.push(r+":"+s);return n}(),t.push(o+"{"+i.join(";")+";}");return t}(),t=document.createElement("style"),t.type="text/css",t.innerHTML=u.join("\n"),e=_.head(document.getElementsByTagName("head")),e.appendChild(t)},Ji=function(n){var t,e,i,r,o,u,a;e=document.createElement("table"),e.appendChild(i=document.createElement("tbody"));for(t in n)a=n[t],i.appendChild(u=document.createElement("tr")),u.appendChild(r=document.createElement("td")),r.appendChild(document.createTextNode(t+":")),u.appendChild(o=document.createElement("th")),o.appendChild(document.createTextNode(a));return e},yi=function(n){var t,e,i,r,o,u,a;return a=n.width,o=n.height,r=document.createElement("canvas"),e=r.getContext("2d"),i=window.devicePixelRatio||1,t=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,u=i/t,r.style.position="absolute",i!==t?(r.width=a*u,r.height=o*u,e.scale(u,u),r.style.width=cu(a),r.style.height=cu(o)):(r.width=a,r.height=o),new s(r,e,n,u)},Qi=function(n){var t,e,i,r,o,u,a,s,c,l,h,f;return f=function(){var t,e;for(e=[],a=t=1;5>=t;a=++t)e.push(yi(n));return e}(),t=f[0],o=f[1],u=f[2],l=f[3],i=f[4],r=Ci("div",{position:"relative",overflow:"visible",width:cu(n.width),height:cu(n.height)}),s=Ci("div",{position:"absolute",left:cu(0),top:cu(0),width:cu(0),height:cu(0),display:"none",outline:"1px dotted #999",background:"rgba(0, 0, 0, 0.05)"}),h=Ci("div",{position:"absolute",left:cu(0),top:cu(0),display:"none"}),h.className="lightning-tooltip",r.appendChild(t.element),r.appendChild(o.element),r.appendChild(s),r.appendChild(u.element),r.appendChild(h),c=Ii(l),e=ki(i),new ze(n,r,t,o,u,l,i,s,h,c,e)},Dr=function(n){var t,e,i;return e=null!=(i=n.target)?i:n.srcElement,t=e.getBoundingClientRect(),[n.clientX-t.left,n.clientY-t.top]},ni=function(n,t,e,i,r){var o,u,a,s,c,l,h,f,d,g;u=$(document),o=$(n),s=t.style,c=f=l=d=h=g=0,a=!1,o.on("mousemove",function(n){var t;return c=n.offsetX,f=n.offsetY,(void 0===c||void 0===f)&&(t=Dr(n),c=t[0],f=t[1]),a?(s.left=cu(c>l?l:c),s.top=cu(f>d?d:f),s.width=cu(Math.abs(c-l)),s.height=cu(Math.abs(f-d))):e(c,f)}),o.on("mousedown",function(n){var t;return n.preventDefault(),l=n.offsetX,d=n.offsetY,(void 0===l||void 0===d)&&(t=Dr(n),l=t[0],d=t[1]),a=!0,s.display="block",s.left=cu(l),s.top=cu(d),u.on("mouseup",function(n){var t;return n.preventDefault(),h=n.offsetX,g=n.offsetY,(void 0===h||void 0===g)&&(t=Dr(n),h=t[0],g=t[1]),a=!1,s.display="none",s.width=cu(0),s.height=cu(0),u.off("mouseup"),Math.abs(l-h)>5||Math.abs(d-g)>5?i(l,d,h,g):r(l,d)})})},Wi=function(){var n,t,e;return e={},n=function(n,t){var i;return(i=e[n])?i.push(t):e[n]=[t]},t=function(n,t){var i,r,o,u,a;if(n)if(t){if(o=e[n])for(i=u=0,a=o.length;a>u;i=++u)if(r=o[i],r===t){o.splice(i,1);break}}else delete e[n]},tr=function(){var n,t,i,r,o,u;if(t=arguments[0],n=2<=arguments.length?Uu.call(arguments,1):[],r=e[t])for(o=0,u=r.length;u>o;o++)i=r[o],i.apply(null,n)},[n,t,tr]},Zi=function(n,t,e,i,r,o){var u,a,s,c,l,h,f,d,g,v,p,m,w,b,y,_,k,x,C,q,S,W,O;return O=Qi(n),u=O.baseCanvas,f=O.highlightCanvas,g=O.hoverCanvas,s=O.clipCanvas,m=O.maskCanvas,v=O.marquee,x=O.tooltip,p=O.mask,a=O.clip,C=n.regions.center,S=t.indices,q=void 0,k=function(t,i){var r,o,u,c,l;if(o=p.test(t,i),void 0!==o)for(r=s.context,r.clearRect(0,0,n.width,n.height),c=0,l=e.length;l>c;c++)if(u=e[c],r.save(),r.translate(C.left,C.top),u.mask([o],u.encoders,r,a),r.restore(),a.test(t,i))return o},c=function(n,t,e){var i;return i=Ji(e),fu(x),x.appendChild(i),x.style.display="block",w(n,t)},W=7,w=function(t,e){var i,r,o,u;return u=x.clientWidth,o=x.clientHeight,i=t+W,r=e-W-o,i+u>n.width&&(i=t-W-u),0>r&&(r=e+W),x.style.left=cu(i),x.style.top=cu(r)},l=function(){return x.style.display="none"},d=function(i,r){var u,a,s,h,f,d,v,p,m,b,y,_;if(h=k(i,r),h!==q){if(q=h,s=g.context,s.clearRect(0,0,n.width,n.height),l(),void 0!==h){for(s.save(),s.translate(C.left,C.top),p=0,b=e.length;b>p;p++)f=e[p],f.highlight([h],f.encoders,s);for(s.restore(),o("hover",new ut(t.vectors,h)),d={},m=0,y=e.length;y>m;m++){f=e[m],_=f.encodings;for(u in _)a=_[u],a&&(v=a.vector)&&(d[v.label]=v.format(h))}c(i,r,d)}}else w(i,r)},h=function(t){var i,r,o,a;if(i=f.context,i.clearRect(0,0,n.width,n.height),t.length){for(u.element.style.opacity=.5,i.save(),i.translate(C.left,C.top),o=0,a=e.length;a>o;o++)r=e[o],r.highlight(t,r.encoders,i),r.render(t,r.encoders,i);i.restore()}else u.element.style.opacity=1},y=function(n,e){var i;i=k(n,e),void 0!==i?(h([i]),o("select",new Ht(t.vectors,[i]))):(h([]),o("deselect",new j(t.vectors)))},_=function(n,i,r,u){var a,s,c,l,f,d,g,v;for(l=-C.left+(n>r?r:n),c=-C.left+(n>r?n:r),d=-C.top+(i>u?u:i),f=-C.top+(i>u?i:u),g=0,v=e.length;v>g;g++)a=e[g],s=a.select(S,a.encoders,l,d,c,f),h(s),s.length?o("select",new Ht(t.vectors,s)):o("deselect",new j(t.vectors))},b=function(){var t,o,a,s,c;for(t=u.context,a=m.context,bu(t,i,C),yu(t,r,C),t.save(),t.translate(C.left,C.top),a.save(),a.translate(C.left,C.top),s=0,c=e.length;c>s;s++)o=e[s],o.render(S,o.encoders,t),o.mask(S,o.encoders,a,p);a.restore(),t.restore(),gu(t,i,n.regions.bottom),vu(t,r,n.regions.left)},ni(g.element,v,d,_,y),new Re(O,t,k,h,d,y,_,b)},du=function(n,t,e,i,r){var o,u,a,s,l,h,f,d,g,v,p,m,w,b,y,_,k,x;if(n.font=xo.axisLabelFont,n.fillStyle=xo.axisLabelColor,n.strokeStyle=xo.axisTickColor,n.textBaseline="middle",m=Lu+4,l=e-m,n.save(),ii(n,m,0,l,i),n.textAlign="right",p=e-5,a=e-6,t instanceof c){for(k=t.guide(),w=0,y=k.length;y>w;w++)o=k[w],u=o.value,d=t.scale(o),v=-.5+Math.round(d),rr(n,p,v,e,v),n.fillText(u,a,d,l-6);rr(n,e-.5,0,e-.5,i)}else{if(!(t instanceof lt))throw new Error("Invalid axis type.");for(f=6,h=i-6,x=t.guide(),b=0,_=x.length;_>b;b++)g=x[b],u=g.label,d=t.scale(g.value),v=Math.max(.5,-.5+Math.round(d)),rr(n,p,v,e,v),s=f>d?f:d>h?h:d,n.fillText(u,a,s,l-6);rr(n,e-.5,0,e-.5,i)}return n.restore(),n.font=xo.axisTitleFont,n.textAlign="center",n.translate(m/2,i/2),n.rotate(r*it),n.fillText(t.label,0,0,i),n.restore()},wu=function(n,t,e,i){var r,o,u,a,s;if(n.strokeStyle=xo.gridLineColor,t instanceof c)rr(n,0,.5,e,.5),rr(n,0,i-.5,e,i-.5);else if(t instanceof lt)for(s=t.guide(),u=0,a=s.length;a>u;u++)r=s[u],o=Math.max(.5,-.5+Math.round(t.scale(r.value))),rr(n,0,o,e,o)},bu=function(n,t,e){return n.save(),n.translate(e.left,e.top+e.height),n.rotate(-it),wu(n,t,e.height,e.width),n.restore()},yu=function(n,t,e){return n.save(),n.translate(e.left,e.top),wu(n,t,e.width,e.height),n.restore()},gu=function(n,t,e){return n.save(),n.translate(e.left,e.top+e.height),n.rotate(-it),du(n,t,e.height,e.width,1),n.restore()},vu=function(n,t,e){return n.save(),n.translate(e.left,e.top),du(n,t,e.width,e.height,-1),n.restore()},li=function(n,t){var e,i,r,o,u,a,s,c,l;return 0<=(a=n.indexOf(" "))?(c=n.substr(0,a),e=n.substr(a)):c=n,l=c.split(/\.+/g),s=l[0],r=2<=l.length?Uu.call(l,1):[],0===s.indexOf("#")&&(u=s.substr(1),s="div"),""===s&&(s="div"),i="<"+s,u&&(i+=" id='"+u+"'"),r.length&&(i+=" class='"+r.join(" ")+"'"),e&&(i+=e),i+=">",o="</"+s+">","="===t?function(n){return i+(null!==n&&void 0!==n?n:"")+o}:"+"===t?function(n,t){var e;return e=i.replace("{0}",t),e+n+o}:function(n){return i+n.join("")+o}},Hu={},Xi=function(){var n,t,e,i,r,o,u;for(e=1<=arguments.length?Uu.call(arguments,0):[],u=[],r=0,o=e.length;o>r;r++)t=e[r],(n=Hu[t])?u.push(n):(i=t.charAt(0),u.push("="===i||"+"===i?Hu[t]=li(t.substr(1),i):Hu[t]=li(t)));return u},_u=function(n){var t;return t=document.createElement("div"),t.innerHTML=n,t.childNodes[0]},Hi=function(n){var t,e,i,r,o,u;for(e=null,t=null,u=null,r=0,o=n.length;o>r;r++)if(i=n[r],null===e)switch(e=i.type){case _e:u=i,t=i.domain;break;case we:t=i.domain;break;default:throw new Error("ni")}else{if(e!==i.type)throw new Error("Incompatible axis vector ["+i.label+"]. Expect type ["+e+"], got ["+i.type+"]");switch(e){case _e:if(u!==i)throw new Error("Incompatible categorical vector ["+i.label+"]. Expected ["+u.label+"].");break;case we:t=ci(t,i.domain);break;default:throw new Error("ni")}}return new re(e,n,t)},bi=function(n){var t,e;return t=function(){var t,i,r;for(r=[],t=0,i=n.length;i>t;t++)e=n[t],r.push(e.label);return r}(),t.join(", ")},hi=function(n,t){var e,i,r,o,a,s,l,h,f,d,g,v,p;if(l=new Pt(0,0,400,400),e=wi(n,"",t,new Jt(0,l.width),l),s=Lu+4+6+10,e instanceof c){for(a=0,i=e.guide(),f=0,g=i.length;g>f;f++)r=i[f],a<(o=(""+r.value).length)&&(a=o);return new u(Math.ceil(a*Lu+s),Math.ceil(i.length*(Lu+8)))}if(e instanceof lt){for(a=0,i=e.guide(),p=e.guide(),d=0,v=p.length;v>d;d++)h=p[d],a<(o=h.label.length)&&(a=o);return new u(Math.ceil(a*Lu+s),xo.visualizationSize.height)}throw new Error("Invalid axis type.")},wi=function(n,t,e,i,r){var o,u,a,s,l;switch(n){case _e:return u=ji(e,i),o=function(){return e},new c(n,t,u,e,i,r,o);case we:return l=Fi(e,i),u=l[0],a=l[1],s=l[2],o=function(n){var t,e,i,r,o,u;for(null==n&&(n=10),t=a(n),o=s(n),u=[],i=0,r=o.length;r>i;i++)e=o[i],u.push(new Se(e,t(e)));return u},new lt(n,t,u,e,i,r,o);default:throw new Error("Unhandled axis type ["+n+"].")}},Tu=function(n,t){var e,i;return i=Bi(t),e=hu(n,i),console.debug(e),Lr(t,xe)?Ou(e,t):Lr(t,Mt)?qu(e,t):xu(e,t)},qu=function(n,t){var e,i,r,o,u,a,s,c,l,h,f,d,g,v,p,m;return u=Lr(t,Mt),r=u.index,m=Xi("=table.lightning-record","tbody","tr","=th","=td"),s=m[0],c=m[1],f=m[2],h=m[3],l=m[4],d=function(){var t,e;t=n.schema,e=[];for(o in t)p=t[o],v=p.format(r),i=function(){switch(p.type){case _e:return void 0!==v?_.escape(v):"-";case we:return void 0!==v?_.escape(v):"-";case be:return void 0!==v?v:"-";default:throw new Error("Cannot render table cell of type "+p.type)}}(),e.push(f([h(_.escape(p.label)),l(i)]));return e}(),e=_u(s(c(d))),a=_.noop,g=_.noop,new Ct(e,a,g)},Ou=function(n,t){var e,i,r,o,u,a,s,c,l,h,f,d,g,v,p,m,w,b,y,k,x,C;return a=Lr(t,xe),k=function(){var t,e,r,o;if(a.fields.length){for(r=a.fields,o=[],t=0,e=r.length;e>t;t++)i=r[t],o.push(n.evaluate(i));return o}return n.vectors}(),x=_.flatten(k),C=Xi("table.lightning-table","=thead","tbody","tr","=th","=th.lightning-number","=td","=td.lightning-number"),u=C[0],d=C[1],s=C[2],p=C[3],f=C[4],g=C[5],c=C[6],l=C[7],v=function(){var n,t,e;for(e=[],n=0,t=x.length;t>n;n++)switch(y=x[n],y.type){case we:e.push(g(_.escape(y.label)));break;default:e.push(f(_.escape(y.label)))}return e}(),m=function(){var t,e,i,o;for(i=n.indices,o=[],t=0,e=i.length;e>t;t++)r=i[t],h=function(){var n,t,e;for(e=[],n=0,t=x.length;t>n;n++)switch(y=x[n],b=y.format(r),y.type){case _e:e.push(c(void 0!==b?_.escape(b):"-"));break;case we:e.push(l(void 0!==b?_.escape(b):"-"));break;case be:e.push(c(void 0!==b?b:"-"));break;default:throw new Error("Cannot render table cell of type "+y.type)}return e}(),o.push(p(h));return o}(),e=_u(u([d(p(v)),s(m)])),o=_.noop,w=_.noop,new Ct(e,o,w)},xu=function(n,t){var e,i,r,o,s,c,l,h,f,d,g,v,p,m,w,b,y,k,x,C,q,S,W,O;
return v=_.map(Rr(t,vt),function(t){var e,i;return i=function(){var i,r,o,u;for(o=t.position.coordinates,u=[],i=0,r=o.length;r>i;i++)e=o[i],u.push(n.evaluate(e.field));return u}(),Pi(t,_.flatten(i))}),y=_.map(v,function(n){return n.space}),C=Vr(y,function(n){return n.x}),q=Vr(y,function(n){return n.y}),w=Hi(C),b=Hi(q),f=w.type===we&&b.type===_e?Qr(w.domain):w.domain,d=b.type===we&&w.type===_e?Qr(b.domain):b.domain,e=hi(w.type,f),i=hi(b.type,d),l=null!=(W=Lr(t,u))?W:new u(Math.min(xo.maxCanvasSize.width,i.width+e.height),Math.min(xo.maxCanvasSize.height,e.width+i.height)),h=new a(l.width,l.height,new dt(Math.min(.3*xo.maxCanvasSize.width,i.width),0,0,Math.min(.3*xo.maxCanvasSize.height,e.width))),r=h.regions.bottom,o=h.regions.left,p=new Jt(0,r.width),m=b.type===we?new Jt(o.height,0):new Jt(0,o.height),s=wi(w.type,bi(C),f,p,r),c=wi(b.type,bi(q),d,m,o),g=_.map(v,function(t){var e,i,r,o,u;r=t.geometry,i=r.encode(n,t,s,c),e={};for(o in i)u=i[o],(null!=u?u.encode:void 0)&&(e[o]=u.encode);return new at(i,e,r.mask,r.highlight,r.render,r.select)}),O=Wi(),k=O[0],x=O[1],tr=O[2],S=Zi(h,n,g,s,c,tr),S.render(),new Ct(S.viewport.container,k,x)},ju=tr([P,Array,Function,function(n,t,e){return n.read(function(n,i){return n?e(n):ju(i,t,e)})}],[Z,Array,Function,function(n,t,e){var i;try{return e(null,Tu(n,t))}catch(r){return i=r,e(i)}}]),oo=function(){return $i({".lightning-tooltip":{background:"#2c2c2c",color:"#fff","font-size":"12px"},".lightning-tooltip th, .lightning-tooltip td":{padding:"0px 4px","vertical-align":"middle"},".lightning-tooltip th":{"text-align":"left"},".lightning-table th, .lightning-table td":{padding:"0px 8px","vertical-align":"middle"},".lightning-table tbody > tr:nth-child(odd)":{"background-color":"#f3f3f3"},".lightning-table .lightning-number":{"text-align":"right"},".lightning-record th, .lightning-record td":{padding:"0px 8px","vertical-align":"middle"},".lightning-record th":{"text-align":"right"},".lightning-record tbody > tr:nth-child(odd)":{"background-color":"#f3f3f3"}})},Du=null,Lu=18,ro=function(){var n,t;return Du=n=yi(new u(100,100)),t=n.context,t.font=xo.axisLabelFont,Lu=t.measureText("M").width},Vu=!1,io=function(){return Vu?void 0:(oo(),ro(),Vu=!0)},po=function(){var n,t;return t=1<=arguments.length?Uu.call(arguments,0):[],(n=Lr(t,P,Z))?(io(),function(e){return ju(n,_.without(t,n),e)}):function(){var n;return n=1<=arguments.length?Uu.call(arguments,0):[],po.apply(null,t.concat(n))}},po.VERSION="0.1.4",po.from=To,po.value=uu,po.domain=Co,po.range=Uo,po.position=Ho,po.fillColor=Wo,po.fillOpacity=Oo,po.strokeColor=eu,po.strokeOpacity=iu,po.size=nu,po.width=su,po.height=Ao,po.lineWidth=Fo,po.shape=Zo,po.factor=So,po.stack=tu,po.groupBy=No,po.select=Qo,po.where=au,po.having=Xo,po.eq=qo,po.ne=Bo,po.lt=jo,po.gt=Yo,po.le=Po,po.ge=Eo,po.like=Io,po.avg=_o,po.count=ko,po.max=zo,po.min=Ro,po.sum=ru,po.parse=Vo,po.point=Go,po.rect=Jo,po.path=Do,po.schema=Ko,po.table=ou,po.record=$o,po.createFrame=Yi,po.createVector=Ki,po.createList=Mi,po.createFactor=Ti,null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=po:window.plot=po}).call(this);
