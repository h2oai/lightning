(function(){var n,t,e,i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,x,C,q,S,W,O,T,E,N,Y,X,M,P,A,I,F,j,z,R,B,L,V,D,G,H,U,J,K,Q,Z,nt,tt,et,it,rt,ot,ut,at,st,ct,lt,ft,ht,dt,gt,vt,pt,mt,wt,bt,yt,kt,_t,xt,Ct,qt,St,Wt,Ot,Tt,Et,Nt,Yt,Xt,Mt,Pt,At,It,Ft,jt,zt,Rt,Bt,Lt,Vt,Dt,Gt,Ht,Ut,$t,Jt,Kt,Qt,Zt,ne,te,ee,ie,re,oe,ue,ae,se,ce,le,fe,he,de,ge,ve,pe,me,we,be,ye,ke,_e,xe,Ce,qe,Se,We,Oe,Te,Ee,Ne,Ye,Xe,Me,Pe,Ae,Ie,Fe,je,ze,Re,Be,Le,Ve,De,Ge,He,Ue,$e,Je,Ke,Qe,Ze,ni,ti,ei,ii,ri,oi,ui,ai,si,ci,li,fi,hi,di,gi,vi,pi,mi,wi,bi,yi,ki,_i,xi,Ci,qi,Si,Wi,Oi,Ti,Ei,Ni,Yi,Xi,Mi,Pi,Ai,Ii,Fi,ji,zi,Ri,Bi,Li,Vi,Di,Gi,Hi,Ui,$i,Ji,Ki,Qi,Zi,nr,tr,er,ir,rr,or,ur,ar,sr,cr,lr,fr,hr,dr,gr,vr,pr,mr,wr,br,yr,kr,_r,xr,Cr,qr,Sr,Wr,Or,Tr,Er,Nr,Yr,Xr,Mr,Pr,Ar,Ir,Fr,jr,zr,Rr,Br,Lr,Vr,Dr,Gr,Hr,Ur,$r,Jr,Kr,Qr,Zr,no,to,eo,io,ro,oo,uo,ao,so,co,lo,fo,ho,go,vo,po,mo,wo,bo,yo,ko,_o,xo,Co,qo,So,Wo,Oo,To,Eo,No,Yo,Xo,Mo,Po,Ao,Io,Fo,jo,zo,Ro,Bo,Lo,Vo,Do,Go,Ho,Uo,$o,Jo,Ko,Qo,Zo,nu,tu,eu,iu,ru,ou,uu,au,su,cu,lu,fu,hu,du,gu,vu,pu,mu,wu,bu,yu,ku,_u,xu,Cu,qu,Su,Wu,Ou,Tu,Eu,Nu,Yu,Xu,Mu,Pu,Au,Iu,Fu,ju,zu,Ru,Bu,Lu,Vu=[].slice,Du=function(n,t){function e(){this.constructor=n}for(var i in t)Gu.call(t,i)&&(n[i]=t[i]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n},Gu={}.hasOwnProperty;Fu=Math.PI,ju=2*Fu,it=Fu/2,Iu=1e-6,V=Iu*Iu,Xt=Fu/180,F=180/Fu,xe=Math.tan(30*Xt),oe=Math.sqrt(3),y=16581375,Se="transparent",ke="undefined",pe="null",he="Boolean",ye="String",me="Number",ve="Function",we="Object",fe="Array",le="Arguments",de="Date",be="RegExp",ge="Error",Pu=function(n){var t;if(t=Object.prototype.toString.call(n),null===n)return pe;if(void 0===n)return ke;if(n===!0||n===!1||"[object Boolean]"===t)return he;switch(t){case"[object String]":return ye;case"[object Number]":return me;case"[object Function]":return ve;case"[object Object]":return we;case"[object Array]":return fe;case"[object Arguments]":return le;case"[object Date]":return de;case"[object RegExp]":return be;case"[object Error]":return ge;default:return t}},mt=function(){function n(n,t){this.match=n,this.func=t}return n}(),nr=function(){var n,t;return n=function(t){var e,i,r;switch(i=Pu(t)){case ke:return function(n){return void 0===n};case pe:return function(n){return null===n};case he:return function(n){return t===Boolean||n===t};case ye:return function(n){return t===String||n===t};case me:return function(n){return t===Number||n===t||_.isNaN(n)&&_.isNaN(t)};case be:return function(){return t===RegExp};case Error:return function(){return t===Error};case de:return function(n){return t===Date||n===t};case fe:return 1===t.length&&ve===(r=Pu(t[0]))?(e=n(t[0]),function(n){var t,i,r;if(fe!==Pu(n))return!1;for(i=0,r=n.length;r>i;i++)if(t=n[i],!e(t))return!1;return!0}):function(n){return t===Array||Je(t,n)};case ve:return function(n){var e;return n instanceof t?!0:n&&n.constructor===t?!0:(e=Pu(n),t===Boolean&&e===he||t===String&&e===ye||t===Number&&e===me)};case we:return function(n){var e,i;for(e in t)if(i=t[e],n[e]!==i)return!1;return!0};default:return function(){return!1}}},t=function(t){var e;return e=_.map(t,n),function(n){var t,i,r,o;if(0===n.length)return!1;if(n.length!==e.length)return!1;for(i=r=0,o=e.length;o>r;i=++r)if(t=e[i],!t(n[i]))return!1;return!0}},function(){var n,e;return n=1<=arguments.length?Vu.call(arguments,0):[],e=_.map(n,function(n){var e,i,r;return i=2<=n.length?Vu.call(n,0,r=n.length-1):(r=0,[]),e=n[r++],new mt(t(i),e)}),function(){var n,t,i,r;for(n=1<=arguments.length?Vu.call(arguments,0):[],i=0,r=e.length;r>i;i++)if(t=e[i],t.match(n))return t.func.apply(null,n);throw new Error("Pattern match failure for args [ "+_.map(n,function(n){return""+n+":"+Pu(n)}).join(", ")+" ]")}}}(),g=function(){function n(n,t){this.put=n,this.test=t}return n}(),pt=function(){function n(n,t){this.put=n,this.test=t}return n}(),ne=function(){function n(n,t){this.width=n,this.height=t}return n}(),Pt=function(){function n(n,t,e,i){this.left=n,this.top=t,this.width=e,this.height=i}return n}(),Fe=function(){function n(n,t,e,i,r,o,u){this.name=n,this.label=t,this.type=e,this.at=i,this.count=r,this.domain=o,this.format=u}return n}(),G=function(n){function t(n,e,i,r,o,u,a,s){this.valueAt=o,t.__super__.constructor.call(this,n,e,i,r,u,a,s)}return Du(t,n),t}(Fe),ft=function(n){function t(n,e,i,r,o,u){t.__super__.constructor.call(this,n,e,we,i,r,o,u)}return Du(t,n),t}(Fe),tt=function(){function n(){}return n}(),Z=function(){function n(n,t,e,i,r,o,u,a,s){this.label=n,this.vectors=t,this.schema=e,this.indices=i,this.cube=r,this.at=o,this.evaluate=u,this.attach=a,this.metadata=s}return n}(),We=function(){function n(n){this.value=n}return n}(),wt=function(n){function t(n){t.__super__.constructor.call(this,n)}return Du(t,n),t}(We),ue=function(n){function t(n){t.__super__.constructor.call(this,n)}return Du(t,n),t}(We),I=function(n){function t(n){t.__super__.constructor.call(this,n)}return Du(t,n),t}(We),o=function(n){function t(n){t.__super__.constructor.call(this,n)}return Du(t,n),t}(We),U=function(){function n(n){this.name=n}return n}(),ht=function(n){function t(n){this.evaluate=n}return Du(t,n),t}(U),It=function(n){function t(n){this.evaluate=n}return Du(t,n),t}(U),J=function(){function n(n,t){this.color=n,this.opacity=t}return n}(),ae=function(){function n(n,t,e){this.color=n,this.opacity=t,this.size=e}return n}(),_e=function(){function n(){}return n}(),vt=function(){function n(){}return n}(),St=function(n){function t(n,t,e,i,r,o,u,a){this.position=n,this.shape=t,this.size=e,this.fillColor=i,this.fillOpacity=r,this.strokeColor=o,this.strokeOpacity=u,this.lineWidth=a}return Du(t,n),t}(vt),kt=function(n){function t(n,t,e,i){this.position=n,this.strokeColor=t,this.strokeOpacity=e,this.lineWidth=i}return Du(t,n),t}(vt),jt=function(n){function t(n,t,e,i){this.position=n,this.strokeColor=t,this.strokeOpacity=e,this.lineWidth=i}return Du(t,n),t}(vt),At=function(n){function t(n,t,e,i,r,o,u,a){this.position=n,this.width=t,this.height=e,this.fillColor=i,this.fillOpacity=r,this.strokeColor=o,this.strokeOpacity=u,this.lineWidth=a}return Du(t,n),t}(vt),gt=function(){function n(){}return n}(),Ot=function(n){function t(n,t,e,i,r,o,u,a,s,c){this.space=n,this.positionX=t,this.positionY=e,this.shape=i,this.size=r,this.fillColor=o,this.fillOpacity=u,this.strokeColor=a,this.strokeOpacity=s,this.lineWidth=c,this.geometry=Wt}return Du(t,n),t}(gt),Bt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.space=n,this.q0=t,this.q1=e,this.q2=i,this.q3=r,this.qn=o,this.positionY=u,this.height=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=Rt}return Du(t,n),t}(gt),Dt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.space=n,this.positionX=t,this.q0=e,this.q1=i,this.q2=r,this.q3=o,this.qn=u,this.width=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=Vt}return Du(t,n),t}(gt),m=function(n){function t(n,t,e,i,r,o,u,a,s,c){this.space=n,this.positionX=t,this.positionY1=e,this.positionY2=i,this.width=r,this.fillColor=o,this.fillOpacity=u,this.strokeColor=a,this.strokeOpacity=s,this.lineWidth=c,this.geometry=p}return Du(t,n),t}(gt),r=function(n){function t(n,t,e,r,o,u,a,s,c,l){this.space=n,this.positionX1=t,this.positionX2=e,this.positionY=r,this.height=o,this.fillColor=u,this.fillOpacity=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=i}return Du(t,n),t}(gt),xt=function(n){function t(n,t,e,i,r,o){this.space=n,this.positionX=t,this.positionY=e,this.strokeColor=i,this.strokeOpacity=r,this.lineWidth=o,this.geometry=_t}return Du(t,n),t}(gt),Ce=function(n){function t(n,t,e,i,r,o,u){this.space=n,this.positionX=t,this.positionY=e,this.text=i,this.size=r,this.fillColor=o,this.fillOpacity=u,this.geometry=TextGeometry}return Du(t,n),t}(gt),L=function(){function n(){}return n}(),qt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.positionX=n,this.positionY=t,this.shape=e,this.size=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Du(t,n),t}(L),zt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.q0=n,this.q1=t,this.q2=e,this.q3=i,this.qn=r,this.positionY=o,this.height=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Du(t,n),t}(L),Lt=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.positionX=n,this.q0=t,this.q1=e,this.q2=i,this.q3=r,this.qn=o,this.width=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Du(t,n),t}(L),v=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.positionX=n,this.positionY1=t,this.positionY2=e,this.width=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Du(t,n),t}(L),e=function(n){function t(n,t,e,i,r,o,u,a,s,c,l){this.positionX1=n,this.positionX2=t,this.positionY=e,this.height=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Du(t,n),t}(L),yt=function(n){function t(n,t,e,i,r,o){this.positionX=n,this.positionY=t,this.stroke=e,this.strokeColor=i,this.strokeOpacity=r,this.lineWidth=o}return Du(t,n),t}(L),re=function(){function n(n,t){this.x=n,this.y=t}return n}(),ie=function(){function n(n,t,e){this.type=n,this.vectors=t,this.domain=e}return n}(),t=function(){function n(){}return n}(),c=function(n){function t(n,t,e,i,r,o,u){this.type=n,this.label=t,this.scale=e,this.domain=i,this.range=r,this.rect=o,this.guide=u}return Du(t,n),t}(t),lt=function(n){function t(n,t,e,i,r,o,u){this.type=n,this.label=t,this.scale=e,this.domain=i,this.range=r,this.rect=o,this.guide=u}return Du(t,n),t}(t),qe=function(){function n(n,t){this.value=n,this.label=t}return n}(),B=function(){function n(n,t){this.label=n,this.encode=t}return n}(),C=function(n){function t(n){this.value=n,t.__super__.constructor.call(this,"Constant",$e(value))}return Du(t,n),t}(B),Oe=function(n){function t(n,e,i){this.vector=i,t.__super__.constructor.call(this,n,e)}return Du(t,n),t}(B),Et=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return Du(t,n),t}(Oe),b=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return Du(t,n),t}(Oe),bt=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return Du(t,n),t}(Oe),ee=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return Du(t,n),t}(Oe),Kt=function(n){function t(n,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,t.__super__.constructor.call(this,n,e,i)}return Du(t,n),t}(Oe),d=function(){function n(){}return n}(),w=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),M=function(n){function t(n){this.field=n}return Du(t,n),t}(d),Tt=function(n){function t(n){this.coordinates=n}return Du(t,n),t}(d),K=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),Q=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),se=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),ce=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),te=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),Be=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),ot=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),ct=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),Jt=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(d),q=function(n){function t(n){this.value=n}return Du(t,n),t}(K),Te=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(K),S=function(n){function t(n){this.value=n}return Du(t,n),t}(Q),Ee=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(Q),N=function(n){function t(n){this.value=n}return Du(t,n),t}(se),Pe=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(se),Y=function(n){function t(n){this.value=n}return Du(t,n),t}(ce),Ae=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(ce),E=function(n){function t(n){this.value=n}return Du(t,n),t}(te),Me=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(te),X=function(n){function t(n){this.value=n}return Du(t,n),t}(Be),Ie=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(Be),W=function(n){function t(n){this.value=n}return Du(t,n),t}(ot),Ne=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(ot),O=function(n){function t(n){this.value=n}return Du(t,n),t}(ct),Ye=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(ct),T=function(n){function t(n){this.value=n}return Du(t,n),t}(Jt),Xe=function(n){function t(n,t){this.field=n,this.range=t}return Du(t,n),t}(Jt),D=function(){function n(n,t){this.min=n,this.max=t}return n}(),Mt=function(){function n(){}return n}(),l=function(n){function t(n){this.values=n}return Du(t,n),t}(Mt),Nt=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(Mt),$t=function(n){function t(n,t){this.min=n,this.max=t}return Du(t,n),t}(Nt),R=function(n){function t(n,t,e){this.min=n,this.mid=t,this.max=e}return Du(t,n),t}(Nt),x=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return Du(t,n),t}(Mt),Ut=function(n){function t(n,t){this.min=n,this.max=t}return Du(t,n),t}(x),z=function(n){function t(n,t,e){this.min=n,this.mid=t,this.max=e}return Du(t,n),t}(x),nt=function(){function n(n,t,e,i,r){this.encode=n,this.mask=t,this.highlight=e,this.render=i,this.select=r}return n}(),A=function(){function n(n){this.read=n}return n}(),s=function(){function n(n,t,e,i){this.element=n,this.context=t,this.bounds=e,this.ratio=i}return n}(),je=function(){function n(n,t,e,i,r,o,u,a,s,c,l){this.box=n,this.container=t,this.baseCanvas=e,this.highlightCanvas=i,this.hoverCanvas=r,this.maskCanvas=o,this.clipCanvas=u,this.marquee=a,this.tooltip=s,this.mask=c,this.clip=l}return n}(),at=function(){function n(n,t,e,i,r,o){this.encodings=n,this.encoders=t,this.mask=e,this.highlight=i,this.render=r,this.select=o}return n}(),ze=function(){function n(n,t,e,i,r,o,u,a){this.viewport=n,this.frame=t,this.test=e,this.highlight=i,this.hover=r,this.selectAt=o,this.selectWithin=u,this.render=a}return n}(),Ct=function(){function n(n,t,e){this.element=n,this.subscribe=t,this.unsubscribe=e}return n}(),u=function(){function n(n,t){this.width=n,this.height=t}return n}(),Ft=function(){function n(n,t,e,i,r){this.center=n,this.left=t,this.top=e,this.right=i,this.bottom=r}return n}(),dt=function(){function n(n,t,e,i){this.left=n,this.top=t,this.right=e,this.bottom=i}return n}(),a=function(){function n(n,t,e){var i;this.width=n,this.height=t,this.margin=e,this.regions=new Ft(i=new Pt(margin.left,margin.top,width-margin.left-margin.right,height-margin.top-margin.bottom),new Pt(0,margin.top,margin.left,i.height),new Pt(margin.left+i.width,margin.top,margin.right,i.height),new Pt(margin.left,0,i.width,margin.top),new Pt(margin.left,margin.top+i.height,i.width,margin.bottom))}return n}(),Yt=function(){function n(n,t,e,i){this.select=n,this.where=t,this.group=e,this.having=i}return n}(),f=function(){function n(n,t){this.key=n,this.value=t}return n}(),n=new f(0,"All"),P=function(){function n(n,t,e,i){this.frame=n,this.hierarchy=t,this.cells=e,this.dimension=i}return n}(),st=function(){function n(n,t,e){this.category=n,this.indices=t,this.children=e}return n}(),h=function(){function n(n,t){this.levels=n,this.indices=t}return n}(),H=function(){function n(n,t,e,i,r){this.at=n,this.valueAt=t,this.count=e,this.domain=i,this.format=r}return n}(),et=function(){function n(n){this.fields=n}return n}(),Ht=function(){function n(n,t,e){this.name=n,this.fields=t,this.func=e}return n}(),Re=function(){function n(n,t){this.fields=n,this.predicate=t}return n}(),rt=function(){function n(n,t){this.fields=n,this.predicate=t}return n}(),ut=function(){function n(n,t){this.vectors=n,this.index=t}return n}(),Gt=function(){function n(n,t){this.vectors=n,this.indices=t}return n}(),j=function(){function n(n){this.vectors=n}return n}(),Xu=function(n){return n*n},ti=function(n,t){return function(e){return n>e?n:e>t?t:e}},ni=ti(0,1),Zi=8,vi=function(n){return n.slice(0)},Vr=function(n,t){var e,i,r,o,u,a,s,c;for(r=[],o=0,a=n.length;a>o;o++)for(e=n[o],c=t(e),u=0,s=c.length;s>u;u++)i=c[u],r.push(i);return r},ho=function(){var n,t;return t=arguments[0],n=2<=arguments.length?Vu.call(arguments,1):[],function(){return t.apply(null,n)}},$e=function(n){return function(){return n}},Je=function(n,t){var e,i,r,o;if(n&&t&&n.length===t.length){for(e=r=0,o=n.length;o>r;e=++r)if(i=n[e],i!==t[e])return!1;return!0}return!1},Rr=function(){var n,t,e,i,r,o,u,a,s;for(t=arguments[0],r=2<=arguments.length?Vu.call(arguments,1):[],e=[],o=0,a=t.length;a>o;o++)for(n=t[o],u=0,s=r.length;s>u;u++)i=r[u],n instanceof i&&e.push(n);return e},Lr=function(){var n,t,e,i,r,o,u,a;for(t=arguments[0],i=2<=arguments.length?Vu.call(arguments,1):[],r=0,u=t.length;u>r;r++)for(n=t[r],o=0,a=i.length;a>o;o++)if(e=i[o],n instanceof e)return n},Wi=function(n,t){return t>n?new D(n,t):new D(t,n)},fi=function(n){var t,e,i,r,o;for(e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,r=0,o=n.length;o>r;r++)i=n[r],void 0!==i&&(e>=i&&(e=i),i>=t&&(t=i));return new D(e,t)},gi=function(n){return function(t){return t.min>=n&&t.max>n?1:t.min<n&&t.max<=n?-1:0}},di=gi(0),si=function(n,t){return new D(Math.min(n.min,t.min),Math.max(n.max,t.max))},Zr=function(n){return function(t){return t.min>n&&t.max>n?new D(n,t.max):t.min<n&&t.max<n?new D(t.min,n):t}},Qr=Zr(0),Mi=function(n,t,e){var i,r,o;return r=function(){return t.length},i=function(n){return t[n]},o=e?function(n){return e(t[n])}:i,new ft(n,n,i,r,t,o)},Ji=function(n,t,e,i){var r,o,u,a;return u=fi(e),o=function(){return e.length},r=function(n){return e[n]},a=i?function(n){return i(e[n])}:r,new Fe(n,n,t,r,o,u,a)},zr=function(n,t,e){var i,r,o,u,a,s,c,l,h,d,g,v,p;for(p=0,g={},l=t(),o=new Array(l),u=function(){var n,t,i;for(i=[],n=0,t=e.length;t>n;n++)h=e[n],i.push(g[h]=new f(p++,h));return i}(),c=v=0;l>=0?l>v:v>l;c=l>=0?++v:--v)a=n(c),h=void 0!==a?a:"?",(r=g[h])||u.push(g[h]=r=new f(p++,h)),o[c]=r;return i=function(n){return o[n]},d=function(n){return o[n].value},s=function(n){return o[n].value},new H(i,d,t,u,s)},Oi=function(n,t,e,i){var r,o,u;return o=function(){return e.length},r=function(n){return e[n]},u=zr(r,o,i||[]),new G(n,n,t,u.at,u.valueAt,o,u.domain,u.format)},Ni=function(n,t,e,i,r){var o,u;return u=_.indexBy(t,function(n){return n.name}),o=new Z(n,t,u,e,i,null,null,null,r||{}),o.evaluate=function(t){var e;if(t instanceof ht)return o.evaluate(t.evaluate(o));if(t instanceof It){if(i)return o.evaluate(t.evaluate(o,i));throw new Error("Cannot compute aggregate ["+t.name+"] on an unaggregated frame.")}if(e=u[t.name])return e;throw new Error("Vector ["+t.name+"] does not exist in frame ["+n+"].")},o.attach=function(e){if(u[e.name])throw new Error("Cannot attach vector ["+e.name+"]: a vector by that name already exists in frame ["+n+"]");return t.push(e),u[e.name]=e,e},o.exists=function(n){return u[n]?!0:!1},o},mr=function(n){var t,e,i,r,o,u,a,s,c,l,f;for(u=new Array(n.indices.length),e=_.map(n.vectors,function(n){return n instanceof G?n.valueAt:n.at}),f=n.indices,a=0,c=f.length;c>a;a++)for(i=f[a],u[i]=o=new Array(n.vectors.length),r=s=0,l=e.length;l>s;r=++s)t=e[r],o[r]=t(i);return u},Ri=function(n){return new Yt(Rr(n,Ht),Rr(n,Re),Rr(n,et),Rr(n,rt))},Ei=function(n){return _.map(n,function(n){return new U(n)})},Ti=function(n){return new ht(function(t){var e,i,r,o,u,a,s,c;if(s=t.evaluate(n),s instanceof G)return n;for(u=s.count(),e=s.at,r=new Array(u),o=c=0;u>=0?u>c:c>u;o=u>=0?++c:--c)void 0!==(a=e(o))&&(r[o]=""+a);return t.attach(i=Oi("factor("+s.label+")",ye,r)),new U(i.name)})},So=nr([String,function(n){return Ti(new U(n))}],[U,function(n){return Ti(n)}]),su=function(n){var t;return t=ti(0,n.length-1),function(e){return n[t(-1+Math.round(e*n.length))]}},hi=function(n){var t,e,i,r,o,u,a,s;return s=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)a=n[t],(a||0===a)&&i.push(a);return i}(),s.sort(function(n,t){return n-t}),e=s[0],t=s[s.length-1],u=su(s),i=u(.25),r=u(.5),o=u(.75),[e,i,r,o,t]},Ve=function(n){var t,e,i,r,o;for(e=0,t=0,r=0,o=n.length;o>r;r++)i=n[r],void 0!==i&&(e+=i,t++);return e/t},De=function(n){var t,e,i,r;for(t=0,i=0,r=n.length;r>i;i++)e=n[i],void 0!==e&&t++;return t},Ge=function(n){var t,e,i,r;for(t=Number.NEGATIVE_INFINITY,i=0,r=n.length;r>i;i++)e=n[i],void 0!==e&&e>=t&&(t=e);return t},He=function(n){var t,e,i,r;for(t=Number.POSITIVE_INFINITY,i=0,r=n.length;r>i;i++)e=n[i],void 0!==e&&t>=e&&(t=e);return t},Ue=function(n){var t,e,i,r;for(t=0,i=0,r=n.length;r>i;i++)e=n[i],void 0!==e&&(t+=e);return t},pi=function(n,t,e,i,r){return new It(function(o,u){var a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,_;if(d=t+"("+n.name+")",o.exists(d))return new U(d);for(p=u.frame.evaluate(n),a=p.at,l=new Array(u.cells.length),k=u.cells,h=m=0,b=k.length;b>m;h=++m){for(s=k[h],v=[],_=s.indices,w=0,y=_.length;y>w;w++)f=_[w],void 0!==(g=a(f))&&v.push(g);l[h]=r(v)}return o.attach(c=Ji(d,e,l,i)),new U(c.name)})},yo=function(n,t,e,i){return nr([String,function(r){return pi(new U(r),n,t,e,i)}],[U,function(r){return pi(r,n,t,e,i)}])},ko=yo("avg",me,_.identity,Ve),_o=yo("count",me,_.identity,De),zo=yo("max",me,_.identity,Ge),Ro=yo("min",me,_.identity,He),eu=yo("sum",me,_.identity,Ue),No=function(){var n,t,e;return t=1<=arguments.length?Vu.call(arguments,0):[],e=function(){var e,i,r;for(r=[],e=0,i=t.length;i>e;e++)if(n=t[e],n instanceof U)r.push(n);else{if(!_.isString(n))throw new Error("Cannot group by ["+n+"]");r.push(new U(n))}return r}(),new et(e)},wo=nr([String,[String],Function,function(n,t,e){return new Ht(n,Ei(t),e)}]),Ko=function(){var n,t,e,i;return e=arguments[0],t=3<=arguments.length?Vu.call(arguments,1,i=arguments.length-1):(i=1,[]),n=arguments[i++],wo(e,t.length?t:[e],n)},bo=nr([[String],Function,function(n,t){return new Re(Ei(n),t)}]),ou=function(){var n,t,e;return t=2<=arguments.length?Vu.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],bo(t,n)},mo=nr([[String],Function,function(n,t){return new rt(Ei(n),t)}],[[U],Function,function(n,t){return new rt(n,t)}]),Xo=function(){var n,t,e;return t=2<=arguments.length?Vu.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],mo(t,n)},qo=function(n){return function(t){return t===n}},Bo=function(n){return function(t){return t!==n}},jo=function(n){return function(t){return n>t}},Yo=function(n){return function(t){return t>n}},Ao=function(n){return function(t){return n>=t}},Eo=function(n){return function(t){return t>=n}},Io=function(n){if(be!==Pu(n))throw new Error("like ["+n+"]: expecting RegExp");return function(t){return n.test(t)}},Po=function(){var n;return n=1<=arguments.length?Vu.call(arguments,0):[],function(t){var e,i,r;for(i=0,r=n.length;r>i;i++)if(e=n[i],e===t)return!0;return!1}},Lo=function(){var n;return n=1<=arguments.length?Vu.call(arguments,0):[],function(t){var e,i,r;for(i=0,r=n.length;r>i;i++)if(e=n[i],e===t)return!1;return!0}},cu=function(t,e){var i,r,o,u,a,s,c,l,f;return c=e.where.length?Ni(t.label,t.vectors,Br(t,e.where)):t,e.group.length?(s=Vr(e.group,function(n){return n.fields}),u=function(){var n,t,e;for(e=[],n=0,t=s.length;t>n;n++){if(a=s[n],f=c.evaluate(a),!(f instanceof G))throw new Error("Cannot group by ["+a.name+"]: not a Factor.");e.push(f)}return e}(),l={0:new st(n,c.indices,{})},Ke(l,u,0),r=[],ri(l[0].children,s.length-1,r,0,new Array(s.length)),o=new P(c,l,r,s.length),i=Le(c.label+"'",o,u),e.having.length?Ni(i.label,i.vectors,Br(i,e.having),i.cube):i):c},Br=function(n,t){var e,i,r,o,u,a,s,c,l,f,h,d,g,v,p,m;for(h=n.indices,f=0,v=t.length;v>f;f++){for(c=t[f],a=[],l=function(){var t,e,i,r;for(i=c.fields,r=[],t=0,e=i.length;e>t;t++)o=i[t],r.push(n.evaluate(o));return r}(),r=_.map(l,function(n){return n instanceof G?n.valueAt:n.at}),d=0,p=h.length;p>d;d++){for(u=h[d],e=new Array(l.length),s=g=0,m=r.length;m>g;s=++g)i=r[s],e[s]=i(u);c.predicate.apply(null,e)&&a.push(u)}h=a}return h},Le=function(n,t,e){var i,r,o;return i=_.range(t.cells.length),o=function(){var n,i,o;for(o=[],r=n=0,i=t.dimension;i>=0?i>n:n>i;r=i>=0?++n:--n)o.push(jr(t,e[r],r));return o}(),Ni(n,o,i,t)},Ke=function(n,t,e){var i,r,o,u,a,s,c,l,f,h;i=t[e].at;for(s in n){for(c=n[s],u=c.children,h=c.indices,l=0,f=h.length;f>l;l++)a=h[l],r=i(a),(o=u[r.key])||(u[r.key]=o=new st(r,[],{})),o.indices.push(a);e<t.length-1&&Ke(u,t,e+1)}},ri=function(n,t,e,i,r){var o,u;for(o in n)u=n[o],r[i]=u,i===t?e.push(new h(vi(r),u.indices)):ri(u.children,t,e,i+1,r)},jr=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v;for(a=new Array(n.cells.length),s={},c=[],v=n.cells,f=d=0,g=v.length;g>d;f=++d)o=v[f],a[f]=r=o.levels[e].category,s[r.value]||(s[r.value]=r,c.push(r));return i=function(n){return a[n]},h=function(n){return a[n].value},l=function(n){return a[n].value},u=function(){return a.length},new G(t.label,t.label,t.type,i,h,u,c,l)},k={c10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],c20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],c20b:["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],c20c:["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"]},go=function(n){return n>10?k.c20:k.c10},ii=function(n){var t,e,i,r;return r=n.rgb(),i=r[0],e=r[1],t=r[2],chroma.rgb(i,e,t)},ui=function(n){return n.css()},ai=function(n,t){return ii(n).alpha(t).css()},cr=function(n,t,e,i){var r;return r=Math.sqrt(i/Fu),n.beginPath(),n.arc(t,e,r,0,ju,!1),n.closePath()},hr=function(n,t,e,i){var r;return r=.5*Math.sqrt(i),n.save(),n.translate(t,e),n.beginPath(),n.moveTo(r,r),n.lineTo(-r,r),n.lineTo(-r,-r),n.lineTo(r,-r),n.closePath(),n.restore()},lr=function(n,t,e,i){var r,o;return r=.5*Math.sqrt(i/5),o=3*r,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(o,r),n.lineTo(r,r),n.lineTo(r,o),n.lineTo(-r,o),n.lineTo(-r,r),n.lineTo(-o,r),n.lineTo(-o,-r),n.lineTo(-r,-r),n.lineTo(-r,-o),n.lineTo(r,-o),n.lineTo(r,-r),n.lineTo(o,-r),n.closePath(),n.restore()},fr=function(n,t,e,i){var r,o;return o=Math.sqrt(i/(2*xe)),r=o*xe,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(r,0),n.lineTo(0,o),n.lineTo(-r,0),n.lineTo(0,-o),n.closePath(),n.restore()},pr=function(n,t,e,i){var r,o;return r=Math.sqrt(i/oe),o=r*oe/2,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(0,-o),n.lineTo(r,o),n.lineTo(-r,o),n.closePath(),n.restore()},dr=function(n,t,e,i){var r,o;return r=Math.sqrt(i/oe),o=r*oe/2,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(0,o),n.lineTo(r,-o),n.lineTo(-r,-o),n.closePath(),n.restore()},vr=function(n,t,e,i){var r,o;return o=Math.sqrt(i/oe),r=o*oe/2,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(r,0),n.lineTo(-r,o),n.lineTo(-r,-o),n.closePath(),n.restore()},gr=function(n,t,e,i){var r,o;return o=Math.sqrt(i/oe),r=o*oe/2,n.save(),n.translate(t,e),n.beginPath(),n.moveTo(-r,0),n.lineTo(r,-o),n.lineTo(r,o),n.closePath(),n.restore()},Zt={circle:cr,square:hr,cross:lr,diamond:fr,triangleUp:pr,triangleDown:dr,triangleLeft:gr,triangleRight:vr},Qt={c8:["circle","square","cross","diamond","triangleUp","triangleDown","triangleLeft","triangleRight"]},vo=function(){return Qt.c8},Wu=function(n){return function(t){return void 0!==t?n(t):void 0}},Ii=function(n,t){var e;return e=d3.scale.linear().domain([n.min,n.max]).range([t.min,t.max]).nice(),[Wu(e),e.tickFormat,e.ticks]},Fi=function(n,t){var e,i,r,o,u,a,s;for(a=0,o={},u=0,s=n.length;s>u;u++)e=n[u],o[e.key]=a++;return i=(t.max-t.min)/n.length/2,r=t.min,Wu(function(n){return r+2*o[n.key]*i+i})},yi=function(n,t){var e,i;return i=t.values,e=i.length,Wu(function(n){return i[n.key%e]})},Di=function(n,t){return Wu(d3.scale.linear().domain([n.min,n.max]).range([t.min,t.max]))},qi=function(n,t){return Wu(d3.scale.linear().domain([n.min,n.mid,n.max]).range([t.min,t.mid,t.max]))},Vi=function(n,t){return Wu(chroma.scale([t.min,t.max]).domain([n.min,n.max]).mode("lch"))},Ci=function(n,t){var e,i;return e=chroma.scale([t.min,t.mid]).domain([n.min,n.mid]).mode("lch"),i=chroma.scale([t.mid,t.max]).domain([n.mid,n.max]).mode("lch"),function(t){return void 0!==t?t<n.mid?e(t):i(t):void 0}},_i=nr([$t,x,Vi],[R,x,Ci]),Xi=nr([$t,$t,Di],[R,R,qi]),Qe=function(n){var t;return t=n.toString(16),1===t.length?"0"+t:t},ki=function(n){var t,e,i,r;return t=n.context,i=n.ratio,e=function(){return"#fff"},r=function(n,e){var r,o,u,a,s;return s=t.getImageData(n*i,e*i,1,1).data,a=s[0],u=s[1],o=s[2],r=s[3],255===a&&255===u&&255===o&&255===r},new g(e,r)},Ai=function(n){var t,e,i,r,o,u;return t=n.context,r=n.ratio,u=0,e={},i=function(n){var t,i,r,o;return i=u++,u>=y&&(u=0),e[i]=n,o=i>>16&255,r=i>>8&255,t=255&i,"#"+Qe(o)+Qe(r)+Qe(t)},o=function(n,i){var o,u,a,s,c,l;return l=t.getImageData(n*r,i*r,1,1).data,c=l[0],s=l[1],u=l[2],o=l[3],255===o?(a=(c<<16)+(s<<8)+u,e[a]):void 0},new pt(i,o)},Tr=function(n,t){var e,i,r,o,u,a,s;return s=n.scale,i=n.domain,a=n.range,o=n.guide,u=t.label,e=t.at,r=function(n){return s(e(n))},new Et(u,r,t,i,a,o)},_r=function(n,t){return new C(n.scale(t))},kr=function(n,t){var e,i,r,o,u,a,s;return t instanceof Te||t instanceof Pe?(s=n.evaluate(t.field),s instanceof G?(t.range||(t.range=new l(go(s.domain.length))),u=yi(s.domain,t.range),e=s.at,r=function(n){return chroma(u(e(n)))},new b(s.label,r,s,s.domain,t.range,null)):(i=function(){switch(di(s.domain)){case 1:return new $t(s.domain.min,s.domain.max);case-1:return new $t(s.domain.min,s.domain.max);default:return new R(s.domain.min,0,s.domain.max)}}(),a=di(i),o=t.range?t.range instanceof z?i instanceof $t?1===a?new Ut(t.range.mid,t.range.max):new Ut(t.range.min,t.range.mid):t.range:(i instanceof R?i=new $t(i.min,i.max):void 0,t.range):i instanceof $t?1===a?new Ut("#deebf7","#3182bd"):new Ut("#e6550d","#fee6ce"):new z("#fc8d59","#ffffbf"),u=_i(i,o),e=s.at,r=function(n){return u(e(n))},new b(s.label,r,s,i,o,null))):new C(t.value)},Sr=function(n,t){var e,i,r,o,u,a;if(t instanceof Ee||t instanceof Ae){if(a=n.evaluate(t.field),a instanceof G)throw new Error("Could not encode opacity. Vector ["+a.label+"] is a Factor.");return i=new $t(a.domain.min,a.domain.max),o=t.range?new $t(ni(t.range.min),ni(t.range.max)):t.range=new $t(.05,1),u=Xi(i,o),e=a.at,r=function(n){return u(e(n))},new bt(a.label,r,a,i,o,null)}return new C(ni(t.value))},Pr=function(n,t){var e,i;return n&&t?(e=n.encode,i=t.encode,new Oe("("+n.label+", "+t.label+")",function(n){var t,r;return t=e(n),r=i(n),r>=0&&1>r?ai(t,r):ui(t)})):void 0},Ir=function(n,t){return function(e,i,r){var o,u,a,s,c,l;if(i instanceof n){if(l=e.evaluate(i.field),l instanceof G)throw new Error("Could not encode size. Vector ["+l.label+"] is a Factor.");return u=new $t(l.domain.min,l.domain.max),s=i.range?new $t(ni(i.range.min),ni(i.range.max)):i.range=new $t(.05,1),c=Xi(u,s),o=l.at,a=function(n){return r*c(o(n))},new t(l.label,a,u,s,null)}return new C(r*ni(i.value))}},Xr=Ir(Me,ee),Ar=Ir(Ie,ee),Cr=Ir(Ne,ee),wr=function(n,t){var e,i,r,o,u,a;if(t instanceof Me){if(a=n.evaluate(t.field),a instanceof G)throw new Error("Could not encode size. Vector ["+a.label+"] is a Factor.");return i=new $t(a.domain.min,a.domain.max),o=t.range?new $t(Xu(t.range.min),Xu(t.range.max)):t.range=new $t(Xu(Zi),Xu(30)),u=Xi(i,o),e=a.at,r=function(n){return u(e(n))
},new ee(a.label,r,a,i,o,null)}return new C(Xu(t.value))},qr=function(n,t){var e,i,r,o,u,a;if(t instanceof Ye){if(a=n.evaluate(t.field),a instanceof G)throw new Error("Could not encode lineWidth. Vector ["+a.label+"] is a Factor.");return i=new $t(a.domain.min,a.domain.max),o=t.range?new $t(t.range.min,t.range.max):t.range=new $t(1.5,15),u=Xi(i,o),e=a.at,r=function(n){return u(e(n))},new ee(a.label,r,a,i,o,null)}return new C(t.value)},Yr=function(n,t){var e,i,r,o;if(t instanceof Xe){if(o=n.evaluate(t.field),!(o instanceof G))throw new Error("Could not encode shape. Vector ["+o.label+"] is not a Factor.");return t.range||(t.range=new l(vo(o.domain.length))),r=yi(o.domain,t.range),e=o.at,i=function(n){return Zt[r(e(n))]},new Kt(o.label,i,o,o.domain,t.range,null)}return new C(Zt[t.value]||Zt.circle)},no=function(n,t){return[null!=n?n:new q(chroma(_.head(k.c10))),null!=t?t:new S(1)]},eo=function(n,t,e){return[null!=n?n:new N(chroma(_.head(k.c10))),null!=t?t:new Y(1),null!=e?e:new O(1.5)]},to=function(n,t,e,i,r,o,u){var a,s,c,l;return a=n||t,s=e||i||r,a||s||(o&&(a=!0),u&&(s=!0)),a&&(c=no(n,t),n=c[0],t=c[1]),s&&(l=eo(e,i,r),e=l[0],i=l[1],r=l[2]),[n,t,e,i,r]},xr=function(n,t){var e,i;return t.fillColor||t.fillOpacity?[e=kr(n,t.fillColor),i=Sr(n,t.fillOpacity),Pr(e,i)]:[]},Mr=function(n,t){var e,i;return t.strokeColor||t.strokeOpacity||t.lineWidth?[e=kr(n,t.strokeColor),i=Sr(n,t.strokeOpacity),Pr(e,i),qr(n,t.lineWidth)]:[]},ei=function(n,t,e,i,r){return n.beginPath(),n.rect(t,e,i,r),n.clip()},sr=function(n,t,e){return n.lineWidth=e,n.strokeStyle=t,n.stroke()},er=function(n,t){return n.fillStyle=t,n.fill()},ir=function(n,t,e,i,r){return n.beginPath(),n.moveTo(t,e),n.lineTo(i,r),n.stroke()},or=function(n,t,e,i,r){return n.beginPath(),i>e?n.rect(t-r/2,e,r,i-e):n.rect(t-r/2,i,r,e-i),n.closePath()},rr=function(n,t,e,i,r){return n.beginPath(),e>t?n.rect(t,i-r/2,e-t,r):n.rect(e,i-r/2,t-e,r),n.closePath()},ur=function(n,t,e,i,r,o,u,a,s,c){var l,f;return void 0!==t&&void 0!==e&&void 0!==i&&void 0!==r&&void 0!==o&&void 0!==u&&void 0!==a&&void 0!==s&&void 0!==c?(n.strokeStyle=s,n.lineWidth=c,rr(n,e,r,u,a),n.stroke(),l=a/2,f=a/4,ir(n,i,u-l,i,u+l),ir(n,e,u,t,u),ir(n,r,u,o,u),ir(n,t,u-f,t,u+f),ir(n,o,u-f,o,u+f)):void 0},ar=function(n,t,e,i,r,o,u,a,s,c){var l,f;return void 0!==t&&void 0!==e&&void 0!==i&&void 0!==r&&void 0!==o&&void 0!==u&&void 0!==a&&void 0!==s&&void 0!==c?(n.strokeStyle=s,n.lineWidth=c,or(n,t,i,o,a),n.stroke(),l=a/2,f=a/4,ir(n,t-l,r,t+l,r),ir(n,t,i,t,e),ir(n,t,o,t,u),ir(n,t-f,e,t+f,e),ir(n,t-f,u,t+f,u)):void 0},zi=function(n,t){var e,i,r,o,u,a,s,c,l,f,h,d,g;return o=t[0],u=t[1],c=new re([o],[u]),a=null!=(h=n.shape)?h:new T("circle"),s=null!=(d=n.size)?d:new E(Zi),g=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!1,!0),e=g[0],i=g[1],l=g[2],f=g[3],r=g[4],new Ot(c,o,u,a,s,e,i,l,f,r)},Or=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p;return s=Tr(e,t.positionX),c=Tr(i,t.positionY),l=Yr(n,t.shape),f=wr(n,t.size),v=xr(n,t),o=v[0],u=v[1],r=v[2],p=Mr(n,t),d=p[0],g=p[1],h=p[2],a=p[3],new qt(s,c,l,f,r,o,u,h,d,g,a)},$r=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(u=t.positionX,a=t.positionY,s=t.shape,c=t.size,i=t.fill,l=t.stroke,o=t.lineWidth,e.save(),d=0,v=n.length;v>d;d++)r=n[d],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),e.lineWidth=2+(l?o(r):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",g=0,p=n.length;p>g;g++)r=n[g],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),l&&(e.lineWidth=o(r),e.stroke()),i&&e.fill());return e.restore()},co=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,v;for(a=t.positionX,s=t.positionY,c=t.shape,l=t.size,f=t.stroke,o=t.lineWidth,e.save(),g=0,v=n.length;v>g;g++)r=n[g],h=a(r),d=s(r),void 0!==h&&void 0!==d&&(u=i.put(r),c(r)(e,h,d,l(r)),e.fillStyle=u,e.fill(),f&&(e.lineWidth=o(r),e.strokeStyle=u,e.stroke()));return e.restore()},_u=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g;for(u=t.positionX,a=t.positionY,s=t.shape,c=t.size,i=t.fill,l=t.stroke,o=t.lineWidth,e.save(),d=0,g=n.length;g>d;d++)r=n[d],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),l&&(e.lineWidth=o(r),e.strokeStyle=l(r),e.stroke()),i&&(e.fillStyle=i(r),e.fill()));return e.restore()},Eu=function(n,t,e,i,r,o){var u,a,s,c,l,f,h,d;for(a=t.positionX,s=t.positionY,c=[],h=0,d=n.length;d>h;h++)u=n[h],l=a(u),f=s(u),void 0!==l&&void 0!==f&&l>=e&&r>=l&&f>=i&&o>=f&&c.push(u);return c},Mu=function(n){return _.map(n,function(n){return n.type}).join(", ")},Bi=function(n,t){var e,i,o,u,a,s,c,l,f,h,d,g,v,p,w,b,y,k,_,x,C,q,S;switch(p=Mu(t)){case"String, Number":return a=t[0],h=t[1],d=new re([a],[h]),w=null!=(b=n.width)?b:new X(.8),y=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!0,!1),e=y[0],i=y[1],g=y[2],v=y[3],u=y[4],new m(d,a,void 0,h,w,e,i,g,v,u);case"String, Number, Number":return a=t[0],f=t[1],h=t[2],d=new re([a],[f,h]),w=null!=(k=n.width)?k:new X(.8),_=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!0,!1),e=_[0],i=_[1],g=_[2],v=_[3],u=_[4],new m(d,a,f,h,w,e,i,g,v,u);case"Number, String":return c=t[0],l=t[1],d=new re([c],[l]),o=null!=(x=n.height)?x:new W(.8),C=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!0,!1),e=C[0],i=C[1],g=C[2],v=C[3],u=C[4],new r(d,void 0,c,l,o,e,i,g,v,u);case"Number, Number, String":return s=t[0],c=t[1],l=t[2],d=new re([s,c],[l]),o=null!=(q=n.height)?q:new W(.8),S=to(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeOpacity,n.lineWidth,!0,!1),e=S[0],i=S[1],g=S[2],v=S[3],u=S[4],new r(d,s,c,l,o,e,i,g,v,u);default:throw new Error("Cannot create rect marks with vectors of type ["+p+"]")}},yr=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,p,m;return s=Tr(e,t.positionX),c=t.positionY1?Tr(i,t.positionY1):_r(i,0),l=Tr(i,t.positionY2),g=Xr(n,t.width,e.rect.width/e.domain.length),p=xr(n,t),o=p[0],u=p[1],r=p[2],m=Mr(n,t),h=m[0],d=m[1],f=m[2],a=m[3],new v(s,c,l,g,r,o,u,f,h,d,a)},br=function(n,t,i,r){var o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k;switch(t.space.x.length){case 1:m=t.space.x[0],l=_r(i,0),f=Tr(i,m);break;default:b=t.space.x,p=b[0],m=b[1],l=Tr(i,p),f=Tr(i,m)}return w=t.space.y[0],h=Tr(r,w),s=Xr(n,t.height,r.rect.height/r.domain.length),y=xr(n,t),u=y[0],a=y[1],o=y[2],k=Mr(n,t),g=k[0],v=k[1],d=k[2],c=k[3],new e(l,f,h,s,o,u,a,d,g,v,c)},Hr=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w;for(u=t.positionX,a=t.positionY1,s=t.positionY2,f=t.width,i=t.fill,c=t.stroke,o=t.lineWidth,e.save(),v=0,m=n.length;m>v;v++)r=n[v],h=u(r),d=a(r),g=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==l&&(or(e,h,d,g,l),e.lineWidth=2+(c?o(r):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",p=0,w=n.length;w>p;p++)r=n[p],h=u(r),d=a(r),g=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==l&&(or(e,h,d,g,l),c&&(e.lineWidth=o(r),e.stroke()),i&&e.fill());return e.restore()},Gr=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w;for(s=t.positionX1,c=t.positionX2,l=t.positionY,o=t.height,i=t.fill,f=t.stroke,a=t.lineWidth,e.save(),v=0,m=n.length;m>v;v++)u=n[v],h=s(u),d=c(u),g=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==r&&(rr(e,h,d,g,r),e.lineWidth=2+(f?a(u):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",p=0,w=n.length;w>p;p++)u=n[p],h=s(u),d=c(u),g=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==r&&(rr(e,h,d,g,r),f&&(e.lineWidth=a(u),e.stroke()),i&&e.fill());return e.restore()},ao=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p,m;for(a=t.positionX,s=t.positionY1,c=t.positionY2,h=t.width,l=t.stroke,o=t.lineWidth,e.save(),p=0,m=n.length;m>p;p++)r=n[p],d=a(r),g=s(r),v=c(r),f=h(r),void 0!==d&&void 0!==g&&void 0!==v&&void 0!==f&&(u=i.put(r),or(e,d,g,v,f),er(e,u),l&&sr(e,u,o(r)));return e.restore()},uo=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p,m;for(c=t.positionX1,l=t.positionX2,f=t.positionY,o=t.height,h=t.stroke,a=t.lineWidth,e.save(),p=0,m=n.length;m>p;p++)u=n[p],d=c(u),g=l(u),v=f(u),r=o(u),void 0!==d&&void 0!==g&&void 0!==v&&void 0!==r&&(s=i.put(u),rr(e,d,g,v,r),er(e,s),h&&sr(e,s,a(u)));return e.restore()},vu=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(u=t.positionX,a=t.positionY1,s=t.positionY2,f=t.width,i=t.fill,c=t.stroke,o=t.lineWidth,e.save(),v=0,p=n.length;p>v;v++)r=n[v],h=u(r),d=a(r),g=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==l&&(or(e,h,d,g,l),c&&sr(e,c(r),o(r)),i&&er(e,i(r)));return e.restore()},gu=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(s=t.positionX1,c=t.positionX2,l=t.positionY,o=t.height,i=t.fill,f=t.stroke,a=t.lineWidth,e.save(),v=0,p=n.length;p>v;v++)u=n[v],h=s(u),d=c(u),g=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==r&&(rr(e,h,d,g,r),f&&sr(e,f(u),a(u)),i&&er(e,i(u)));return e.restore()},Tu=function(n,t,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y;for(a=t.positionX,s=t.positionY1,c=t.positionY2,h=t.width,l=[],b=0,y=n.length;y>b;b++)u=n[b],d=a(u),p=s(u),m=c(u),p>m&&(w=p,p=m,m=w),f=h(u),void 0!==d&&void 0!==p&&void 0!==m&&void 0!==f&&(g=d-f/2,v=d+f/2,e>v||g>r||i>m||p>o||l.push(u));return l},Ou=function(n,t,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y;for(c=t.positionX1,l=t.positionX2,f=t.positionY,a=t.height,h=[],b=0,y=n.length;y>b;b++)s=n[b],d=c(s),g=l(s),p=f(s),d>g&&(v=d,d=g,g=v),u=a(s),void 0!==d&&void 0!==g&&void 0!==p&&void 0!==u&&(m=p-u/2,w=p+u/2,e>g||d>r||i>w||m>o||h.push(s));return h},Li=function(n,t){var e,i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b;switch(h=Mu(t)){case"String, Number, Number, Number, Number, Number":return g=t[0],r=t[1],o=t[2],u=t[3],a=t[4],s=t[5],c=new re([g],[r,o,u,a,s]),d=null!=(p=n.width)?p:new X(.8),m=eo(n.strokeColor,n.strokeOpacity,n.lineWidth),l=m[0],f=m[1],i=m[2],new Dt(c,g,r,o,u,a,s,d,l,f,i);case"Number, Number, Number, Number, Number, String":return r=t[0],o=t[1],u=t[2],a=t[3],s=t[4],v=t[5],c=new re([r,o,u,a,s],[v]),e=null!=(w=n.height)?w:new X(.8),b=eo(n.strokeColor,n.strokeOpacity,n.lineWidth),l=b[0],f=b[1],i=b[2],new Bt(c,r,o,u,a,s,v,e,l,f,i)}},Er=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,v;return u=Tr(e,t.q0),a=Tr(e,t.q1),s=Tr(e,t.q2),c=Tr(e,t.q3),l=Tr(e,t.qn),g=Tr(i,t.positionY),r=Xr(n,t.height,i.rect.height/i.domain.length),v=Mr(n,t),h=v[0],d=v[1],f=v[2],o=v[3],new zt(u,a,s,c,l,g,r,f,h,d,o)},Jr=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(u=t.positionY,a=t.q0,s=t.q1,c=t.q2,l=t.q3,f=t.qn,i=t.height,h=t.stroke,o=t.lineWidth,e.save(),d=0,v=n.length;v>d;d++)r=n[d],ur(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),2+(h?o(r):1));for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.strokeStyle="black",g=0,p=n.length;p>g;g++)r=n[g],ur(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),o(r));return e.restore()},lo=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y;for(c=t.positionY,l=t.q0,f=t.q1,h=t.q2,d=t.q3,g=t.qn,o=t.height,v=t.stroke,a=t.lineWidth,e.save(),b=0,y=n.length;y>b;b++)u=n[b],p=l(u),m=g(u),w=c(u),r=o(u),void 0!==p&&void 0!==m&&void 0!==w&&void 0!==r&&(s=i.put(u),rr(e,p,m,w,r),er(e,s),sr(e,s,a(u)));return e.restore()},xu=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g;for(u=t.positionY,a=t.q0,s=t.q1,c=t.q2,l=t.q3,f=t.qn,i=t.height,h=t.stroke,o=t.lineWidth,e.save(),d=0,g=n.length;g>d;d++)r=n[d],ur(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),o(r));return e.restore()},Nu=function(n,t,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,_,x,C,q;for(l=t.positionY,f=t.q0,h=t.q1,d=t.q2,g=t.q3,v=t.qn,a=t.height,m=t.stroke,c=t.lineWidth,p=[],C=0,q=n.length;q>C;C++)s=n[C],w=f(s),b=v(s),k=l(s),w>b&&(y=w,w=b,b=y),u=a(s),void 0!==w&&void 0!==b&&void 0!==k&&void 0!==u&&(_=k-u/2,x=k+u/2,e>b||w>r||i>x||_>o||p.push(s));return p},Nr=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,v;return g=Tr(e,t.positionX),o=Tr(i,t.q0),u=Tr(i,t.q1),a=Tr(i,t.q2),s=Tr(i,t.q3),c=Tr(i,t.qn),d=Xr(n,t.width,e.rect.width/e.domain.length),v=Mr(n,t),f=v[0],h=v[1],l=v[2],r=v[3],new Lt(g,o,u,a,s,c,d,l,f,h,r)},Kr=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(o=t.positionX,u=t.q0,a=t.q1,s=t.q2,c=t.q3,l=t.qn,h=t.width,f=t.stroke,r=t.lineWidth,e.save(),d=0,v=n.length;v>d;d++)i=n[d],ar(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),2+(f?r(i):1));for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.strokeStyle="black",g=0,p=n.length;p>g;g++)i=n[g],ar(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),r(i));return e.restore()},fo=function(n,t,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y;for(a=t.positionX,s=t.q0,c=t.q1,l=t.q2,f=t.q3,h=t.qn,v=t.width,d=t.stroke,o=t.lineWidth,e.save(),b=0,y=n.length;y>b;b++)r=n[b],p=a(r),m=s(r),w=h(r),g=v(r),void 0!==p&&void 0!==m&&void 0!==w&&void 0!==g&&(u=i.put(r),or(e,p,m,w,g),er(e,u),sr(e,u,o(r)));return e.restore()},Cu=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g;for(o=t.positionX,u=t.q0,a=t.q1,s=t.q2,c=t.q3,l=t.qn,h=t.width,f=t.stroke,r=t.lineWidth,e.save(),d=0,g=n.length;g>d;d++)i=n[d],ar(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),r(i));return e.restore()},Yu=function(n,t,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,_,x,C,q;for(s=t.positionX,c=t.q0,l=t.q1,f=t.q2,h=t.q3,d=t.qn,m=t.width,v=t.stroke,a=t.lineWidth,g=[],C=0,q=n.length;q>C;C++)u=n[C],w=s(u),k=c(u),_=d(u),k>_&&(x=k,k=_,_=x),p=m(u),void 0!==w&&void 0!==k&&void 0!==_&&void 0!==p&&(b=w-p/2,y=w+p/2,e>y||b>r||i>_||k>o||g.push(u));return g},ji=function(n,t){var e,i,r,o,u,a,s;return i=t[0],r=t[1],o=new re([i],[r]),s=eo(n.strokeColor,n.strokeOpacity,n.lineWidth),u=s[0],a=s[1],e=s[2],new xt(o,i,r,u,a,e)},Wr=function(n,t,e,i){var r,o,u,a,s,c,l;return o=Tr(e,t.positionX),u=Tr(i,t.positionY),l=Mr(n,t),s=l[0],c=l[1],a=l[2],r=l[3],new yt(o,u,a,s,c,r)},Ur=function(n,t,e){var i,r,o,u,a,s,c;for(r=t.positionX,o=t.positionY,e.save(),s=0,c=n.length;c>s;s++)i=n[s],u=r(i),a=o(i),e.lineWidth=1.5,e.strokeStyle="black",void 0!==u&&void 0!==a&&(cr(e,u,a,64),e.stroke());return e.restore()},so=function(n,t,e,i){var r,o,u,a,s,c,l;for(o=t.positionX,u=t.positionY,e.save(),c=0,l=n.length;l>c;c++)r=n[c],a=o(r),s=u(r),void 0!==a&&void 0!==s&&(cr(e,a,s,64),e.fillStyle=i.put(r),e.fill());return e.restore()},yu=function(n,t,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k;if(u=t.positionX,a=t.positionY,s=t.stroke,o=t.lineWidth,s instanceof C&&o instanceof C){for(e.strokeStyle=s(),e.lineWidth=o(),e.save(),w=!1,m=0,y=n.length;y>m;m++)r=n[m],f=u(r),g=a(r),void 0!==f&&void 0!==g?w?e.lineTo(f,g):(e.beginPath(),w=!0,e.moveTo(f,g)):(w&&e.stroke(),w=!1);return e.restore()}for(e.save(),e.lineCap="round",w=!1,h=void 0,v=void 0,c=void 0,b=0,k=n.length;k>b;b++)r=n[b],d=u(r),p=a(r),void 0!==d&&void 0!==p?(l=s(r),w&&(l!==c?(i=e.createLinearGradient(h,v,d,p),i.addColorStop(0,c||Se),i.addColorStop(1,l||Se),e.strokeStyle=i):e.strokeStyle=l,e.lineWidth=o(r),e.beginPath(),e.moveTo(h,v),e.lineTo(d,p),e.stroke()),w=!0,h=d,v=p,c=l):w=!1;return e.restore()},Pi=nr([St,Array,zi],[kt,Array,ji],[At,Array,Bi],[jt,Array,Li]),Wt=new nt(Or,co,$r,_u,Eu),_t=new nt(Wr,so,Ur,yu,Eu),p=new nt(yr,ao,Hr,vu,Tu),i=new nt(br,uo,Gr,gu,Ou),Rt=new nt(Er,lo,Jr,xu,Nu),Vt=new nt(Nr,fo,Kr,Cu,Yu),To=nr([Z,_.identity],[Function,function(n){return new A(n)}]),ru=nr([Number,function(n){return new wt(n)}],[Boolean,function(n){return new o(n)}],[Date,function(n){return new I(n)}],[String,function(n){return new ue(n)}]),Co=function(){var n;n=1<=arguments.length?Vu.call(arguments,0):[]},Uo=nr([Array,function(n){return new l(n)}],[Number,function(n){return n>0?new $t(0,n):0>n?new $t(n,0):new R(-1,0,1)}],[String,function(n){return new Ut(n,"black")}],[Number,Number,function(n,t){return t>=n?new $t(n,t):new $t(t,n)}],[String,String,function(n,t){return new Ut(n,t)}],[Number,Number,Number,function(n,t,e){var i,r,o,u;return u=_.sortBy([n,t,e],_.identity),i=u[0],r=u[1],o=u[2],new R(i,r,o)}],[String,String,String,function(n,t,e){return new z(n,t,e)}]),oi=function(n){var t,e,i,r,o;for(o=[],i=0,r=n.length;r>i;i++)if(t=n[i],t instanceof U)o.push(new M(t));else switch(e=Pu(t)){case ye:o.push(new M(new U(t)));break;default:throw new Error("Cannot create position coordinates from ["+t+"] of type ["+e+"].")}return o},Ho=function(){var n;return n=1<=arguments.length?Vu.call(arguments,0):[],new Tt(oi(n))},Wo=nr([ue,function(n){return new q(chroma(n.value))}],[String,function(n){return new Te(new U(n))}],[U,function(n){return new Te(n)}],[String,x,function(n,t){return new Te(new U(n),t)}],[U,x,function(n,t){return new Te(n,t)}],[String,l,function(n,t){return new Te(new U(n),t)}],[U,l,function(n,t){return new Te(n,t)}]),Oo=nr([wt,function(n){return new S(n.value)}],[String,function(n){return new Ee(new U(n))}],[U,function(n){return new Ee(n)}],[String,$t,function(n,t){return new Ee(new U(n),t)}],[U,$t,function(n,t){return new Ee(n,t)}]),nu=nr([ue,function(n){return new N(chroma(n.value))}],[String,function(n){return new Pe(new U(n))}],[U,function(n){return new Pe(n)}],[String,x,function(n,t){return new Pe(new U(n),t)}],[U,x,function(n,t){return new Pe(n,t)}],[String,l,function(n,t){return new Pe(new U(n),t)}],[U,l,function(n,t){return new Pe(n,t)}]),tu=nr([wt,function(n){return new Y(n.value)}],[String,function(n){return new Ae(new U(n))}],[U,function(n){return new Ae(n)}],[String,$t,function(n,t){return new Ae(new U(n),t)}],[U,$t,function(n,t){return new Ae(n,t)}]),tr=function(n,t){return nr([wt,function(t){return new n(t.value)}],[String,function(n){return new t(new U(n))}],[U,function(n){return new t(n)}],[String,$t,function(n,e){return new t(new U(n),e)}],[U,$t,function(n,e){return new t(n,e)}])},Zo=tr(E,Me),uu=tr(X,Ie),Mo=tr(W,Ne),Fo=nr([wt,function(n){return new O(n.value)}],[String,function(n){return new Ye(new U(n))}],[U,function(n){return new Ye(n)}],[String,$t,function(n,t){return new Ye(new U(n),t)}],[U,$t,function(n,t){return new Ye(n,t)}]),Qo=nr([ue,function(n){return new T(n.value)}],[String,function(n){return new Xe(new U(n))}],[U,function(n){return new Xe(n)}],[String,l,function(n,t){return new Xe(new U(n),t)}],[U,l,function(n,t){return new Xe(n,t)}]),iu=function(){return new _e},Go=function(){var n,t,e,i,r,o,u,a,s;return i=1<=arguments.length?Vu.call(arguments,0):[],r=Lr(i,Tt),o=Lr(i,Jt),u=Lr(i,te),n=Lr(i,K),t=Lr(i,Q),a=Lr(i,se),s=Lr(i,ce),e=Lr(i,ct),new St(r,o,u,n,t,a,s,e)},$o=function(){var n,t,e,i,r,o,u,a,s;return r=1<=arguments.length?Vu.call(arguments,0):[],o=Lr(r,Tt),s=Lr(r,Be),e=Lr(r,ot),n=Lr(r,K),t=Lr(r,Q),u=Lr(r,se),a=Lr(r,ce),i=Lr(r,ct),new At(o,s,e,n,t,u,a,i)},Do=function(){var n,t,e,i,r;return t=1<=arguments.length?Vu.call(arguments,0):[],e=Lr(t,Tt),i=Lr(t,se),r=Lr(t,ce),n=Lr(t,ct),new kt(e,i,r,n)},Jo=function(){var n,t,e,i,r,o,u;return e=1<=arguments.length?Vu.call(arguments,0):[],i=Lr(e,Tt),u=Lr(e,Be),n=Lr(e,ot),r=Lr(e,se),o=Lr(e,ce),t=Lr(e,ct),new jt(i,u,n,r,o,t)},Vo=function(n,t){var e;return e=function(n,t){var i,r,o,u;if(_.isArray(n)){for(r=n.length,o=[];r--;)i=n[r],null!==i&&_.isObject(i)?(e(i,t),o.push(t(i))):o.push(void 0);return o}u=[];for(r in n)Gu.call(n,r)&&(i=n[r],null!==i&&_.isObject(i)?(e(i,t),u.push(t(i))):u.push(void 0));return u},function(i){var r;return r=n.parse(i),e(r,function(n){var t;"CallExpression"===n.type&&"Identifier"===n.callee.type?_.isFunction(po[t=n.callee.name])&&(n.callee={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"plot"},property:{type:"Identifier",name:t}}):"Identifier"===n.type&&_.isFunction(po[t=n.name])&&(delete n.name,n.type="MemberExpression",n.computed=!1,n.object={type:"Identifier",name:"plot"},n.property={type:"Identifier",name:t})}),t.generate(r)}},xo={maxCanvasSize:new ne(795,600),visualizationSize:new ne(300,300),axisLabelFont:"10px monospace",axisTickColor:"#4d4d4d",axisTitleFont:"bold 10px monospace",axisLabelColor:"#4d4d4d",gridLineColor:"#eee"},au=function(n){return Math.round(n)+"px"},xi=function(n,t){var e,i,r,o;e=document.createElement(n),r=e.style;for(i in t)o=t[i],r[i]=o;return e},lu=function(n){for(var t;t=n.firstChild;)n.removeChild(t)},Ui=function(n){var t,e,i,r,o,u,a,s;u=function(){var t;t=[];for(o in n)a=n[o],i=function(){var n;n=[];for(r in a)s=a[r],n.push(r+":"+s);return n}(),t.push(o+"{"+i.join(";")+";}");return t}(),t=document.createElement("style"),t.type="text/css",t.innerHTML=u.join("\n"),e=_.head(document.getElementsByTagName("head")),e.appendChild(t)},$i=function(n){var t,e,i,r,o,u,a;e=document.createElement("table"),e.appendChild(i=document.createElement("tbody"));for(t in n)a=n[t],i.appendChild(u=document.createElement("tr")),u.appendChild(r=document.createElement("td")),r.appendChild(document.createTextNode(t+":")),u.appendChild(o=document.createElement("th")),o.appendChild(document.createTextNode(a));return e},bi=function(n){var t,e,i,r,o,u,a;return a=n.width,o=n.height,r=document.createElement("canvas"),e=r.getContext("2d"),i=window.devicePixelRatio||1,t=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,u=i/t,r.style.position="absolute",i!==t?(r.width=a*u,r.height=o*u,e.scale(u,u),r.style.width=au(a),r.style.height=au(o)):(r.width=a,r.height=o),new s(r,e,n,u)},Ki=function(n){var t,e,i,r,o,u,a,s,c,l,f,h;return h=function(){var t,e;for(e=[],a=t=1;5>=t;a=++t)e.push(bi(n));return e}(),t=h[0],o=h[1],u=h[2],l=h[3],i=h[4],r=xi("div",{position:"relative",overflow:"visible",width:au(n.width),height:au(n.height)}),s=xi("div",{position:"absolute",left:au(0),top:au(0),width:au(0),height:au(0),display:"none",outline:"1px dotted #999",background:"rgba(0, 0, 0, 0.05)"}),f=xi("div",{position:"absolute",left:au(0),top:au(0),display:"none"}),f.className="vx-tooltip",r.appendChild(t.element),r.appendChild(o.element),r.appendChild(s),r.appendChild(u.element),r.appendChild(f),c=Ai(l),e=ki(i),new je(n,r,t,o,u,l,i,s,f,c,e)},Dr=function(n){var t,e,i;return e=null!=(i=n.target)?i:n.srcElement,t=e.getBoundingClientRect(),[n.clientX-t.left,n.clientY-t.top]},Ze=function(n,t,e,i,r){var o,u,a,s,c,l,f,h,d,g;u=$(document),o=$(n),s=t.style,c=h=l=d=f=g=0,a=!1,o.on("mousemove",function(n){var t;return c=n.offsetX,h=n.offsetY,(void 0===c||void 0===h)&&(t=Dr(n),c=t[0],h=t[1]),a?(s.left=au(c>l?l:c),s.top=au(h>d?d:h),s.width=au(Math.abs(c-l)),s.height=au(Math.abs(h-d))):e(c,h)}),o.on("mousedown",function(n){var t;return n.preventDefault(),l=n.offsetX,d=n.offsetY,(void 0===l||void 0===d)&&(t=Dr(n),l=t[0],d=t[1]),a=!0,s.display="block",s.left=au(l),s.top=au(d),u.on("mouseup",function(n){var t;return n.preventDefault(),f=n.offsetX,g=n.offsetY,(void 0===f||void 0===g)&&(t=Dr(n),f=t[0],g=t[1]),a=!1,s.display="none",s.width=au(0),s.height=au(0),u.off("mouseup"),Math.abs(l-f)>5||Math.abs(d-g)>5?i(l,d,f,g):r(l,d)})})},Si=function(){var n,t,e;return e={},n=function(n,t){var i;return(i=e[n])?i.push(t):e[n]=[t]},t=function(n,t){var i,r,o,u,a;if(n)if(t){if(o=e[n])for(i=u=0,a=o.length;a>u;i=++u)if(r=o[i],r===t){o.splice(i,1);break}}else delete e[n]},nr=function(){var n,t,i,r,o,u;if(t=arguments[0],n=2<=arguments.length?Vu.call(arguments,1):[],r=e[t])for(o=0,u=r.length;u>o;o++)i=r[o],i.apply(null,n)},[n,t,nr]},Qi=function(n,t,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,_,x,C,q,S,W,O;return O=Ki(n),u=O.baseCanvas,h=O.highlightCanvas,g=O.hoverCanvas,s=O.clipCanvas,m=O.maskCanvas,v=O.marquee,x=O.tooltip,p=O.mask,a=O.clip,C=n.regions.center,S=t.indices,q=void 0,_=function(t,i){var r,o,u,c,l;if(o=p.test(t,i),void 0!==o)for(r=s.context,r.clearRect(0,0,n.width,n.height),c=0,l=e.length;l>c;c++)if(u=e[c],r.save(),r.translate(C.left,C.top),u.mask([o],u.encoders,r,a),r.restore(),a.test(t,i))return o},c=function(n,t,e){var i;return i=$i(e),lu(x),x.appendChild(i),x.style.display="block",w(n,t)},W=7,w=function(t,e){var i,r,o,u;return u=x.clientWidth,o=x.clientHeight,i=t+W,r=e-W-o,i+u>n.width&&(i=t-W-u),0>r&&(r=e+W),x.style.left=au(i),x.style.top=au(r)},l=function(){return x.style.display="none"},d=function(i,r){var u,a,s,f,h,d,v,p,m,b,y,k;if(f=_(i,r),f!==q){if(q=f,s=g.context,s.clearRect(0,0,n.width,n.height),l(),void 0!==f){for(s.save(),s.translate(C.left,C.top),p=0,b=e.length;b>p;p++)h=e[p],h.highlight([f],h.encoders,s);for(s.restore(),o("hover",new ut(t.vectors,f)),d={},m=0,y=e.length;y>m;m++){h=e[m],k=h.encodings;for(u in k)a=k[u],a&&(v=a.vector)&&(d[v.name]=v.format(f))}c(i,r,d)}}else w(i,r)},f=function(t){var i,r,o,a;if(i=h.context,i.clearRect(0,0,n.width,n.height),t.length){for(u.element.style.opacity=.5,i.save(),i.translate(C.left,C.top),o=0,a=e.length;a>o;o++)r=e[o],r.highlight(t,r.encoders,i),r.render(t,r.encoders,i);i.restore()}else u.element.style.opacity=1},y=function(n,e){var i;i=_(n,e),void 0!==i?(f([i]),o("select",new Gt(t.vectors,[i]))):(f([]),o("deselect",new j(t.vectors)))},k=function(n,i,r,u){var a,s,c,l,h,d,g,v;for(l=-C.left+(n>r?r:n),c=-C.left+(n>r?n:r),d=-C.top+(i>u?u:i),h=-C.top+(i>u?i:u),g=0,v=e.length;v>g;g++)a=e[g],s=a.select(S,a.encoders,l,d,c,h),f(s),s.length?o("select",new Gt(t.vectors,s)):o("deselect",new j(t.vectors))},b=function(){var t,o,a,s,c;for(t=u.context,a=m.context,mu(t,i,C),wu(t,r,C),t.save(),t.translate(C.left,C.top),a.save(),a.translate(C.left,C.top),s=0,c=e.length;c>s;s++)o=e[s],o.render(S,o.encoders,t),o.mask(S,o.encoders,a,p);a.restore(),t.restore(),hu(t,i,n.regions.bottom),du(t,r,n.regions.left)},Ze(g.element,v,d,k,y),new ze(O,t,_,f,d,y,k,b)},fu=function(n,t,e,i,r){var o,u,a,s,l,f,h,d,g,v,p,m,w,b,y,k,_,x;if(n.font=xo.axisLabelFont,n.fillStyle=xo.axisLabelColor,n.strokeStyle=xo.axisTickColor,n.textBaseline="middle",m=zu+4,l=e-m,n.save(),ei(n,m,0,l,i),n.textAlign="right",p=e-5,a=e-6,t instanceof c){for(_=t.guide(),w=0,y=_.length;y>w;w++)o=_[w],u=o.value,d=t.scale(o),v=-.5+Math.round(d),ir(n,p,v,e,v),n.fillText(u,a,d,l-6);ir(n,e-.5,0,e-.5,i)}else{if(!(t instanceof lt))throw new Error("Invalid axis type.");for(h=6,f=i-6,x=t.guide(),b=0,k=x.length;k>b;b++)g=x[b],u=g.label,d=t.scale(g.value),v=Math.max(.5,-.5+Math.round(d)),ir(n,p,v,e,v),s=h>d?h:d>f?f:d,n.fillText(u,a,s,l-6);ir(n,e-.5,0,e-.5,i)}return n.restore(),n.font=xo.axisTitleFont,n.textAlign="center",n.translate(m/2,i/2),n.rotate(r*it),n.fillText(t.label,0,0,i),n.restore()},pu=function(n,t,e,i){var r,o,u,a,s;if(n.strokeStyle=xo.gridLineColor,t instanceof c)ir(n,0,.5,e,.5),ir(n,0,i-.5,e,i-.5);else if(t instanceof lt)for(s=t.guide(),u=0,a=s.length;a>u;u++)r=s[u],o=Math.max(.5,-.5+Math.round(t.scale(r.value))),ir(n,0,o,e,o)},mu=function(n,t,e){return n.save(),n.translate(e.left,e.top+e.height),n.rotate(-it),pu(n,t,e.height,e.width),n.restore()},wu=function(n,t,e){return n.save(),n.translate(e.left,e.top),pu(n,t,e.width,e.height),n.restore()},hu=function(n,t,e){return n.save(),n.translate(e.left,e.top+e.height),n.rotate(-it),fu(n,t,e.height,e.width,1),n.restore()},du=function(n,t,e){return n.save(),n.translate(e.left,e.top),fu(n,t,e.width,e.height,-1),n.restore()},ci=function(n,t){var e,i,r,o,u,a,s,c,l;return 0<=(a=n.indexOf(" "))?(c=n.substr(0,a),e=n.substr(a)):c=n,l=c.split(/\.+/g),s=l[0],r=2<=l.length?Vu.call(l,1):[],0===s.indexOf("#")&&(u=s.substr(1),s="div"),""===s&&(s="div"),i="<"+s,u&&(i+=" id='"+u+"'"),r.length&&(i+=" class='"+r.join(" ")+"'"),e&&(i+=e),i+=">",o="</"+s+">","="===t?function(n){return i+(null!==n&&void 0!==n?n:"")+o}:"+"===t?function(n,t){var e;return e=i.replace("{0}",t),e+n+o}:function(n){return i+n.join("")+o}},Lu={},Yi=function(){var n,t,e,i,r,o,u;for(e=1<=arguments.length?Vu.call(arguments,0):[],u=[],r=0,o=e.length;o>r;r++)t=e[r],(n=Lu[t])?u.push(n):(i=t.charAt(0),u.push("="===i||"+"===i?Lu[t]=ci(t.substr(1),i):Lu[t]=ci(t)));return u},bu=function(n){var t;return t=document.createElement("div"),t.innerHTML=n,t.childNodes[0]},Fr=function(n,t){var e,i,r,o;for(o=[],i=0,r=t.length;r>i;i++)e=t[i],o.push(n.evaluate(e.field));return o},Gi=function(n){var t,e,i,r,o,u;for(e=null,t=null,u=null,r=0,o=n.length;o>r;r++)if(i=n[r],null===e)switch(e=i.type){case ye:u=i,t=i.domain;break;case me:t=i.domain;break;default:throw new Error("ni")}else{if(e!==i.type)throw new Error("Incompatible axis vector ["+i.label+"]. Expect type ["+e+"], got ["+i.type+"]");switch(e){case ye:if(u!==i)throw new Error("Incompatible categorical vector ["+i.label+"]. Expected ["+u.label+"].");break;case me:t=si(t,i.domain);break;default:throw new Error("ni")}}return new ie(e,n,t)},Hi=function(n,t,e){return new re(Fr(n,t),Fr(n,e))},wi=function(n){var t,e;return t=function(){var t,i,r;for(r=[],t=0,i=n.length;i>t;t++)e=n[t],r.push(e.label);return r}(),t.join(", ")},li=function(n,t){var e,i,r,o,a,s,l,f,h,d,g,v,p;if(l=new Pt(0,0,400,400),e=mi(n,"",t,new $t(0,l.width),l),s=zu+4+6+10,e instanceof c){for(a=0,i=e.guide(),h=0,g=i.length;g>h;h++)r=i[h],a<(o=(""+r.value).length)&&(a=o);return new u(Math.ceil(a*zu+s),Math.ceil(i.length*(zu+8)))}if(e instanceof lt){for(a=0,i=e.guide(),p=e.guide(),d=0,v=p.length;v>d;d++)f=p[d],a<(o=f.label.length)&&(a=o);return new u(Math.ceil(a*zu+s),xo.visualizationSize.height)}throw new Error("Invalid axis type.")},mi=function(n,t,e,i,r){var o,u,a,s,l;switch(n){case ye:return u=Fi(e,i),o=function(){return e},new c(n,t,u,e,i,r,o);case me:return l=Ii(e,i),u=l[0],a=l[1],s=l[2],o=function(n){var t,e,i,r,o,u;for(null==n&&(n=10),t=a(n),o=s(n),u=[],i=0,r=o.length;r>i;i++)e=o[i],u.push(new qe(e,t(e)));return u},new lt(n,t,u,e,i,r,o);default:throw new Error("Unhandled axis type ["+n+"].")}},Su=function(n,t){var e,i;return i=Ri(t),e=cu(n,i),Lr(t,_e)?qu(e,t):ku(e,t)},qu=function(n,t){var e,i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k;return a=Lr(t,_e),k=Yi("table.vx-table","=thead","tbody","tr","=th","=th.vx-number","=td","=td.vx-number"),u=k[0],d=k[1],s=k[2],p=k[3],h=k[4],g=k[5],c=k[6],l=k[7],v=function(){var t,e;t=n.schema,e=[];for(r in t)switch(y=t[r],y.type){case me:e.push(g(_.escape(y.label)));break;default:e.push(h(_.escape(y.label)))}return e}(),m=function(){var t,e,o,u;for(o=n.indices,u=[],t=0,e=o.length;e>t;t++)i=o[t],f=function(){var t,e;t=n.schema,e=[];for(r in t)switch(y=t[r],b=y.format(i),y.type){case ye:e.push(c(void 0!==b?_.escape(b):"-"));break;case me:e.push(l(void 0!==b?_.escape(b):"-"));break;case we:e.push(c(void 0!==b?b:"-"));break;default:throw new Error("Cannot render table cell of type "+y.type)}return e}(),u.push(p(f));return u}(),e=bu(u([d(p(v)),s(m)])),o=_.noop,w=_.noop,new Ct(e,o,w)},ku=function(n,t){var e,i,r,o,s,c,l,f,h,d,g,v,p,m,w,b,y,k,x,C,q,S,W,O;return v=_.map(Rr(t,vt),function(t){var e,i;return i=function(){var i,r,o,u;for(o=t.position.coordinates,u=[],i=0,r=o.length;r>i;i++)e=o[i],u.push(n.evaluate(e.field));return u}(),Pi(t,i)}),y=_.map(v,function(n){return n.space}),C=Vr(y,function(n){return n.x}),q=Vr(y,function(n){return n.y}),w=Gi(C),b=Gi(q),h=w.type===me&&b.type===ye?Qr(w.domain):w.domain,d=b.type===me&&w.type===ye?Qr(b.domain):b.domain,e=li(w.type,h),i=li(b.type,d),l=null!=(W=Lr(t,u))?W:new u(Math.min(xo.maxCanvasSize.width,i.width+e.height),Math.min(xo.maxCanvasSize.height,e.width+i.height)),f=new a(l.width,l.height,new dt(Math.min(.3*xo.maxCanvasSize.width,i.width),0,0,Math.min(.3*xo.maxCanvasSize.height,e.width))),r=f.regions.bottom,o=f.regions.left,p=new $t(0,r.width),m=b.type===me?new $t(o.height,0):new $t(0,o.height),s=mi(w.type,wi(C),h,p,r),c=mi(b.type,wi(q),d,m,o),g=_.map(v,function(t){var e,i,r,o,u;r=t.geometry,i=r.encode(n,t,s,c),e={};for(o in i)u=i[o],(null!=u?u.encode:void 0)&&(e[o]=u.encode);return new at(i,e,r.mask,r.highlight,r.render,r.select)}),O=Si(),k=O[0],x=O[1],nr=O[2],S=Qi(f,n,g,s,c,nr),S.render(),new Ct(S.viewport.container,k,x)},Au=nr([A,Array,Function,function(n,t,e){return n.read(function(n,i){return n?e(n):Au(i,t,e)})}],[Z,Array,Function,function(n,t,e){var i;try{return e(null,Su(n,t))}catch(r){return i=r,e(i)}}]),oo=function(){return Ui({".vx-tooltip":{background:"#2c2c2c",color:"#fff","font-size":"12px"},".vx-tooltip th, .vx-tooltip td":{padding:"0px 4px","vertical-align":"middle"},".vx-tooltip th":{"text-align":"left"},".vx-table th, .vx-table td":{padding:"0px 8px","vertical-align":"middle"},".vx-table tbody > tr:nth-child(odd)":{"background-color":"#f3f3f3"},".vx-table .vx-number":{"text-align":"right"}})},Bu=null,zu=18,ro=function(){var n,t;return Bu=n=bi(new u(100,100)),t=n.context,t.font=xo.axisLabelFont,zu=t.measureText("M").width},Ru=!1,io=function(){return Ru?void 0:(oo(),ro(),Ru=!0)},po=function(){var n,t;return t=1<=arguments.length?Vu.call(arguments,0):[],(n=Lr(t,A,Z))?(io(),function(e){return Au(n,_.without(t,n),e)
}):function(){var n;return n=1<=arguments.length?Vu.call(arguments,0):[],po.apply(null,t.concat(n))}},po.VERSION="999.999.999",po.from=To,po.value=ru,po.domain=Co,po.range=Uo,po.position=Ho,po.fillColor=Wo,po.fillOpacity=Oo,po.strokeColor=nu,po.strokeOpacity=tu,po.size=Zo,po.width=uu,po.height=Mo,po.lineWidth=Fo,po.shape=Qo,po.factor=So,po.groupBy=No,po.select=Ko,po.where=ou,po.having=Xo,po.eq=qo,po.ne=Bo,po.lt=jo,po.gt=Yo,po.le=Ao,po.ge=Eo,po.like=Io,po.avg=ko,po.count=_o,po.max=zo,po.min=Ro,po.sum=eu,po.parse=Vo,po.point=Go,po.rect=$o,po.path=Do,po.schema=Jo,po.table=iu,po.createFrame=Ni,po.createVector=Ji,po.createList=Mi,po.createFactor=Oi,null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=po:window.plot=po}).call(this);