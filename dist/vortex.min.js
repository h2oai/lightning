(function(){var t,n,e,i,r,o,u,a,s,c,l,f,h,d,v,g,p,m,w,b,y,k,x,C,q,S,W,O,T,E,N,Y,X,M,P,A,I,F,j,z,R,B,L,V,D,G,H,U,J,K,Q,Z,tn,nn,en,rn,on,un,an,sn,cn,ln,fn,hn,dn,vn,gn,pn,mn,wn,bn,yn,kn,_n,xn,Cn,qn,Sn,Wn,On,Tn,En,Nn,Yn,Xn,Mn,Pn,An,In,Fn,jn,zn,Rn,Bn,Ln,Vn,Dn,Gn,Hn,Un,$n,Jn,Kn,Qn,Zn,te,ne,ee,ie,re,oe,ue,ae,se,ce,le,fe,he,de,ve,ge,pe,me,we,be,ye,ke,_e,xe,Ce,qe,Se,We,Oe,Te,Ee,Ne,Ye,Xe,Me,Pe,Ae,Ie,Fe,je,ze,Re,Be,Le,Ve,De,Ge,He,Ue,$e,Je,Ke,Qe,Ze,ti,ni,ei,ii,ri,oi,ui,ai,si,ci,li,fi,hi,di,vi,gi,pi,mi,wi,bi,yi,ki,_i,xi,Ci,qi,Si,Wi,Oi,Ti,Ei,Ni,Yi,Xi,Mi,Pi,Ai,Ii,Fi,ji,zi,Ri,Bi,Li,Vi,Di,Gi,Hi,Ui,$i,Ji,Ki,Qi,Zi,tr,nr,er,ir,rr,or,ur,ar,sr,cr,lr,fr,hr,dr,vr,gr,pr,mr,wr,br,yr,kr,_r,xr,Cr,qr,Sr,Wr,Or,Tr,Er,Nr,Yr,Xr,Mr,Pr,Ar,Ir,Fr,jr,zr,Rr,Br,Lr,Vr,Dr,Gr,Hr,Ur,$r,Jr,Kr,Qr,Zr,to,no,eo,io,ro,oo,uo,ao,so,co,lo,fo,ho,vo,go,po,mo,wo,bo,yo,ko,_o,xo,Co,qo,So,Wo,Oo,To,Eo,No,Yo,Xo,Mo,Po,Ao,Io,Fo,jo,zo,Ro,Bo,Lo,Vo,Do,Go,Ho,Uo,$o,Jo,Ko,Qo,Zo,tu,nu,eu,iu,ru,ou,uu,au,su,cu,lu,fu,hu,du,vu,gu,pu,mu,wu,bu,yu,ku,_u,xu,Cu,qu,Su,Wu,Ou,Tu,Eu,Nu,Yu,Xu,Mu,Pu,Au,Iu,Fu,ju,zu,Ru,Bu,Lu,Vu,Du=[].slice,Gu={}.hasOwnProperty,Hu=function(t,n){function e(){this.constructor=t}for(var i in n)Gu.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};ju=Math.PI,zu=2*ju,rn=ju/2,Fu=1e-6,V=Fu*Fu,Mn=ju/180,F=180/ju,Ce=Math.tan(30*Mn),ue=Math.sqrt(3),y=16581375,We="transparent",_e="undefined",me="null",de="Boolean",ke="String",we="Number",pe="Function",be="Object",he="Array",fe="Arguments",ve="Date",ye="RegExp",ge="Error",Au=function(t){var n;if(n=Object.prototype.toString.call(t),null===t)return me;if(void 0===t)return _e;if(t===!0||t===!1||"[object Boolean]"===n)return de;switch(n){case"[object String]":return ke;case"[object Number]":return we;case"[object Function]":return pe;case"[object Object]":return be;case"[object Array]":return he;case"[object Arguments]":return fe;case"[object Date]":return ve;case"[object RegExp]":return ye;case"[object Error]":return ge;default:return n}},wn=function(){function t(t,n){this.match=t,this.func=n}return t}(),nr=function(){var t,n;return t=function(n){var e,i,r;switch(i=Au(n)){case _e:return function(t){return void 0===t};case me:return function(t){return null===t};case de:return function(t){return n===Boolean||t===n};case ke:return function(t){return n===String||t===n};case we:return function(t){return n===Number||t===n||_.isNaN(t)&&_.isNaN(n)};case ye:return function(){return n===RegExp};case Error:return function(){return n===Error};case ve:return function(t){return n===Date||t===n};case he:return 1===n.length&&pe===(r=Au(n[0]))?(e=t(n[0]),function(t){var n,i,r;if(he!==Au(t))return!1;for(i=0,r=t.length;r>i;i++)if(n=t[i],!e(n))return!1;return!0}):function(t){return n===Array||Ke(n,t)};case pe:return function(t){var e;return t instanceof n?!0:t&&t.constructor===n?!0:(e=Au(t),n===Boolean&&e===de||n===String&&e===ke||n===Number&&e===we)};case be:return function(t){var e,i;for(e in n)if(i=n[e],t[e]!==i)return!1;return!0};default:return function(){return!1}}},n=function(n){var e;return e=_.map(n,t),function(t){var n,i,r,o;if(0===t.length)return!1;if(t.length!==e.length)return!1;for(i=r=0,o=e.length;o>r;i=++r)if(n=e[i],!n(t[i]))return!1;return!0}},function(){var t,e;return t=1<=arguments.length?Du.call(arguments,0):[],e=_.map(t,function(t){var e,i,r;return i=2<=t.length?Du.call(t,0,r=t.length-1):(r=0,[]),e=t[r++],new wn(n(i),e)}),function(){var t,n,i,r;for(t=1<=arguments.length?Du.call(arguments,0):[],i=0,r=e.length;r>i;i++)if(n=e[i],n.match(t))return n.func.apply(null,t);throw new Error("Pattern match failure for args [ "+_.map(t,function(t){return""+t+":"+Au(t)}).join(", ")+" ]")}}}(),v=function(){function t(t,n){this.put=t,this.test=n}return t}(),mn=function(){function t(t,n){this.put=t,this.test=n}return t}(),ne=function(){function t(t,n){this.width=t,this.height=n}return t}(),An=function(){function t(t,n,e,i){this.left=t,this.top=n,this.width=e,this.height=i}return t}(),je=function(){function t(t,n,e,i,r,o,u){this.name=t,this.label=n,this.type=e,this.at=i,this.count=r,this.domain=o,this.format=u}return t}(),G=function(t){function n(t,e,i,r,o,u,a,s){this.valueAt=o,n.__super__.constructor.call(this,t,e,i,r,u,a,s)}return Hu(n,t),n}(je),hn=function(t){function n(t,e,i,r,o,u){n.__super__.constructor.call(this,t,e,be,i,r,o,u)}return Hu(n,t),n}(je),nn=function(){function t(){}return t}(),Z=function(){function t(t,n,e,i,r,o,u,a,s){this.label=t,this.vectors=n,this.schema=e,this.indices=i,this.cube=r,this.at=o,this.evaluate=u,this.attach=a,this.metadata=s}return t}(),Oe=function(){function t(t){this.value=t}return t}(),bn=function(t){function n(t){n.__super__.constructor.call(this,t)}return Hu(n,t),n}(Oe),ae=function(t){function n(t){n.__super__.constructor.call(this,t)}return Hu(n,t),n}(Oe),I=function(t){function n(t){n.__super__.constructor.call(this,t)}return Hu(n,t),n}(Oe),o=function(t){function n(t){n.__super__.constructor.call(this,t)}return Hu(n,t),n}(Oe),U=function(){function t(t){this.name=t}return t}(),dn=function(t){function n(t){this.evaluate=t}return Hu(n,t),n}(U),Fn=function(t){function n(t){this.evaluate=t}return Hu(n,t),n}(U),J=function(){function t(t,n){this.color=t,this.opacity=n}return t}(),se=function(){function t(t,n,e){this.color=t,this.opacity=n,this.size=e}return t}(),xe=function(){function t(){}return t}(),pn=function(){function t(){}return t}(),Wn=function(t){function n(t,n,e,i,r,o,u,a){this.position=t,this.shape=n,this.size=e,this.fillColor=i,this.fillOpacity=r,this.strokeColor=o,this.strokeOpacity=u,this.lineWidth=a}return Hu(n,t),n}(pn),_n=function(t){function n(t,n,e,i){this.position=t,this.strokeColor=n,this.strokeOpacity=e,this.lineWidth=i}return Hu(n,t),n}(pn),zn=function(t){function n(t,n,e,i){this.position=t,this.strokeColor=n,this.strokeOpacity=e,this.lineWidth=i}return Hu(n,t),n}(pn),In=function(t){function n(t,n,e,i,r,o,u,a){this.position=t,this.width=n,this.height=e,this.fillColor=i,this.fillOpacity=r,this.strokeColor=o,this.strokeOpacity=u,this.lineWidth=a}return Hu(n,t),n}(pn),gn=function(){function t(){}return t}(),Tn=function(t){function n(t,n,e,i,r,o,u,a,s,c){this.space=t,this.positionX=n,this.positionY=e,this.shape=i,this.size=r,this.fillColor=o,this.fillOpacity=u,this.strokeColor=a,this.strokeOpacity=s,this.lineWidth=c,this.geometry=On}return Hu(n,t),n}(gn),Ln=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.space=t,this.q0=n,this.q1=e,this.q2=i,this.q3=r,this.qn=o,this.positionY=u,this.height=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=Bn}return Hu(n,t),n}(gn),Gn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.space=t,this.positionX=n,this.q0=e,this.q1=i,this.q2=r,this.q3=o,this.qn=u,this.width=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=Dn}return Hu(n,t),n}(gn),m=function(t){function n(t,n,e,i,r,o,u,a,s,c){this.space=t,this.positionX=n,this.positionY1=e,this.positionY2=i,this.width=r,this.fillColor=o,this.fillOpacity=u,this.strokeColor=a,this.strokeOpacity=s,this.lineWidth=c,this.geometry=p}return Hu(n,t),n}(gn),r=function(t){function n(t,n,e,r,o,u,a,s,c,l){this.space=t,this.positionX1=n,this.positionX2=e,this.positionY=r,this.height=o,this.fillColor=u,this.fillOpacity=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=i}return Hu(n,t),n}(gn),Cn=function(t){function n(t,n,e,i,r,o){this.space=t,this.positionX=n,this.positionY=e,this.strokeColor=i,this.strokeOpacity=r,this.lineWidth=o,this.geometry=xn}return Hu(n,t),n}(gn),qe=function(t){function n(t,n,e,i,r,o,u){this.space=t,this.positionX=n,this.positionY=e,this.text=i,this.size=r,this.fillColor=o,this.fillOpacity=u,this.geometry=TextGeometry}return Hu(n,t),n}(gn),L=function(){function t(){}return t}(),Sn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.positionX=t,this.positionY=n,this.shape=e,this.size=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Hu(n,t),n}(L),Rn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.q0=t,this.q1=n,this.q2=e,this.q3=i,this.qn=r,this.positionY=o,this.height=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Hu(n,t),n}(L),Vn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.positionX=t,this.q0=n,this.q1=e,this.q2=i,this.q3=r,this.qn=o,this.width=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Hu(n,t),n}(L),g=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.positionX=t,this.positionY1=n,this.positionY2=e,this.width=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Hu(n,t),n}(L),e=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.positionX1=t,this.positionX2=n,this.positionY=e,this.height=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Hu(n,t),n}(L),kn=function(t){function n(t,n,e,i,r,o){this.positionX=t,this.positionY=n,this.stroke=e,this.strokeColor=i,this.strokeOpacity=r,this.lineWidth=o}return Hu(n,t),n}(L),oe=function(){function t(t,n){this.x=t,this.y=n}return t}(),re=function(){function t(t,n,e){this.type=t,this.vectors=n,this.domain=e}return t}(),n=function(){function t(){}return t}(),c=function(t){function n(t,n,e,i,r,o,u){this.type=t,this.label=n,this.scale=e,this.domain=i,this.range=r,this.rect=o,this.guide=u}return Hu(n,t),n}(n),fn=function(t){function n(t,n,e,i,r,o,u){this.type=t,this.label=n,this.scale=e,this.domain=i,this.range=r,this.rect=o,this.guide=u}return Hu(n,t),n}(n),Se=function(){function t(t,n){this.value=t,this.label=n}return t}(),B=function(){function t(t,n){this.label=t,this.encode=n}return t}(),C=function(t){function n(t){this.value=t,n.__super__.constructor.call(this,"Constant",Je(t))}return Hu(n,t),n}(B),Te=function(t){function n(t,e,i){this.vector=i,n.__super__.constructor.call(this,t,e)}return Hu(n,t),n}(B),Nn=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Hu(n,t),n}(Te),b=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Hu(n,t),n}(Te),yn=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Hu(n,t),n}(Te),ie=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Hu(n,t),n}(Te),Qn=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Hu(n,t),n}(Te),d=function(){function t(){}return t}(),w=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),M=function(t){function n(t){this.field=t}return Hu(n,t),n}(d),En=function(t){function n(t){this.coordinates=t}return Hu(n,t),n}(d),K=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),Q=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),ce=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),le=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),ee=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),Le=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),un=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),ln=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),Kn=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(d),q=function(t){function n(t){this.value=t}return Hu(n,t),n}(K),Ee=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(K),S=function(t){function n(t){this.value=t}return Hu(n,t),n}(Q),Ne=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(Q),N=function(t){function n(t){this.value=t}return Hu(n,t),n}(ce),Ae=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(ce),Y=function(t){function n(t){this.value=t}return Hu(n,t),n}(le),Ie=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(le),E=function(t){function n(t){this.value=t}return Hu(n,t),n}(ee),Pe=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(ee),X=function(t){function n(t){this.value=t}return Hu(n,t),n}(Le),Fe=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(Le),W=function(t){function n(t){this.value=t}return Hu(n,t),n}(un),Ye=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(un),O=function(t){function n(t){this.value=t}return Hu(n,t),n}(ln),Xe=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(ln),T=function(t){function n(t){this.value=t}return Hu(n,t),n}(Kn),Me=function(t){function n(t,n){this.field=t,this.range=n}return Hu(n,t),n}(Kn),D=function(){function t(t,n){this.min=t,this.max=n}return t}(),Pn=function(){function t(){}return t}(),l=function(t){function n(t){this.values=t}return Hu(n,t),n}(Pn),Yn=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(Pn),Jn=function(t){function n(t,n){this.min=t,this.max=n}return Hu(n,t),n}(Yn),R=function(t){function n(t,n,e){this.min=t,this.mid=n,this.max=e}return Hu(n,t),n}(Yn),x=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Hu(n,t),n}(Pn),$n=function(t){function n(t,n){this.min=t,this.max=n}return Hu(n,t),n}(x),z=function(t){function n(t,n,e){this.min=t,this.mid=n,this.max=e}return Hu(n,t),n}(x),tn=function(){function t(t,n,e,i,r){this.encode=t,this.mask=n,this.highlight=e,this.render=i,this.select=r}return t}(),A=function(){function t(t){this.read=t}return t}(),s=function(){function t(t,n,e,i){this.element=t,this.context=n,this.bounds=e,this.ratio=i}return t}(),ze=function(){function t(t,n,e,i,r,o,u,a,s,c,l){this.box=t,this.container=n,this.baseCanvas=e,this.highlightCanvas=i,this.hoverCanvas=r,this.maskCanvas=o,this.clipCanvas=u,this.marquee=a,this.tooltip=s,this.mask=c,this.clip=l}return t}(),sn=function(){function t(t,n,e,i,r,o){this.encodings=t,this.encoders=n,this.mask=e,this.highlight=i,this.render=r,this.select=o}return t}(),Re=function(){function t(t,n,e,i,r,o,u,a){this.viewport=t,this.frame=n,this.test=e,this.highlight=i,this.hover=r,this.selectAt=o,this.selectWithin=u,this.render=a}return t}(),qn=function(){function t(t,n,e){this.element=t,this.subscribe=n,this.unsubscribe=e}return t}(),u=function(){function t(t,n){this.width=t,this.height=n}return t}(),jn=function(){function t(t,n,e,i,r){this.center=t,this.left=n,this.top=e,this.right=i,this.bottom=r}return t}(),vn=function(){function t(t,n,e,i){this.left=t,this.top=n,this.right=e,this.bottom=i}return t}(),a=function(){function t(t,n,e){var i;this.width=t,this.height=n,this.margin=e,this.regions=new jn(i=new An(e.left,e.top,t-e.left-e.right,n-e.top-e.bottom),new An(0,e.top,e.left,i.height),new An(e.left+i.width,e.top,e.right,i.height),new An(e.left,0,i.width,e.top),new An(e.left,e.top+i.height,i.width,e.bottom))}return t}(),Xn=function(){function t(t,n,e,i){this.select=t,this.where=n,this.group=e,this.having=i}return t}(),f=function(){function t(t,n){this.key=t,this.value=n}return t}(),t=new f(0,"All"),P=function(){function t(t,n,e,i){this.frame=t,this.hierarchy=n,this.cells=e,this.dimension=i}return t}(),cn=function(){function t(t,n,e){this.category=t,this.indices=n,this.children=e}return t}(),h=function(){function t(t,n){this.levels=t,this.indices=n}return t}(),H=function(){function t(t,n,e,i,r){this.at=t,this.valueAt=n,this.count=e,this.domain=i,this.format=r}return t}(),en=function(){function t(t){this.fields=t}return t}(),Un=function(){function t(t,n,e){this.name=t,this.fields=n,this.func=e}return t}(),Be=function(){function t(t,n){this.fields=t,this.predicate=n}return t}(),on=function(){function t(t,n){this.fields=t,this.predicate=n}return t}(),an=function(){function t(t,n){this.vectors=t,this.index=n}return t}(),Hn=function(){function t(t,n){this.vectors=t,this.indices=n}return t}(),j=function(){function t(t){this.vectors=t}return t}(),Mu=function(t){return t*t},ei=function(t,n){return function(e){return t>e?t:e>n?n:e}},ni=ei(0,1),tr=8,pi=function(t){return t.slice(0)},Dr=function(t,n){var e,i,r,o,u,a,s,c;for(r=[],o=0,a=t.length;a>o;o++)for(e=t[o],c=n(e),u=0,s=c.length;s>u;u++)i=c[u],r.push(i);return r},vo=function(){var t,n;return n=arguments[0],t=2<=arguments.length?Du.call(arguments,1):[],function(){return n.apply(null,t)}},Je=function(t){return function(){return t}},Ke=function(t,n){var e,i,r,o;if(t&&n&&t.length===n.length){for(e=r=0,o=t.length;o>r;e=++r)if(i=t[e],i!==n[e])return!1;return!0}return!1},Br=function(){var t,n,e,i,r,o,u,a,s;for(n=arguments[0],r=2<=arguments.length?Du.call(arguments,1):[],e=[],o=0,a=n.length;a>o;o++)for(t=n[o],u=0,s=r.length;s>u;u++)i=r[u],t instanceof i&&e.push(t);return e},Vr=function(){var t,n,e,i,r,o,u,a;for(n=arguments[0],i=2<=arguments.length?Du.call(arguments,1):[],r=0,u=n.length;u>r;r++)for(t=n[r],o=0,a=i.length;a>o;o++)if(e=i[o],t instanceof e)return t},Oi=function(t,n){return n>t?new D(t,n):new D(n,t)},hi=function(t){var n,e,i,r,o;for(e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=0,o=t.length;o>r;r++)i=t[r],void 0!==i&&(e>=i&&(e=i),i>=n&&(n=i));return new D(e,n)},gi=function(t){return function(n){return n.min>=t&&n.max>t?1:n.min<t&&n.max<=t?-1:0}},vi=gi(0),ci=function(t,n){return new D(Math.min(t.min,n.min),Math.max(t.max,n.max))},to=function(t){return function(n){return n.min>t&&n.max>t?new D(t,n.max):n.min<t&&n.max<t?new D(n.min,t):n}},Zr=to(0),Pi=function(t,n,e){var i,r,o;return r=function(){return n.length},i=function(t){return n[t]},o=e?function(t){return e(n[t])}:i,new hn(t,t,i,r,n,o)},Ki=function(t,n,e,i){var r,o,u,a;return u=hi(e),o=function(){return e.length},r=function(t){return e[t]},a=i?function(t){return i(e[t])}:r,new je(t,t,n,r,o,u,a)},Rr=function(t,n,e){var i,r,o,u,a,s,c,l,h,d,v,g,p;for(p=0,v={},l=n(),o=new Array(l),u=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)h=e[t],i.push(v[h]=new f(p++,h));return i}(),c=g=0;l>=0?l>g:g>l;c=l>=0?++g:--g)a=t(c),h=void 0!==a?a:"?",(r=v[h])||u.push(v[h]=r=new f(p++,h)),o[c]=r;return i=function(t){return o[t]},d=function(t){return o[t].value},s=function(t){return o[t].value},new H(i,d,n,u,s)},Ti=function(t,n,e,i){var r,o,u;return o=function(){return e.length},r=function(t){return e[t]},u=Rr(r,o,i||[]),new G(t,t,n,u.at,u.valueAt,o,u.domain,u.format)},Yi=function(t,n,e,i,r){var o,u;return u=_.indexBy(n,function(t){return t.name}),o=new Z(t,n,u,e,i,null,null,null,r||{}),o.evaluate=function(n){var e;if(n instanceof dn)return o.evaluate(n.evaluate(o));if(n instanceof Fn){if(i)return o.evaluate(n.evaluate(o,i));throw new Error("Cannot compute aggregate ["+n.name+"] on an unaggregated frame.")}if(e=u[n.name])return e;throw new Error("Vector ["+n.name+"] does not exist in frame ["+t+"].")},o.attach=function(e){if(u[e.name])throw new Error("Cannot attach vector ["+e.name+"]: a vector by that name already exists in frame ["+t+"]");return n.push(e),u[e.name]=e,e},o.exists=function(t){return u[t]?!0:!1},o},wr=function(t){var n,e,i,r,o,u,a,s,c,l,f;for(u=new Array(t.indices.length),e=_.map(t.vectors,function(t){return t instanceof G?t.valueAt:t.at}),f=t.indices,a=0,c=f.length;c>a;a++)for(i=f[a],u[i]=o=new Array(t.vectors.length),r=s=0,l=e.length;l>s;r=++s)n=e[r],o[r]=n(i);return u},Bi=function(t){return new Xn(Br(t,Un),Br(t,Be),Br(t,en),Br(t,on))},Ni=function(t){return _.map(t,function(t){return new U(t)})},Ei=function(t){return new dn(function(n){var e,i,r,o,u,a,s,c;if(s=n.evaluate(t),s instanceof G)return t;for(u=s.count(),e=s.at,r=new Array(u),o=c=0;u>=0?u>c:c>u;o=u>=0?++c:--c)void 0!==(a=e(o))&&(r[o]=""+a);return n.attach(i=Ti("factor("+s.label+")",ke,r)),new U(i.name)})},Wo=nr([String,function(t){return Ei(new U(t))}],[U,function(t){return Ei(t)}]),cu=function(t){var n;return n=ei(0,t.length-1),function(e){return t[n(-1+Math.round(e*t.length))]}},di=function(t){var n,e,i,r,o,u,a,s;return s=function(){var n,e,i;for(i=[],n=0,e=t.length;e>n;n++)a=t[n],(a||0===a)&&i.push(a);return i}(),s.sort(function(t,n){return t-n}),e=s[0],n=s[s.length-1],u=cu(s),i=u(.25),r=u(.5),o=u(.75),[e,i,r,o,n]},De=function(t){var n,e,i,r,o;for(e=0,n=0,r=0,o=t.length;o>r;r++)i=t[r],void 0!==i&&(e+=i,n++);return e/n},Ge=function(t){var n,e,i,r;for(n=0,i=0,r=t.length;r>i;i++)e=t[i],void 0!==e&&n++;return n},He=function(t){var n,e,i,r;for(n=Number.NEGATIVE_INFINITY,i=0,r=t.length;r>i;i++)e=t[i],void 0!==e&&e>=n&&(n=e);return n},Ue=function(t){var n,e,i,r;for(n=Number.POSITIVE_INFINITY,i=0,r=t.length;r>i;i++)e=t[i],void 0!==e&&n>=e&&(n=e);return n},$e=function(t){var n,e,i,r;for(n=0,i=0,r=t.length;r>i;i++)e=t[i],void 0!==e&&(n+=e);return n},mi=function(t,n,e,i,r){return new Fn(function(o,u){var a,s,c,l,f,h,d,v,g,p,m,w,b,y,k,_;if(d=""+n+"("+t.name+")",o.exists(d))return new U(d);for(p=u.frame.evaluate(t),a=p.at,l=new Array(u.cells.length),k=u.cells,h=m=0,b=k.length;b>m;h=++m){for(s=k[h],g=[],_=s.indices,w=0,y=_.length;y>w;w++)f=_[w],void 0!==(v=a(f))&&g.push(v);l[h]=r(g)}return o.attach(c=Ki(d,e,l,i)),new U(c.name)})},ko=function(t,n,e,i){return nr([String,function(r){return mi(new U(r),t,n,e,i)}],[U,function(r){return mi(r,t,n,e,i)}])},_o=ko("avg",we,_.identity,De),xo=ko("count",we,_.identity,Ge),Ro=ko("max",we,_.identity,He),Bo=ko("min",we,_.identity,Ue),iu=ko("sum",we,_.identity,$e),Yo=function(){var t,n,e;return n=1<=arguments.length?Du.call(arguments,0):[],e=function(){var e,i,r;for(r=[],e=0,i=n.length;i>e;e++)if(t=n[e],t instanceof U)r.push(t);else{if(!_.isString(t))throw new Error("Cannot group by ["+t+"]");r.push(new U(t))}return r}(),new en(e)},bo=nr([String,[String],Function,function(t,n,e){return new Un(t,Ni(n),e)}]),Qo=function(){var t,n,e,i;return e=arguments[0],n=3<=arguments.length?Du.call(arguments,1,i=arguments.length-1):(i=1,[]),t=arguments[i++],bo(e,n.length?n:[e],t)},yo=nr([[String],Function,function(t,n){return new Be(Ni(t),n)}]),uu=function(){var t,n,e;return n=2<=arguments.length?Du.call(arguments,0,e=arguments.length-1):(e=0,[]),t=arguments[e++],yo(n,t)},wo=nr([[String],Function,function(t,n){return new on(Ni(t),n)}],[[U],Function,function(t,n){return new on(t,n)}]),Mo=function(){var t,n,e;return n=2<=arguments.length?Du.call(arguments,0,e=arguments.length-1):(e=0,[]),t=arguments[e++],wo(n,t)},So=function(t){return function(n){return n===t}},Lo=function(t){return function(n){return n!==t}},zo=function(t){return function(n){return t>n}},Xo=function(t){return function(n){return n>t}},Io=function(t){return function(n){return t>=n}},No=function(t){return function(n){return n>=t}},Fo=function(t){if(ye!==Au(t))throw new Error("like ["+t+"]: expecting RegExp");return function(n){return t.test(n)}},Ao=function(){var t;return t=1<=arguments.length?Du.call(arguments,0):[],function(n){var e,i,r;for(i=0,r=t.length;r>i;i++)if(e=t[i],e===n)return!0;return!1}},Vo=function(){var t;return t=1<=arguments.length?Du.call(arguments,0):[],function(n){var e,i,r;for(i=0,r=t.length;r>i;i++)if(e=t[i],e===n)return!1;return!0}},lu=function(n,e){var i,r,o,u,a,s,c,l,f;return c=e.where.length?Yi(n.label,n.vectors,Lr(n,e.where)):n,e.group.length?(s=Dr(e.group,function(t){return t.fields}),u=function(){var t,n,e;for(e=[],t=0,n=s.length;n>t;t++){if(a=s[t],f=c.evaluate(a),!(f instanceof G))throw new Error("Cannot group by ["+a.name+"]: not a Factor.");e.push(f)}return e}(),l={0:new cn(t,c.indices,{})},Qe(l,u,0),r=[],oi(l[0].children,s.length-1,r,0,new Array(s.length)),o=new P(c,l,r,s.length),i=Ve(c.label+"'",o,u),e.having.length?Yi(i.label,i.vectors,Lr(i,e.having),i.cube):i):c},Lr=function(t,n){var e,i,r,o,u,a,s,c,l,f,h,d,v,g,p,m;for(h=t.indices,f=0,g=n.length;g>f;f++){for(c=n[f],a=[],l=function(){var n,e,i,r;for(i=c.fields,r=[],n=0,e=i.length;e>n;n++)o=i[n],r.push(t.evaluate(o));return r}(),r=_.map(l,function(t){return t instanceof G?t.valueAt:t.at}),d=0,p=h.length;p>d;d++){for(u=h[d],e=new Array(l.length),s=v=0,m=r.length;m>v;s=++v)i=r[s],e[s]=i(u);c.predicate.apply(null,e)&&a.push(u)}h=a}return h},Ve=function(t,n,e){var i,r,o;return i=_.range(n.cells.length),o=function(){var t,i,o;for(o=[],r=t=0,i=n.dimension;i>=0?i>t:t>i;r=i>=0?++t:--t)o.push(zr(n,e[r],r));return o}(),Yi(t,o,i,n)},Qe=function(t,n,e){var i,r,o,u,a,s,c,l,f,h;i=n[e].at;for(s in t){for(c=t[s],u=c.children,h=c.indices,l=0,f=h.length;f>l;l++)a=h[l],r=i(a),(o=u[r.key])||(u[r.key]=o=new cn(r,[],{})),o.indices.push(a);e<n.length-1&&Qe(u,n,e+1)}},oi=function(t,n,e,i,r){var o,u;for(o in t)u=t[o],r[i]=u,i===n?e.push(new h(pi(r),u.indices)):oi(u.children,n,e,i+1,r)},zr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g;for(a=new Array(t.cells.length),s={},c=[],g=t.cells,f=d=0,v=g.length;v>d;f=++d)o=g[f],a[f]=r=o.levels[e].category,s[r.value]||(s[r.value]=r,c.push(r));return i=function(t){return a[t]},h=function(t){return a[t].value},l=function(t){return a[t].value},u=function(){return a.length},new G(n.label,n.label,n.type,i,h,u,c,l)},k={c10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],c20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],c20b:["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],c20c:["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"]},go=function(t){return t>10?k.c20:k.c10},ri=function(t){var n,e,i,r;return r=t.rgb(),i=r[0],e=r[1],n=r[2],chroma.rgb(i,e,n)},ai=function(t){return t.css()},si=function(t,n){return ri(t).alpha(n).css()},lr=function(t,n,e,i){var r;return r=Math.sqrt(i/ju),t.beginPath(),t.arc(n,e,r,0,zu,!1),t.closePath()},dr=function(t,n,e,i){var r;return r=.5*Math.sqrt(i),t.save(),t.translate(n,e),t.beginPath(),t.moveTo(r,r),t.lineTo(-r,r),t.lineTo(-r,-r),t.lineTo(r,-r),t.closePath(),t.restore()},fr=function(t,n,e,i){var r,o;return r=.5*Math.sqrt(i/5),o=3*r,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(o,r),t.lineTo(r,r),t.lineTo(r,o),t.lineTo(-r,o),t.lineTo(-r,r),t.lineTo(-o,r),t.lineTo(-o,-r),t.lineTo(-r,-r),t.lineTo(-r,-o),t.lineTo(r,-o),t.lineTo(r,-r),t.lineTo(o,-r),t.closePath(),t.restore()},hr=function(t,n,e,i){var r,o;return o=Math.sqrt(i/(2*Ce)),r=o*Ce,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(r,0),t.lineTo(0,o),t.lineTo(-r,0),t.lineTo(0,-o),t.closePath(),t.restore()},mr=function(t,n,e,i){var r,o;return r=Math.sqrt(i/ue),o=r*ue/2,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(0,-o),t.lineTo(r,o),t.lineTo(-r,o),t.closePath(),t.restore()},vr=function(t,n,e,i){var r,o;return r=Math.sqrt(i/ue),o=r*ue/2,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(0,o),t.lineTo(r,-o),t.lineTo(-r,-o),t.closePath(),t.restore()},pr=function(t,n,e,i){var r,o;return o=Math.sqrt(i/ue),r=o*ue/2,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(r,0),t.lineTo(-r,o),t.lineTo(-r,-o),t.closePath(),t.restore()},gr=function(t,n,e,i){var r,o;return o=Math.sqrt(i/ue),r=o*ue/2,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(-r,0),t.lineTo(r,-o),t.lineTo(r,o),t.closePath(),t.restore()},te={circle:lr,square:dr,cross:fr,diamond:hr,triangleUp:mr,triangleDown:vr,triangleLeft:gr,triangleRight:pr},Zn={c8:["circle","square","cross","diamond","triangleUp","triangleDown","triangleLeft","triangleRight"]},po=function(){return Zn.c8},Ou=function(t){return function(n){return void 0!==n?t(n):void 0}},Fi=function(t,n){var e;return e=d3.scale.linear().domain([t.min,t.max]).range([n.min,n.max]).nice(),[Ou(e),e.tickFormat,e.ticks]},ji=function(t,n){var e,i,r,o,u,a,s;for(a=0,o={},u=0,s=t.length;s>u;u++)e=t[u],o[e.key]=a++;return i=(n.max-n.min)/t.length/2,r=n.min,Ou(function(t){return r+2*o[t.key]*i+i})},ki=function(t,n){var e,i;return i=n.values,e=i.length,Ou(function(t){return i[t.key%e]})},Gi=function(t,n){return Ou(d3.scale.linear().domain([t.min,t.max]).range([n.min,n.max]))},Si=function(t,n){return Ou(d3.scale.linear().domain([t.min,t.mid,t.max]).range([n.min,n.mid,n.max]))},Di=function(t,n){return Ou(chroma.scale([n.min,n.max]).domain([t.min,t.max]).mode("lch"))},qi=function(t,n){var e,i;return e=chroma.scale([n.min,n.mid]).domain([t.min,t.mid]).mode("lch"),i=chroma.scale([n.mid,n.max]).domain([t.mid,t.max]).mode("lch"),function(n){return void 0!==n?n<t.mid?e(n):i(n):void 0}},xi=nr([Jn,x,Di],[R,x,qi]),Mi=nr([Jn,Jn,Gi],[R,R,Si]),Ze=function(t){var n;return n=t.toString(16),1===n.length?"0"+n:n},_i=function(t){var n,e,i,r;return n=t.context,i=t.ratio,e=function(){return"#fff"},r=function(t,e){var r,o,u,a,s;return s=n.getImageData(t*i,e*i,1,1).data,a=s[0],u=s[1],o=s[2],r=s[3],255===a&&255===u&&255===o&&255===r},new v(e,r)},Ii=function(t){var n,e,i,r,o,u;return n=t.context,r=t.ratio,u=0,e={},i=function(t){var n,i,r,o;return i=u++,u>=y&&(u=0),e[i]=t,o=i>>16&255,r=i>>8&255,n=255&i,"#"+Ze(o)+Ze(r)+Ze(n)},o=function(t,i){var o,u,a,s,c,l;return l=n.getImageData(t*r,i*r,1,1).data,c=l[0],s=l[1],u=l[2],o=l[3],255===o?(a=(c<<16)+(s<<8)+u,e[a]):void 0},new mn(i,o)},Er=function(t,n){var e,i,r,o,u,a,s;return s=t.scale,i=t.domain,a=t.range,o=t.guide,u=n.label,e=n.at,r=function(t){return s(e(t))},new Nn(u,r,n,i,a,o)},xr=function(t,n){return new C(t.scale(n))},_r=function(t,n){var e,i,r,o,u,a,s;return n instanceof Ee||n instanceof Ae?(s=t.evaluate(n.field),s instanceof G?(n.range||(n.range=new l(go(s.domain.length))),u=ki(s.domain,n.range),e=s.at,r=function(t){return chroma(u(e(t)))},new b(s.label,r,s,s.domain,n.range,null)):(i=function(){switch(vi(s.domain)){case 1:return new Jn(s.domain.min,s.domain.max);case-1:return new Jn(s.domain.min,s.domain.max);default:return new R(s.domain.min,0,s.domain.max)}}(),a=vi(i),o=n.range?n.range instanceof z?i instanceof Jn?1===a?new $n(n.range.mid,n.range.max):new $n(n.range.min,n.range.mid):n.range:(i instanceof R?i=new Jn(i.min,i.max):void 0,n.range):i instanceof Jn?1===a?new $n("#deebf7","#3182bd"):new $n("#e6550d","#fee6ce"):new z("#fc8d59","#ffffbf"),u=xi(i,o),e=s.at,r=function(t){return u(e(t))},new b(s.label,r,s,i,o,null))):new C(n.value)},Wr=function(t,n){var e,i,r,o,u,a;if(n instanceof Ne||n instanceof Ie){if(a=t.evaluate(n.field),a instanceof G)throw new Error("Could not encode opacity. Vector ["+a.label+"] is a Factor.");return i=new Jn(a.domain.min,a.domain.max),o=n.range?new Jn(ni(n.range.min),ni(n.range.max)):n.range=new Jn(.05,1),u=Mi(i,o),e=a.at,r=function(t){return u(e(t))},new yn(a.label,r,a,i,o,null)}return new C(ni(n.value))},Ar=function(t,n){var e,i;return t&&n?(e=t.encode,i=n.encode,new Te("("+t.label+", "+n.label+")",function(t){var n,r;return n=e(t),r=i(t),r>=0&&1>r?si(n,r):ai(n)})):void 0},Fr=function(t,n){return function(e,i,r){var o,u,a,s,c,l;if(i instanceof t){if(l=e.evaluate(i.field),l instanceof G)throw new Error("Could not encode size. Vector ["+l.label+"] is a Factor.");return u=new Jn(l.domain.min,l.domain.max),s=i.range?new Jn(ni(i.range.min),ni(i.range.max)):i.range=new Jn(.05,1),c=Mi(u,s),o=l.at,a=function(t){return r*c(o(t))},new n(l.label,a,u,s,null)}return new C(r*ni(i.value))}},Mr=Fr(Pe,ie),Ir=Fr(Fe,ie),qr=Fr(Ye,ie),br=function(t,n){var e,i,r,o,u,a;if(n instanceof Pe){if(a=t.evaluate(n.field),a instanceof G)throw new Error("Could not encode size. Vector ["+a.label+"] is a Factor.");return i=new Jn(a.domain.min,a.domain.max),o=n.range?new Jn(Mu(n.range.min),Mu(n.range.max)):n.range=new Jn(Mu(tr),Mu(30)),u=Mi(i,o),e=a.at,r=function(t){return u(e(t))},new ie(a.label,r,a,i,o,null)}return new C(Mu(n.value))
},Sr=function(t,n){var e,i,r,o,u,a;if(n instanceof Xe){if(a=t.evaluate(n.field),a instanceof G)throw new Error("Could not encode lineWidth. Vector ["+a.label+"] is a Factor.");return i=new Jn(a.domain.min,a.domain.max),o=n.range?new Jn(n.range.min,n.range.max):n.range=new Jn(1.5,15),u=Mi(i,o),e=a.at,r=function(t){return u(e(t))},new ie(a.label,r,a,i,o,null)}return new C(n.value)},Xr=function(t,n){var e,i,r,o;if(n instanceof Me){if(o=t.evaluate(n.field),!(o instanceof G))throw new Error("Could not encode shape. Vector ["+o.label+"] is not a Factor.");return n.range||(n.range=new l(po(o.domain.length))),r=ki(o.domain,n.range),e=o.at,i=function(t){return te[r(e(t))]},new Qn(o.label,i,o,o.domain,n.range,null)}return new C(te[n.value]||te.circle)},no=function(t,n){return[null!=t?t:new q(chroma(_.head(k.c10))),null!=n?n:new S(1)]},io=function(t,n,e){return[null!=t?t:new N(chroma(_.head(k.c10))),null!=n?n:new Y(1),null!=e?e:new O(1.5)]},eo=function(t,n,e,i,r,o,u){var a,s,c,l;return a=t||n,s=e||i||r,a||s||(o&&(a=!0),u&&(s=!0)),a&&(c=no(t,n),t=c[0],n=c[1]),s&&(l=io(e,i,r),e=l[0],i=l[1],r=l[2]),[t,n,e,i,r]},Cr=function(t,n){var e,i;return n.fillColor||n.fillOpacity?[e=_r(t,n.fillColor),i=Wr(t,n.fillOpacity),Ar(e,i)]:[]},Pr=function(t,n){var e,i;return n.strokeColor||n.strokeOpacity||n.lineWidth?[e=_r(t,n.strokeColor),i=Wr(t,n.strokeOpacity),Ar(e,i),Sr(t,n.lineWidth)]:[]},ii=function(t,n,e,i,r){return t.beginPath(),t.rect(n,e,i,r),t.clip()},cr=function(t,n,e){return t.lineWidth=e,t.strokeStyle=n,t.stroke()},ir=function(t,n){return t.fillStyle=n,t.fill()},rr=function(t,n,e,i,r){return t.beginPath(),t.moveTo(n,e),t.lineTo(i,r),t.stroke()},ur=function(t,n,e,i,r){return t.beginPath(),i>e?t.rect(n-r/2,e,r,i-e):t.rect(n-r/2,i,r,e-i),t.closePath()},or=function(t,n,e,i,r){return t.beginPath(),e>n?t.rect(n,i-r/2,e-n,r):t.rect(e,i-r/2,n-e,r),t.closePath()},ar=function(t,n,e,i,r,o,u,a,s,c){var l,f;return void 0!==n&&void 0!==e&&void 0!==i&&void 0!==r&&void 0!==o&&void 0!==u&&void 0!==a&&void 0!==s&&void 0!==c?(t.strokeStyle=s,t.lineWidth=c,or(t,e,r,u,a),t.stroke(),l=a/2,f=a/4,rr(t,i,u-l,i,u+l),rr(t,e,u,n,u),rr(t,r,u,o,u),rr(t,n,u-f,n,u+f),rr(t,o,u-f,o,u+f)):void 0},sr=function(t,n,e,i,r,o,u,a,s,c){var l,f;return void 0!==n&&void 0!==e&&void 0!==i&&void 0!==r&&void 0!==o&&void 0!==u&&void 0!==a&&void 0!==s&&void 0!==c?(t.strokeStyle=s,t.lineWidth=c,ur(t,n,i,o,a),t.stroke(),l=a/2,f=a/4,rr(t,n-l,r,n+l,r),rr(t,n,i,n,e),rr(t,n,o,n,u),rr(t,n-f,e,n+f,e),rr(t,n-f,u,n+f,u)):void 0},Ri=function(t,n){var e,i,r,o,u,a,s,c,l,f,h,d,v;return o=n[0],u=n[1],c=new oe([o],[u]),a=null!=(h=t.shape)?h:new T("circle"),s=null!=(d=t.size)?d:new E(tr),v=eo(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!1,!0),e=v[0],i=v[1],l=v[2],f=v[3],r=v[4],new Tn(c,o,u,a,s,e,i,l,f,r)},Tr=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,g,p;return s=Er(e,n.positionX),c=Er(i,n.positionY),l=Xr(t,n.shape),f=br(t,n.size),g=Cr(t,n),o=g[0],u=g[1],r=g[2],p=Pr(t,n),d=p[0],v=p[1],h=p[2],a=p[3],new Sn(s,c,l,f,r,o,u,h,d,v,a)},Jr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g,p;for(u=n.positionX,a=n.positionY,s=n.shape,c=n.size,i=n.fill,l=n.stroke,o=n.lineWidth,e.save(),d=0,g=t.length;g>d;d++)r=t[d],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),e.lineWidth=2+(l?o(r):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",v=0,p=t.length;p>v;v++)r=t[v],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),l&&(e.lineWidth=o(r),e.stroke()),i&&e.fill());return e.restore()},lo=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,g;for(a=n.positionX,s=n.positionY,c=n.shape,l=n.size,f=n.stroke,o=n.lineWidth,e.save(),v=0,g=t.length;g>v;v++)r=t[v],h=a(r),d=s(r),void 0!==h&&void 0!==d&&(u=i.put(r),c(r)(e,h,d,l(r)),e.fillStyle=u,e.fill(),f&&(e.lineWidth=o(r),e.strokeStyle=u,e.stroke()));return e.restore()},xu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v;for(u=n.positionX,a=n.positionY,s=n.shape,c=n.size,i=n.fill,l=n.stroke,o=n.lineWidth,e.save(),d=0,v=t.length;v>d;d++)r=t[d],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),l&&(e.lineWidth=o(r),e.strokeStyle=l(r),e.stroke()),i&&(e.fillStyle=i(r),e.fill()));return e.restore()},Nu=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d;for(a=n.positionX,s=n.positionY,c=[],h=0,d=t.length;d>h;h++)u=t[h],l=a(u),f=s(u),void 0!==l&&void 0!==f&&l>=e&&r>=l&&f>=i&&o>=f&&c.push(u);return c},Pu=function(t){return _.map(t,function(t){return t.type}).join(", ")},Li=function(t,n){var e,i,o,u,a,s,c,l,f,h,d,v,g,p,w,b,y,k,_,x,C,q,S;switch(p=Pu(n)){case"String, Number":return a=n[0],h=n[1],d=new oe([a],[h]),w=null!=(b=t.width)?b:new X(.8),y=eo(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!0,!1),e=y[0],i=y[1],v=y[2],g=y[3],u=y[4],new m(d,a,void 0,h,w,e,i,v,g,u);case"String, Number, Number":return a=n[0],f=n[1],h=n[2],d=new oe([a],[f,h]),w=null!=(k=t.width)?k:new X(.8),_=eo(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!0,!1),e=_[0],i=_[1],v=_[2],g=_[3],u=_[4],new m(d,a,f,h,w,e,i,v,g,u);case"Number, String":return c=n[0],l=n[1],d=new oe([c],[l]),o=null!=(x=t.height)?x:new W(.8),C=eo(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!0,!1),e=C[0],i=C[1],v=C[2],g=C[3],u=C[4],new r(d,void 0,c,l,o,e,i,v,g,u);case"Number, Number, String":return s=n[0],c=n[1],l=n[2],d=new oe([s,c],[l]),o=null!=(q=t.height)?q:new W(.8),S=eo(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!0,!1),e=S[0],i=S[1],v=S[2],g=S[3],u=S[4],new r(d,s,c,l,o,e,i,v,g,u);default:throw new Error("Cannot create rect marks with vectors of type ["+p+"]")}},kr=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,p,m;return s=Er(e,n.positionX),c=n.positionY1?Er(i,n.positionY1):xr(i,0),l=Er(i,n.positionY2),v=Mr(t,n.width,e.rect.width/e.domain.length),p=Cr(t,n),o=p[0],u=p[1],r=p[2],m=Pr(t,n),h=m[0],d=m[1],f=m[2],a=m[3],new g(s,c,l,v,r,o,u,f,h,d,a)},yr=function(t,n,i,r){var o,u,a,s,c,l,f,h,d,v,g,p,m,w,b,y,k;switch(n.space.x.length){case 1:m=n.space.x[0],l=xr(i,0),f=Er(i,m);break;default:b=n.space.x,p=b[0],m=b[1],l=Er(i,p),f=Er(i,m)}return w=n.space.y[0],h=Er(r,w),s=Mr(t,n.height,r.rect.height/r.domain.length),y=Cr(t,n),u=y[0],a=y[1],o=y[2],k=Pr(t,n),v=k[0],g=k[1],d=k[2],c=k[3],new e(l,f,h,s,o,u,a,d,v,g,c)},Ur=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g,p,m,w;for(u=n.positionX,a=n.positionY1,s=n.positionY2,f=n.width,i=n.fill,c=n.stroke,o=n.lineWidth,e.save(),g=0,m=t.length;m>g;g++)r=t[g],h=u(r),d=a(r),v=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==v&&void 0!==l&&(ur(e,h,d,v,l),e.lineWidth=2+(c?o(r):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",p=0,w=t.length;w>p;p++)r=t[p],h=u(r),d=a(r),v=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==v&&void 0!==l&&(ur(e,h,d,v,l),c&&(e.lineWidth=o(r),e.stroke()),i&&e.fill());return e.restore()},Hr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g,p,m,w;for(s=n.positionX1,c=n.positionX2,l=n.positionY,o=n.height,i=n.fill,f=n.stroke,a=n.lineWidth,e.save(),g=0,m=t.length;m>g;g++)u=t[g],h=s(u),d=c(u),v=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==v&&void 0!==r&&(or(e,h,d,v,r),e.lineWidth=2+(f?a(u):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",p=0,w=t.length;w>p;p++)u=t[p],h=s(u),d=c(u),v=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==v&&void 0!==r&&(or(e,h,d,v,r),f&&(e.lineWidth=a(u),e.stroke()),i&&e.fill());return e.restore()},so=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,g,p,m;for(a=n.positionX,s=n.positionY1,c=n.positionY2,h=n.width,l=n.stroke,o=n.lineWidth,e.save(),p=0,m=t.length;m>p;p++)r=t[p],d=a(r),v=s(r),g=c(r),f=h(r),void 0!==d&&void 0!==v&&void 0!==g&&void 0!==f&&(u=i.put(r),ur(e,d,v,g,f),ir(e,u),l&&cr(e,u,o(r)));return e.restore()},ao=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,g,p,m;for(c=n.positionX1,l=n.positionX2,f=n.positionY,o=n.height,h=n.stroke,a=n.lineWidth,e.save(),p=0,m=t.length;m>p;p++)u=t[p],d=c(u),v=l(u),g=f(u),r=o(u),void 0!==d&&void 0!==v&&void 0!==g&&void 0!==r&&(s=i.put(u),or(e,d,v,g,r),ir(e,s),h&&cr(e,s,a(u)));return e.restore()},pu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g,p;for(u=n.positionX,a=n.positionY1,s=n.positionY2,f=n.width,i=n.fill,c=n.stroke,o=n.lineWidth,e.save(),g=0,p=t.length;p>g;g++)r=t[g],h=u(r),d=a(r),v=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==v&&void 0!==l&&(ur(e,h,d,v,l),c&&cr(e,c(r),o(r)),i&&ir(e,i(r)));return e.restore()},gu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g,p;for(s=n.positionX1,c=n.positionX2,l=n.positionY,o=n.height,i=n.fill,f=n.stroke,a=n.lineWidth,e.save(),g=0,p=t.length;p>g;g++)u=t[g],h=s(u),d=c(u),v=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==v&&void 0!==r&&(or(e,h,d,v,r),f&&cr(e,f(u),a(u)),i&&ir(e,i(u)));return e.restore()},Eu=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,v,g,p,m,w,b,y;for(a=n.positionX,s=n.positionY1,c=n.positionY2,h=n.width,l=[],b=0,y=t.length;y>b;b++)u=t[b],d=a(u),p=s(u),m=c(u),p>m&&(w=p,p=m,m=w),f=h(u),void 0!==d&&void 0!==p&&void 0!==m&&void 0!==f&&(v=d-f/2,g=d+f/2,e>g||v>r||i>m||p>o||l.push(u));return l},Tu=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,v,g,p,m,w,b,y;for(c=n.positionX1,l=n.positionX2,f=n.positionY,a=n.height,h=[],b=0,y=t.length;y>b;b++)s=t[b],d=c(s),v=l(s),p=f(s),d>v&&(g=d,d=v,v=g),u=a(s),void 0!==d&&void 0!==v&&void 0!==p&&void 0!==u&&(m=p-u/2,w=p+u/2,e>v||d>r||i>w||m>o||h.push(s));return h},Vi=function(t,n){var e,i,r,o,u,a,s,c,l,f,h,d,v,g,p,m,w,b;switch(h=Pu(n)){case"String, Number, Number, Number, Number, Number":return v=n[0],r=n[1],o=n[2],u=n[3],a=n[4],s=n[5],c=new oe([v],[r,o,u,a,s]),d=null!=(p=t.width)?p:new X(.8),m=io(t.strokeColor,t.strokeOpacity,t.lineWidth),l=m[0],f=m[1],i=m[2],new Gn(c,v,r,o,u,a,s,d,l,f,i);case"Number, Number, Number, Number, Number, String":return r=n[0],o=n[1],u=n[2],a=n[3],s=n[4],g=n[5],c=new oe([r,o,u,a,s],[g]),e=null!=(w=t.height)?w:new X(.8),b=io(t.strokeColor,t.strokeOpacity,t.lineWidth),l=b[0],f=b[1],i=b[2],new Ln(c,r,o,u,a,s,g,e,l,f,i)}},Nr=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,g;return u=Er(e,n.q0),a=Er(e,n.q1),s=Er(e,n.q2),c=Er(e,n.q3),l=Er(e,n.qn),v=Er(i,n.positionY),r=Mr(t,n.height,i.rect.height/i.domain.length),g=Pr(t,n),h=g[0],d=g[1],f=g[2],o=g[3],new Rn(u,a,s,c,l,v,r,f,h,d,o)},Kr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g,p;for(u=n.positionY,a=n.q0,s=n.q1,c=n.q2,l=n.q3,f=n.qn,i=n.height,h=n.stroke,o=n.lineWidth,e.save(),d=0,g=t.length;g>d;d++)r=t[d],ar(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),2+(h?o(r):1));for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.strokeStyle="black",v=0,p=t.length;p>v;v++)r=t[v],ar(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),o(r));return e.restore()},fo=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,g,p,m,w,b,y;for(c=n.positionY,l=n.q0,f=n.q1,h=n.q2,d=n.q3,v=n.qn,o=n.height,g=n.stroke,a=n.lineWidth,e.save(),b=0,y=t.length;y>b;b++)u=t[b],p=l(u),m=v(u),w=c(u),r=o(u),void 0!==p&&void 0!==m&&void 0!==w&&void 0!==r&&(s=i.put(u),or(e,p,m,w,r),ir(e,s),cr(e,s,a(u)));return e.restore()},Cu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v;for(u=n.positionY,a=n.q0,s=n.q1,c=n.q2,l=n.q3,f=n.qn,i=n.height,h=n.stroke,o=n.lineWidth,e.save(),d=0,v=t.length;v>d;d++)r=t[d],ar(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),o(r));return e.restore()},Yu=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,v,g,p,m,w,b,y,k,_,x,C,q;for(l=n.positionY,f=n.q0,h=n.q1,d=n.q2,v=n.q3,g=n.qn,a=n.height,m=n.stroke,c=n.lineWidth,p=[],C=0,q=t.length;q>C;C++)s=t[C],w=f(s),b=g(s),k=l(s),w>b&&(y=w,w=b,b=y),u=a(s),void 0!==w&&void 0!==b&&void 0!==k&&void 0!==u&&(_=k-u/2,x=k+u/2,e>b||w>r||i>x||_>o||p.push(s));return p},Yr=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,g;return v=Er(e,n.positionX),o=Er(i,n.q0),u=Er(i,n.q1),a=Er(i,n.q2),s=Er(i,n.q3),c=Er(i,n.qn),d=Mr(t,n.width,e.rect.width/e.domain.length),g=Pr(t,n),f=g[0],h=g[1],l=g[2],r=g[3],new Vn(v,o,u,a,s,c,d,l,f,h,r)},Qr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g,p;for(o=n.positionX,u=n.q0,a=n.q1,s=n.q2,c=n.q3,l=n.qn,h=n.width,f=n.stroke,r=n.lineWidth,e.save(),d=0,g=t.length;g>d;d++)i=t[d],sr(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),2+(f?r(i):1));for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.strokeStyle="black",v=0,p=t.length;p>v;v++)i=t[v],sr(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),r(i));return e.restore()},ho=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,v,g,p,m,w,b,y;for(a=n.positionX,s=n.q0,c=n.q1,l=n.q2,f=n.q3,h=n.qn,g=n.width,d=n.stroke,o=n.lineWidth,e.save(),b=0,y=t.length;y>b;b++)r=t[b],p=a(r),m=s(r),w=h(r),v=g(r),void 0!==p&&void 0!==m&&void 0!==w&&void 0!==v&&(u=i.put(r),ur(e,p,m,w,v),ir(e,u),cr(e,u,o(r)));return e.restore()},qu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v;for(o=n.positionX,u=n.q0,a=n.q1,s=n.q2,c=n.q3,l=n.qn,h=n.width,f=n.stroke,r=n.lineWidth,e.save(),d=0,v=t.length;v>d;d++)i=t[d],sr(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),r(i));return e.restore()},Xu=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,v,g,p,m,w,b,y,k,_,x,C,q;for(s=n.positionX,c=n.q0,l=n.q1,f=n.q2,h=n.q3,d=n.qn,m=n.width,g=n.stroke,a=n.lineWidth,v=[],C=0,q=t.length;q>C;C++)u=t[C],w=s(u),k=c(u),_=d(u),k>_&&(x=k,k=_,_=x),p=m(u),void 0!==w&&void 0!==k&&void 0!==_&&void 0!==p&&(b=w-p/2,y=w+p/2,e>y||b>r||i>_||k>o||v.push(u));return v},zi=function(t,n){var e,i,r,o,u,a,s;return i=n[0],r=n[1],o=new oe([i],[r]),s=io(t.strokeColor,t.strokeOpacity,t.lineWidth),u=s[0],a=s[1],e=s[2],new Cn(o,i,r,u,a,e)},Or=function(t,n,e,i){var r,o,u,a,s,c,l;return o=Er(e,n.positionX),u=Er(i,n.positionY),l=Pr(t,n),s=l[0],c=l[1],a=l[2],r=l[3],new kn(o,u,a,s,c,r)},$r=function(t,n,e){var i,r,o,u,a,s,c;for(r=n.positionX,o=n.positionY,e.save(),s=0,c=t.length;c>s;s++)i=t[s],u=r(i),a=o(i),e.lineWidth=1.5,e.strokeStyle="black",void 0!==u&&void 0!==a&&(lr(e,u,a,64),e.stroke());return e.restore()},co=function(t,n,e,i){var r,o,u,a,s,c,l;for(o=n.positionX,u=n.positionY,e.save(),c=0,l=t.length;l>c;c++)r=t[c],a=o(r),s=u(r),void 0!==a&&void 0!==s&&(lr(e,a,s,64),e.fillStyle=i.put(r),e.fill());return e.restore()},ku=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,v,g,p,m,w,b,y,k;if(u=n.positionX,a=n.positionY,s=n.stroke,o=n.lineWidth,s instanceof C&&o instanceof C){for(e.strokeStyle=s(),e.lineWidth=o(),e.save(),w=!1,m=0,y=t.length;y>m;m++)r=t[m],f=u(r),v=a(r),void 0!==f&&void 0!==v?w?e.lineTo(f,v):(e.beginPath(),w=!0,e.moveTo(f,v)):(w&&e.stroke(),w=!1);return e.restore()}for(e.save(),e.lineCap="round",w=!1,h=void 0,g=void 0,c=void 0,b=0,k=t.length;k>b;b++)r=t[b],d=u(r),p=a(r),void 0!==d&&void 0!==p?(l=s(r),w&&(l!==c?(i=e.createLinearGradient(h,g,d,p),i.addColorStop(0,c||We),i.addColorStop(1,l||We),e.strokeStyle=i):e.strokeStyle=l,e.lineWidth=o(r),e.beginPath(),e.moveTo(h,g),e.lineTo(d,p),e.stroke()),w=!0,h=d,g=p,c=l):w=!1;return e.restore()},Ai=nr([Wn,Array,Ri],[_n,Array,zi],[In,Array,Li],[zn,Array,Vi]),On=new tn(Tr,lo,Jr,xu,Nu),xn=new tn(Or,co,$r,ku,Nu),p=new tn(kr,so,Ur,pu,Eu),i=new tn(yr,ao,Hr,gu,Tu),Bn=new tn(Nr,fo,Kr,Cu,Yu),Dn=new tn(Yr,ho,Qr,qu,Xu),Eo=nr([Z,_.identity],[Function,function(t){return new A(t)}]),ou=nr([Number,function(t){return new bn(t)}],[Boolean,function(t){return new o(t)}],[Date,function(t){return new I(t)}],[String,function(t){return new ae(t)}]),qo=function(){var t;t=1<=arguments.length?Du.call(arguments,0):[]},$o=nr([Array,function(t){return new l(t)}],[Number,function(t){return t>0?new Jn(0,t):0>t?new Jn(t,0):new R(-1,0,1)}],[String,function(t){return new $n(t,"black")}],[Number,Number,function(t,n){return n>=t?new Jn(t,n):new Jn(n,t)}],[String,String,function(t,n){return new $n(t,n)}],[Number,Number,Number,function(t,n,e){var i,r,o,u;return u=_.sortBy([t,n,e],_.identity),i=u[0],r=u[1],o=u[2],new R(i,r,o)}],[String,String,String,function(t,n,e){return new z(t,n,e)}]),ui=function(t){var n,e,i,r,o;for(o=[],i=0,r=t.length;r>i;i++)if(n=t[i],n instanceof U)o.push(new M(n));else switch(e=Au(n)){case ke:o.push(new M(new U(n)));break;default:throw new Error("Cannot create position coordinates from ["+n+"] of type ["+e+"].")}return o},Uo=function(){var t;return t=1<=arguments.length?Du.call(arguments,0):[],new En(ui(t))},Oo=nr([ae,function(t){return new q(chroma(t.value))}],[String,function(t){return new Ee(new U(t))}],[U,function(t){return new Ee(t)}],[String,x,function(t,n){return new Ee(new U(t),n)}],[U,x,function(t,n){return new Ee(t,n)}],[String,l,function(t,n){return new Ee(new U(t),n)}],[U,l,function(t,n){return new Ee(t,n)}]),To=nr([bn,function(t){return new S(t.value)}],[String,function(t){return new Ne(new U(t))}],[U,function(t){return new Ne(t)}],[String,Jn,function(t,n){return new Ne(new U(t),n)}],[U,Jn,function(t,n){return new Ne(t,n)}]),nu=nr([ae,function(t){return new N(chroma(t.value))}],[String,function(t){return new Ae(new U(t))}],[U,function(t){return new Ae(t)}],[String,x,function(t,n){return new Ae(new U(t),n)}],[U,x,function(t,n){return new Ae(t,n)}],[String,l,function(t,n){return new Ae(new U(t),n)}],[U,l,function(t,n){return new Ae(t,n)}]),eu=nr([bn,function(t){return new Y(t.value)}],[String,function(t){return new Ie(new U(t))}],[U,function(t){return new Ie(t)}],[String,Jn,function(t,n){return new Ie(new U(t),n)}],[U,Jn,function(t,n){return new Ie(t,n)}]),er=function(t,n){return nr([bn,function(n){return new t(n.value)}],[String,function(t){return new n(new U(t))}],[U,function(t){return new n(t)}],[String,Jn,function(t,e){return new n(new U(t),e)}],[U,Jn,function(t,e){return new n(t,e)}])},tu=er(E,Pe),au=er(X,Fe),Po=er(W,Ye),jo=nr([bn,function(t){return new O(t.value)}],[String,function(t){return new Xe(new U(t))}],[U,function(t){return new Xe(t)}],[String,Jn,function(t,n){return new Xe(new U(t),n)}],[U,Jn,function(t,n){return new Xe(t,n)}]),Zo=nr([ae,function(t){return new T(t.value)}],[String,function(t){return new Me(new U(t))}],[U,function(t){return new Me(t)}],[String,l,function(t,n){return new Me(new U(t),n)}],[U,l,function(t,n){return new Me(t,n)}]),ru=function(){return new xe},Ho=function(){var t,n,e,i,r,o,u,a,s;return i=1<=arguments.length?Du.call(arguments,0):[],r=Vr(i,En),o=Vr(i,Kn),u=Vr(i,ee),t=Vr(i,K),n=Vr(i,Q),a=Vr(i,ce),s=Vr(i,le),e=Vr(i,ln),new Wn(r,o,u,t,n,a,s,e)},Jo=function(){var t,n,e,i,r,o,u,a,s;return r=1<=arguments.length?Du.call(arguments,0):[],o=Vr(r,En),s=Vr(r,Le),e=Vr(r,un),t=Vr(r,K),n=Vr(r,Q),u=Vr(r,ce),a=Vr(r,le),i=Vr(r,ln),new In(o,s,e,t,n,u,a,i)},Go=function(){var t,n,e,i,r;return n=1<=arguments.length?Du.call(arguments,0):[],e=Vr(n,En),i=Vr(n,ce),r=Vr(n,le),t=Vr(n,ln),new _n(e,i,r,t)},Ko=function(){var t,n,e,i,r,o,u;return e=1<=arguments.length?Du.call(arguments,0):[],i=Vr(e,En),u=Vr(e,Le),t=Vr(e,un),r=Vr(e,ce),o=Vr(e,le),n=Vr(e,ln),new zn(i,u,t,r,o,n)},Do=function(t,n){var e;return e=function(t,n){var i,r,o,u;if(_.isArray(t)){for(r=t.length,o=[];r--;)i=t[r],null!==i&&_.isObject(i)?(e(i,n),o.push(n(i))):o.push(void 0);return o}u=[];for(r in t)Gu.call(t,r)&&(i=t[r],null!==i&&_.isObject(i)?(e(i,n),u.push(n(i))):u.push(void 0));return u},function(i){var r;return r=t.parse(i),e(r,function(t){var n;"CallExpression"===t.type&&"Identifier"===t.callee.type?_.isFunction(mo[n=t.callee.name])&&(t.callee={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"plot"},property:{type:"Identifier",name:n}}):"Identifier"===t.type&&_.isFunction(mo[n=t.name])&&(delete t.name,t.type="MemberExpression",t.computed=!1,t.object={type:"Identifier",name:"plot"},t.property={type:"Identifier",name:n})}),n.generate(r)}},Co={maxCanvasSize:new ne(795,600),visualizationSize:new ne(300,300),axisLabelFont:"10px monospace",axisTickColor:"#4d4d4d",axisTitleFont:"bold 10px monospace",axisLabelColor:"#4d4d4d",gridLineColor:"#eee"},su=function(t){return""+Math.round(t)+"px"},Ci=function(t,n){var e,i,r,o;e=document.createElement(t),r=e.style;for(i in n)o=n[i],r[i]=o;return e},fu=function(t){for(var n;n=t.firstChild;)t.removeChild(n)},$i=function(t){var n,e,i,r,o,u,a,s;u=function(){var n;n=[];for(o in t)a=t[o],i=function(){var t;t=[];for(r in a)s=a[r],t.push(""+r+":"+s);return t}(),n.push(""+o+"{"+i.join(";")+";}");return n}(),n=document.createElement("style"),n.type="text/css",n.innerHTML=u.join("\n"),e=_.head(document.getElementsByTagName("head")),e.appendChild(n)},Ji=function(t){var n,e,i,r,o,u,a;e=document.createElement("table"),e.appendChild(i=document.createElement("tbody"));for(n in t)a=t[n],i.appendChild(u=document.createElement("tr")),u.appendChild(r=document.createElement("td")),r.appendChild(document.createTextNode(""+n+":")),u.appendChild(o=document.createElement("th")),o.appendChild(document.createTextNode(a));return e},yi=function(t){var n,e,i,r,o,u,a;return a=t.width,o=t.height,r=document.createElement("canvas"),e=r.getContext("2d"),i=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,u=i/n,r.style.position="absolute",i!==n?(r.width=a*u,r.height=o*u,e.scale(u,u),r.style.width=su(a),r.style.height=su(o)):(r.width=a,r.height=o),new s(r,e,t,u)},Qi=function(t){var n,e,i,r,o,u,a,s,c,l,f,h;return h=function(){var n,e;for(e=[],a=n=1;5>=n;a=++n)e.push(yi(t));return e}(),n=h[0],o=h[1],u=h[2],l=h[3],i=h[4],r=Ci("div",{position:"relative",overflow:"visible",width:su(t.width),height:su(t.height)}),s=Ci("div",{position:"absolute",left:su(0),top:su(0),width:su(0),height:su(0),display:"none",outline:"1px dotted #999",background:"rgba(0, 0, 0, 0.05)"}),f=Ci("div",{position:"absolute",left:su(0),top:su(0),display:"none"}),f.className="vx-tooltip",r.appendChild(n.element),r.appendChild(o.element),r.appendChild(s),r.appendChild(u.element),r.appendChild(f),c=Ii(l),e=_i(i),new ze(t,r,n,o,u,l,i,s,f,c,e)},Gr=function(t){var n,e,i;return e=null!=(i=t.target)?i:t.srcElement,n=e.getBoundingClientRect(),[t.clientX-n.left,t.clientY-n.top]},ti=function(t,n,e,i,r){var o,u,a,s,c,l,f,h,d,v;u=$(document),o=$(t),s=n.style,c=h=l=d=f=v=0,a=!1,o.on("mousemove",function(t){var n;return c=t.offsetX,h=t.offsetY,(void 0===c||void 0===h)&&(n=Gr(t),c=n[0],h=n[1]),a?(s.left=su(c>l?l:c),s.top=su(h>d?d:h),s.width=su(Math.abs(c-l)),s.height=su(Math.abs(h-d))):e(c,h)}),o.on("mousedown",function(t){var n;return t.preventDefault(),l=t.offsetX,d=t.offsetY,(void 0===l||void 0===d)&&(n=Gr(t),l=n[0],d=n[1]),a=!0,s.display="block",s.left=su(l),s.top=su(d),u.on("mouseup",function(t){var n;return t.preventDefault(),f=t.offsetX,v=t.offsetY,(void 0===f||void 0===v)&&(n=Gr(t),f=n[0],v=n[1]),a=!1,s.display="none",s.width=su(0),s.height=su(0),u.off("mouseup"),Math.abs(l-f)>5||Math.abs(d-v)>5?i(l,d,f,v):r(l,d)})})},Wi=function(){var t,n,e;return e={},t=function(t,n){var i;return(i=e[t])?i.push(n):e[t]=[n]},n=function(t,n){var i,r,o,u,a;if(t)if(n){if(o=e[t])for(i=u=0,a=o.length;a>u;i=++u)if(r=o[i],r===n){o.splice(i,1);break}}else delete e[t]},nr=function(){var t,n,i,r,o,u;if(n=arguments[0],t=2<=arguments.length?Du.call(arguments,1):[],r=e[n])for(o=0,u=r.length;u>o;o++)i=r[o],i.apply(null,t)},[t,n,nr]},Zi=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,v,g,p,m,w,b,y,k,_,x,C,q,S,W,O;return O=Qi(t),u=O.baseCanvas,h=O.highlightCanvas,v=O.hoverCanvas,s=O.clipCanvas,m=O.maskCanvas,g=O.marquee,x=O.tooltip,p=O.mask,a=O.clip,C=t.regions.center,S=n.indices,q=void 0,_=function(n,i){var r,o,u,c,l;if(o=p.test(n,i),void 0!==o)for(r=s.context,r.clearRect(0,0,t.width,t.height),c=0,l=e.length;l>c;c++)if(u=e[c],r.save(),r.translate(C.left,C.top),u.mask([o],u.encoders,r,a),r.restore(),a.test(n,i))return o},c=function(t,n,e){var i;return i=Ji(e),fu(x),x.appendChild(i),x.style.display="block",w(t,n)},W=7,w=function(n,e){var i,r,o,u;return u=x.clientWidth,o=x.clientHeight,i=n+W,r=e-W-o,i+u>t.width&&(i=n-W-u),0>r&&(r=e+W),x.style.left=su(i),x.style.top=su(r)},l=function(){return x.style.display="none"},d=function(i,r){var u,a,s,f,h,d,g,p,m,b,y,k;if(f=_(i,r),f!==q){if(q=f,s=v.context,s.clearRect(0,0,t.width,t.height),l(),void 0!==f){for(s.save(),s.translate(C.left,C.top),p=0,b=e.length;b>p;p++)h=e[p],h.highlight([f],h.encoders,s);for(s.restore(),o("hover",new an(n.vectors,f)),d={},m=0,y=e.length;y>m;m++){h=e[m],k=h.encodings;for(u in k)a=k[u],a&&(g=a.vector)&&(d[g.name]=g.format(f))}c(i,r,d)}}else w(i,r)},f=function(n){var i,r,o,a;if(i=h.context,i.clearRect(0,0,t.width,t.height),n.length){for(u.element.style.opacity=.5,i.save(),i.translate(C.left,C.top),o=0,a=e.length;a>o;o++)r=e[o],r.highlight(n,r.encoders,i),r.render(n,r.encoders,i);i.restore()}else u.element.style.opacity=1},y=function(t,e){var i;i=_(t,e),void 0!==i?(f([i]),o("select",new Hn(n.vectors,[i]))):(f([]),o("deselect",new j(n.vectors)))},k=function(t,i,r,u){var a,s,c,l,h,d,v,g;for(l=-C.left+(t>r?r:t),c=-C.left+(t>r?t:r),d=-C.top+(i>u?u:i),h=-C.top+(i>u?i:u),v=0,g=e.length;g>v;v++)a=e[v],s=a.select(S,a.encoders,l,d,c,h),f(s),s.length?o("select",new Hn(n.vectors,s)):o("deselect",new j(n.vectors))},b=function(){var n,o,a,s,c;for(n=u.context,a=m.context,wu(n,i,C),bu(n,r,C),n.save(),n.translate(C.left,C.top),a.save(),a.translate(C.left,C.top),s=0,c=e.length;c>s;s++)o=e[s],o.render(S,o.encoders,n),o.mask(S,o.encoders,a,p);a.restore(),n.restore(),du(n,i,t.regions.bottom),vu(n,r,t.regions.left)},ti(v.element,g,d,k,y),new Re(O,n,_,f,d,y,k,b)},hu=function(t,n,e,i,r){var o,u,a,s,l,f,h,d,v,g,p,m,w,b,y,k,_,x;if(t.font=Co.axisLabelFont,t.fillStyle=Co.axisLabelColor,t.strokeStyle=Co.axisTickColor,t.textBaseline="middle",m=Ru+4,l=e-m,t.save(),ii(t,m,0,l,i),t.textAlign="right",p=e-5,a=e-6,n instanceof c){for(_=n.guide(),w=0,y=_.length;y>w;w++)o=_[w],u=o.value,d=n.scale(o),g=-.5+Math.round(d),rr(t,p,g,e,g),t.fillText(u,a,d,l-6);rr(t,e-.5,0,e-.5,i)}else{if(!(n instanceof fn))throw new Error("Invalid axis type.");for(h=6,f=i-6,x=n.guide(),b=0,k=x.length;k>b;b++)v=x[b],u=v.label,d=n.scale(v.value),g=Math.max(.5,-.5+Math.round(d)),rr(t,p,g,e,g),s=h>d?h:d>f?f:d,t.fillText(u,a,s,l-6);rr(t,e-.5,0,e-.5,i)}return t.restore(),t.font=Co.axisTitleFont,t.textAlign="center",t.translate(m/2,i/2),t.rotate(r*rn),t.fillText(n.label,0,0,i),t.restore()},mu=function(t,n,e,i){var r,o,u,a,s;if(t.strokeStyle=Co.gridLineColor,n instanceof c)rr(t,0,.5,e,.5),rr(t,0,i-.5,e,i-.5);else if(n instanceof fn)for(s=n.guide(),u=0,a=s.length;a>u;u++)r=s[u],o=Math.max(.5,-.5+Math.round(n.scale(r.value))),rr(t,0,o,e,o)},wu=function(t,n,e){return t.save(),t.translate(e.left,e.top+e.height),t.rotate(-rn),mu(t,n,e.height,e.width),t.restore()},bu=function(t,n,e){return t.save(),t.translate(e.left,e.top),mu(t,n,e.width,e.height),t.restore()},du=function(t,n,e){return t.save(),t.translate(e.left,e.top+e.height),t.rotate(-rn),hu(t,n,e.height,e.width,1),t.restore()},vu=function(t,n,e){return t.save(),t.translate(e.left,e.top),hu(t,n,e.width,e.height,-1),t.restore()},li=function(t,n){var e,i,r,o,u,a,s,c,l;return 0<=(a=t.indexOf(" "))?(c=t.substr(0,a),e=t.substr(a)):c=t,l=c.split(/\.+/g),s=l[0],r=2<=l.length?Du.call(l,1):[],0===s.indexOf("#")&&(u=s.substr(1),s="div"),""===s&&(s="div"),i="<"+s,u&&(i+=" id='"+u+"'"),r.length&&(i+=" class='"+r.join(" ")+"'"),e&&(i+=e),i+=">",o="</"+s+">","="===n?function(t){return i+(null!==t&&void 0!==t?t:"")+o}:"+"===n?function(t,n){var e;return e=i.replace("{0}",n),e+t+o}:function(t){return i+t.join("")+o}},Vu={},Xi=function(){var t,n,e,i,r,o,u;for(e=1<=arguments.length?Du.call(arguments,0):[],u=[],r=0,o=e.length;o>r;r++)n=e[r],(t=Vu[n])?u.push(t):(i=n.charAt(0),u.push("="===i||"+"===i?Vu[n]=li(n.substr(1),i):Vu[n]=li(n)));return u},yu=function(t){var n;return n=document.createElement("div"),n.innerHTML=t,n.childNodes[0]},jr=function(t,n){var e,i,r,o;for(o=[],i=0,r=n.length;r>i;i++)e=n[i],o.push(t.evaluate(e.field));return o},Hi=function(t){var n,e,i,r,o,u;for(e=null,n=null,u=null,r=0,o=t.length;o>r;r++)if(i=t[r],null===e)switch(e=i.type){case ke:u=i,n=i.domain;break;case we:n=i.domain;break;default:throw new Error("ni")}else{if(e!==i.type)throw new Error("Incompatible axis vector ["+i.label+"]. Expect type ["+e+"], got ["+i.type+"]");switch(e){case ke:if(u!==i)throw new Error("Incompatible categorical vector ["+i.label+"]. Expected ["+u.label+"].");break;case we:n=ci(n,i.domain);break;default:throw new Error("ni")}}return new re(e,t,n)},Ui=function(t,n,e){return new oe(jr(t,n),jr(t,e))},bi=function(t){var n,e;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(e.label);return r}(),n.join(", ")},fi=function(t,n){var e,i,r,o,a,s,l,f,h,d,v,g,p;if(l=new An(0,0,400,400),e=wi(t,"",n,new Jn(0,l.width),l),s=Ru+4+6+10,e instanceof c){for(a=0,i=e.guide(),h=0,v=i.length;v>h;h++)r=i[h],a<(o=(""+r.value).length)&&(a=o);return new u(Math.ceil(a*Ru+s),Math.ceil(i.length*(Ru+8)))}if(e instanceof fn){for(a=0,i=e.guide(),p=e.guide(),d=0,g=p.length;g>d;d++)f=p[d],a<(o=f.label.length)&&(a=o);return new u(Math.ceil(a*Ru+s),Co.visualizationSize.height)}throw new Error("Invalid axis type.")},wi=function(t,n,e,i,r){var o,u,a,s,l;switch(t){case ke:return u=ji(e,i),o=function(){return e},new c(t,n,u,e,i,r,o);case we:return l=Fi(e,i),u=l[0],a=l[1],s=l[2],o=function(t){var n,e,i,r,o,u;for(null==t&&(t=10),n=a(t),o=s(t),u=[],i=0,r=o.length;r>i;i++)e=o[i],u.push(new Se(e,n(e)));return u},new fn(t,n,u,e,i,r,o);default:throw new Error("Unhandled axis type ["+t+"].")}},Wu=function(t,n){var e,i;return i=Bi(n),e=lu(t,i),Vr(n,xe)?Su(e,n):_u(e,n)},Su=function(t,n){var e,i,r,o,u,a,s,c,l,f,h,d,v,g,p,m,w,b,y,k;return a=Vr(n,xe),k=Xi("table.vx-table","=thead","tbody","tr","=th","=th.vx-number","=td","=td.vx-number"),u=k[0],d=k[1],s=k[2],p=k[3],h=k[4],v=k[5],c=k[6],l=k[7],g=function(){var n,e;n=t.schema,e=[];for(r in n)switch(y=n[r],y.type){case we:e.push(v(_.escape(y.label)));break;default:e.push(h(_.escape(y.label)))}return e}(),m=function(){var n,e,o,u;for(o=t.indices,u=[],n=0,e=o.length;e>n;n++)i=o[n],f=function(){var n,e;n=t.schema,e=[];for(r in n)switch(y=n[r],b=y.format(i),y.type){case ke:e.push(c(void 0!==b?_.escape(b):"-"));break;case we:e.push(l(void 0!==b?_.escape(b):"-"));break;case be:e.push(c(void 0!==b?b:"-"));break;default:throw new Error("Cannot render table cell of type "+y.type)}return e}(),u.push(p(f));return u}(),e=yu(u([d(p(g)),s(m)])),o=_.noop,w=_.noop,new qn(e,o,w)},_u=function(t,n){var e,i,r,o,s,c,l,f,h,d,v,g,p,m,w,b,y,k,x,C,q,S,W,O;return g=_.map(Br(n,pn),function(n){var e,i;return i=function(){var i,r,o,u;for(o=n.position.coordinates,u=[],i=0,r=o.length;r>i;i++)e=o[i],u.push(t.evaluate(e.field));return u}(),Ai(n,i)}),y=_.map(g,function(t){return t.space}),C=Dr(y,function(t){return t.x}),q=Dr(y,function(t){return t.y}),w=Hi(C),b=Hi(q),h=w.type===we&&b.type===ke?Zr(w.domain):w.domain,d=b.type===we&&w.type===ke?Zr(b.domain):b.domain,e=fi(w.type,h),i=fi(b.type,d),l=null!=(W=Vr(n,u))?W:new u(Math.min(Co.maxCanvasSize.width,i.width+e.height),Math.min(Co.maxCanvasSize.height,e.width+i.height)),f=new a(l.width,l.height,new vn(Math.min(.3*Co.maxCanvasSize.width,i.width),0,0,Math.min(.3*Co.maxCanvasSize.height,e.width))),r=f.regions.bottom,o=f.regions.left,p=new Jn(0,r.width),m=b.type===we?new Jn(o.height,0):new Jn(0,o.height),s=wi(w.type,bi(C),h,p,r),c=wi(b.type,bi(q),d,m,o),v=_.map(g,function(n){var e,i,r,o,u;r=n.geometry,i=r.encode(t,n,s,c),e={};for(o in i)u=i[o],(null!=u?u.encode:void 0)&&(e[o]=u.encode);return new sn(i,e,r.mask,r.highlight,r.render,r.select)}),O=Wi(),k=O[0],x=O[1],nr=O[2],S=Zi(f,t,v,s,c,nr),S.render(),new qn(S.viewport.container,k,x)},Iu=nr([A,Array,Function,function(t,n,e){return t.read(function(t,i){return t?e(t):Iu(i,n,e)})}],[Z,Array,Function,function(t,n,e){var i;try{return e(null,Wu(t,n))}catch(r){return i=r,e(i)}}]),uo=function(){return $i({".vx-tooltip":{background:"#2c2c2c",color:"#fff","font-size":"12px"},".vx-tooltip th, .vx-tooltip td":{padding:"0px 4px","vertical-align":"middle"},".vx-tooltip th":{"text-align":"left"},".vx-table th, .vx-table td":{padding:"0px 8px","vertical-align":"middle"},".vx-table tbody > tr:nth-child(odd)":{"background-color":"#f3f3f3"},".vx-table .vx-number":{"text-align":"right"}})},Lu=null,Ru=18,oo=function(){var t,n;return Lu=t=yi(new u(100,100)),n=t.context,n.font=Co.axisLabelFont,Ru=n.measureText("M").width},Bu=!1,ro=function(){return Bu?void 0:(uo(),oo(),Bu=!0)},mo=function(){var t,n;return n=1<=arguments.length?Du.call(arguments,0):[],(t=Vr(n,A,Z))?(ro(),function(e){return Iu(t,_.without(n,t),e)
}):function(){var t;return t=1<=arguments.length?Du.call(arguments,0):[],mo.apply(null,n.concat(t))}},mo.VERSION="999.999.999",mo.from=Eo,mo.value=ou,mo.domain=qo,mo.range=$o,mo.position=Uo,mo.fillColor=Oo,mo.fillOpacity=To,mo.strokeColor=nu,mo.strokeOpacity=eu,mo.size=tu,mo.width=au,mo.height=Po,mo.lineWidth=jo,mo.shape=Zo,mo.factor=Wo,mo.groupBy=Yo,mo.select=Qo,mo.where=uu,mo.having=Mo,mo.eq=So,mo.ne=Lo,mo.lt=zo,mo.gt=Xo,mo.le=Io,mo.ge=No,mo.like=Fo,mo.avg=_o,mo.count=xo,mo.max=Ro,mo.min=Bo,mo.sum=iu,mo.parse=Do,mo.point=Ho,mo.rect=Jo,mo.path=Go,mo.schema=Ko,mo.table=ru,mo.createFrame=Yi,mo.createVector=Ki,mo.createList=Pi,mo.createFactor=Ti,null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=mo:window.plot=mo}).call(this);