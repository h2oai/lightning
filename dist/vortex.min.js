(function(){var t,n,e,i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,x,C,q,S,W,T,O,E,N,Y,X,M,P,A,I,F,z,j,R,B,V,L,D,G,U,H,J,K,Q,Z,tn,nn,en,rn,on,un,an,sn,cn,ln,fn,hn,dn,gn,vn,pn,mn,wn,bn,yn,kn,_n,xn,Cn,qn,Sn,Wn,Tn,On,En,Nn,Yn,Xn,Mn,Pn,An,In,Fn,zn,jn,Rn,Bn,Vn,Ln,Dn,Gn,Un,Hn,$n,Jn,Kn,Qn,Zn,te,ne,ee,ie,re,oe,ue,ae,se,ce,le,fe,he,de,ge,ve,pe,me,we,be,ye,ke,_e,xe,Ce,qe,Se,We,Te,Oe,Ee,Ne,Ye,Xe,Me,Pe,Ae,Ie,Fe,ze,je,Re,Be,Ve,Le,De,Ge,Ue,He,$e,Je,Ke,Qe,Ze,ti,ni,ei,ii,ri,oi,ui,ai,si,ci,li,fi,hi,di,gi,vi,pi,mi,wi,bi,yi,ki,_i,xi,Ci,qi,Si,Wi,Ti,Oi,Ei,Ni,Yi,Xi,Mi,Pi,Ai,Ii,Fi,zi,ji,Ri,Bi,Vi,Li,Di,Gi,Ui,Hi,$i,Ji,Ki,Qi,Zi,tr,nr,er,ir,rr,or,ur,ar,sr,cr,lr,fr,hr,dr,gr,vr,pr,mr,wr,br,yr,kr,_r,xr,Cr,qr,Sr,Wr,Tr,Or,Er,Nr,Yr,Xr,Mr,Pr,Ar,Ir,Fr,zr,jr,Rr,Br,Vr,Lr,Dr,Gr,Ur,Hr,$r,Jr,Kr,Qr,Zr,to,no,eo,io,ro,oo,uo,ao,so,co,lo,fo,ho,go,vo,po,mo,wo,bo,yo,ko,_o,xo,Co,qo,So,Wo,To,Oo,Eo,No,Yo,Xo,Mo,Po,Ao,Io,Fo,zo,jo,Ro,Bo,Vo,Lo,Do,Go,Uo,Ho,$o,Jo,Ko,Qo,Zo,tu,nu,eu,iu,ru,ou,uu,au,su,cu,lu,fu,hu,du,gu,vu,pu,mu,wu,bu,yu,ku,_u,xu,Cu,qu,Su,Wu,Tu,Ou,Eu,Nu,Yu,Xu,Mu,Pu=[].slice,Au={}.hasOwnProperty,Iu=function(t,n){function e(){this.constructor=t}for(var i in n)Au.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};Eu=Math.PI,Nu=2*Eu,rn=Eu/2,Ou=1e-6,L=Ou*Ou,Xn=Eu/180,F=180/Eu,_e=Math.tan(30*Xn),oe=Math.sqrt(3),y=16581375,qe="transparent",ke="undefined",pe="null",he="Boolean",ye="String",me="Number",ve="Function",we="Object",fe="Array",le="Arguments",de="Date",be="RegExp",ge="Error",Tu=function(t){var n;if(n=Object.prototype.toString.call(t),null===t)return pe;if(void 0===t)return ke;if(t===!0||t===!1||"[object Boolean]"===n)return he;switch(n){case"[object String]":return ye;case"[object Number]":return me;case"[object Function]":return ve;case"[object Object]":return we;case"[object Array]":return fe;case"[object Arguments]":return le;case"[object Date]":return de;case"[object RegExp]":return be;case"[object Error]":return ge;default:return n}},mn=function(){function t(t,n){this.match=t,this.func=n}return t}(),Ki=function(){var t,n;return t=function(n){var e,i,r;switch(i=Tu(n)){case ke:return function(t){return void 0===t};case pe:return function(t){return null===t};case he:return function(t){return n===Boolean||t===n};case ye:return function(t){return n===String||t===n};case me:return function(t){return n===Number||t===n||_.isNaN(t)&&_.isNaN(n)};case be:return function(){return n===RegExp};case Error:return function(){return n===Error};case de:return function(t){return n===Date||t===n};case fe:return 1===n.length&&ve===(r=Tu(n[0]))?(e=t(n[0]),function(t){var n,i,r;if(fe!==Tu(t))return!1;for(i=0,r=t.length;r>i;i++)if(n=t[i],!e(n))return!1;return!0}):function(t){return n===Array||$e(n,t)};case ve:return function(t){var e;return t instanceof n?!0:t&&t.constructor===n?!0:(e=Tu(t),n===Boolean&&e===he||n===String&&e===ye||n===Number&&e===me)};case we:return function(t){var e,i;for(e in n)if(i=n[e],t[e]!==i)return!1;return!0};default:return function(){return!1}}},n=function(n){var e;return e=_.map(n,t),function(t){var n,i,r,o;if(0===t.length)return!1;if(t.length!==e.length)return!1;for(i=r=0,o=e.length;o>r;i=++r)if(n=e[i],!n(t[i]))return!1;return!0}},function(){var t,e;return t=1<=arguments.length?Pu.call(arguments,0):[],e=_.map(t,function(t){var e,i,r;return i=2<=t.length?Pu.call(t,0,r=t.length-1):(r=0,[]),e=t[r++],new mn(n(i),e)}),function(){var t,n,i,r;for(t=1<=arguments.length?Pu.call(arguments,0):[],i=0,r=e.length;r>i;i++)if(n=e[i],n.match(t))return n.func.apply(null,t);throw new Error("Pattern match failure for args [ "+_.map(t,function(t){return""+t+":"+Tu(t)}).join(", ")+" ]")}}}(),g=function(){function t(t,n){this.put=t,this.test=n}return t}(),pn=function(){function t(t,n){this.put=t,this.test=n}return t}(),te=function(){function t(t,n){this.width=t,this.height=n}return t}(),Pn=function(){function t(t,n,e,i){this.left=t,this.top=n,this.width=e,this.height=i}return t}(),Ie=function(){function t(t,n,e,i,r,o,u){this.name=t,this.label=n,this.type=e,this.at=i,this.count=r,this.domain=o,this.format=u}return t}(),G=function(t){function n(t,e,i,r,o,u,a,s){this.valueAt=o,n.__super__.constructor.call(this,t,e,i,r,u,a,s)}return Iu(n,t),n}(Ie),nn=function(){function t(){}return t}(),Z=function(){function t(t,n,e,i,r,o,u,a){this.label=t,this.vectors=n,this.schema=e,this.indices=i,this.cube=r,this.at=o,this.evaluate=u,this.attach=a}return t}(),Se=function(){function t(t){this.value=t}return t}(),wn=function(t){function n(t){n.__super__.constructor.call(this,t)}return Iu(n,t),n}(Se),ue=function(t){function n(t){n.__super__.constructor.call(this,t)}return Iu(n,t),n}(Se),I=function(t){function n(t){n.__super__.constructor.call(this,t)}return Iu(n,t),n}(Se),o=function(t){function n(t){n.__super__.constructor.call(this,t)}return Iu(n,t),n}(Se),H=function(){function t(t){this.name=t}return t}(),hn=function(t){function n(t){this.evaluate=t}return Iu(n,t),n}(H),In=function(t){function n(t){this.evaluate=t}return Iu(n,t),n}(H),J=function(){function t(t,n){this.color=t,this.opacity=n}return t}(),ae=function(){function t(t,n,e){this.color=t,this.opacity=n,this.size=e}return t}(),vn=function(){function t(){}return t}(),Sn=function(t){function n(t,n,e,i,r,o,u,a){this.position=t,this.shape=n,this.size=e,this.fillColor=i,this.fillOpacity=r,this.strokeColor=o,this.strokeOpacity=u,this.lineWidth=a}return Iu(n,t),n}(vn),kn=function(t){function n(t,n,e,i){this.position=t,this.strokeColor=n,this.strokeOpacity=e,this.lineWidth=i}return Iu(n,t),n}(vn),zn=function(t){function n(t,n,e,i){this.position=t,this.strokeColor=n,this.strokeOpacity=e,this.lineWidth=i}return Iu(n,t),n}(vn),An=function(t){function n(t,n,e,i,r,o,u,a){this.position=t,this.width=n,this.height=e,this.fillColor=i,this.fillOpacity=r,this.strokeColor=o,this.strokeOpacity=u,this.lineWidth=a}return Iu(n,t),n}(vn),gn=function(){function t(){}return t}(),Tn=function(t){function n(t,n,e,i,r,o,u,a,s,c){this.space=t,this.positionX=n,this.positionY=e,this.shape=i,this.size=r,this.fillColor=o,this.fillOpacity=u,this.strokeColor=a,this.strokeOpacity=s,this.lineWidth=c,this.geometry=Wn}return Iu(n,t),n}(gn),Bn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.space=t,this.q0=n,this.q1=e,this.q2=i,this.q3=r,this.qn=o,this.positionY=u,this.height=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=Rn}return Iu(n,t),n}(gn),Dn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.space=t,this.positionX=n,this.q0=e,this.q1=i,this.q2=r,this.q3=o,this.qn=u,this.width=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=Ln}return Iu(n,t),n}(gn),m=function(t){function n(t,n,e,i,r,o,u,a,s,c){this.space=t,this.positionX=n,this.positionY1=e,this.positionY2=i,this.width=r,this.fillColor=o,this.fillOpacity=u,this.strokeColor=a,this.strokeOpacity=s,this.lineWidth=c,this.geometry=p}return Iu(n,t),n}(gn),r=function(t){function n(t,n,e,r,o,u,a,s,c,l){this.space=t,this.positionX1=n,this.positionX2=e,this.positionY=r,this.height=o,this.fillColor=u,this.fillOpacity=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l,this.geometry=i}return Iu(n,t),n}(gn),xn=function(t){function n(t,n,e,i,r,o){this.space=t,this.positionX=n,this.positionY=e,this.strokeColor=i,this.strokeOpacity=r,this.lineWidth=o,this.geometry=_n}return Iu(n,t),n}(gn),xe=function(t){function n(t,n,e,i,r,o,u){this.space=t,this.positionX=n,this.positionY=e,this.text=i,this.size=r,this.fillColor=o,this.fillOpacity=u,this.geometry=TextGeometry}return Iu(n,t),n}(gn),V=function(){function t(){}return t}(),qn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.positionX=t,this.positionY=n,this.shape=e,this.size=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Iu(n,t),n}(V),jn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.q0=t,this.q1=n,this.q2=e,this.q3=i,this.qn=r,this.positionY=o,this.height=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Iu(n,t),n}(V),Vn=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.positionX=t,this.q0=n,this.q1=e,this.q2=i,this.q3=r,this.qn=o,this.width=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Iu(n,t),n}(V),v=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.positionX=t,this.positionY1=n,this.positionY2=e,this.width=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Iu(n,t),n}(V),e=function(t){function n(t,n,e,i,r,o,u,a,s,c,l){this.positionX1=t,this.positionX2=n,this.positionY=e,this.height=i,this.fill=r,this.fillColor=o,this.fillOpacity=u,this.stroke=a,this.strokeColor=s,this.strokeOpacity=c,this.lineWidth=l}return Iu(n,t),n}(V),yn=function(t){function n(t,n,e,i,r,o){this.positionX=t,this.positionY=n,this.stroke=e,this.strokeColor=i,this.strokeOpacity=r,this.lineWidth=o}return Iu(n,t),n}(V),re=function(){function t(t,n){this.x=t,this.y=n}return t}(),ie=function(){function t(t,n,e){this.type=t,this.vectors=n,this.domain=e}return t}(),n=function(){function t(){}return t}(),c=function(t){function n(t,n,e,i,r,o,u){this.type=t,this.label=n,this.scale=e,this.domain=i,this.range=r,this.rect=o,this.guide=u}return Iu(n,t),n}(n),fn=function(t){function n(t,n,e,i,r,o,u){this.type=t,this.label=n,this.scale=e,this.domain=i,this.range=r,this.rect=o,this.guide=u}return Iu(n,t),n}(n),Ce=function(){function t(t,n){this.value=t,this.label=n}return t}(),B=function(){function t(t,n){this.label=t,this.encode=n}return t}(),C=function(t){function n(t){this.value=t,n.__super__.constructor.call(this,"Constant",He(t))}return Iu(n,t),n}(B),We=function(t){function n(t,e,i){this.vector=i,n.__super__.constructor.call(this,t,e)}return Iu(n,t),n}(B),En=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Iu(n,t),n}(We),b=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Iu(n,t),n}(We),bn=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Iu(n,t),n}(We),ee=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Iu(n,t),n}(We),Kn=function(t){function n(t,e,i,r,o,u){this.domain=r,this.range=o,this.guide=u,n.__super__.constructor.call(this,t,e,i)}return Iu(n,t),n}(We),d=function(){function t(){}return t}(),w=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),M=function(t){function n(t){this.field=t}return Iu(n,t),n}(d),On=function(t){function n(t){this.coordinates=t}return Iu(n,t),n}(d),K=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),Q=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),se=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),ce=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),ne=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),Re=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),un=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),ln=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),Jn=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(d),q=function(t){function n(t){this.value=t}return Iu(n,t),n}(K),Te=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(K),S=function(t){function n(t){this.value=t}return Iu(n,t),n}(Q),Oe=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(Q),N=function(t){function n(t){this.value=t}return Iu(n,t),n}(se),Me=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(se),Y=function(t){function n(t){this.value=t}return Iu(n,t),n}(ce),Pe=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(ce),E=function(t){function n(t){this.value=t}return Iu(n,t),n}(ne),Xe=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(ne),X=function(t){function n(t){this.value=t}return Iu(n,t),n}(Re),Ae=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(Re),W=function(t){function n(t){this.value=t}return Iu(n,t),n}(un),Ee=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(un),T=function(t){function n(t){this.value=t}return Iu(n,t),n}(ln),Ne=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(ln),O=function(t){function n(t){this.value=t}return Iu(n,t),n}(Jn),Ye=function(t){function n(t,n){this.field=t,this.range=n}return Iu(n,t),n}(Jn),D=function(){function t(t,n){this.min=t,this.max=n}return t}(),Mn=function(){function t(){}return t}(),l=function(t){function n(t){this.values=t}return Iu(n,t),n}(Mn),Nn=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(Mn),$n=function(t){function n(t,n){this.min=t,this.max=n}return Iu(n,t),n}(Nn),R=function(t){function n(t,n,e){this.min=t,this.mid=n,this.max=e}return Iu(n,t),n}(Nn),x=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return Iu(n,t),n}(Mn),Hn=function(t){function n(t,n){this.min=t,this.max=n}return Iu(n,t),n}(x),j=function(t){function n(t,n,e){this.min=t,this.mid=n,this.max=e}return Iu(n,t),n}(x),tn=function(){function t(t,n,e,i,r){this.encode=t,this.mask=n,this.highlight=e,this.render=i,this.select=r}return t}(),A=function(){function t(t){this.read=t}return t}(),s=function(){function t(t,n,e,i){this.element=t,this.context=n,this.bounds=e,this.ratio=i}return t}(),Fe=function(){function t(t,n,e,i,r,o,u,a,s,c,l){this.box=t,this.container=n,this.baseCanvas=e,this.highlightCanvas=i,this.hoverCanvas=r,this.maskCanvas=o,this.clipCanvas=u,this.marquee=a,this.tooltip=s,this.mask=c,this.clip=l}return t}(),sn=function(){function t(t,n,e,i,r,o){this.encodings=t,this.encoders=n,this.mask=e,this.highlight=i,this.render=r,this.select=o}return t}(),ze=function(){function t(t,n,e,i,r,o,u,a){this.viewport=t,this.frame=n,this.test=e,this.highlight=i,this.hover=r,this.selectAt=o,this.selectWithin=u,this.render=a}return t}(),Cn=function(){function t(t,n,e){this.element=t,this.subscribe=n,this.unsubscribe=e}return t}(),u=function(){function t(t,n){this.width=t,this.height=n}return t}(),Fn=function(){function t(t,n,e,i,r){this.center=t,this.left=n,this.top=e,this.right=i,this.bottom=r}return t}(),dn=function(){function t(t,n,e,i){this.left=t,this.top=n,this.right=e,this.bottom=i}return t}(),a=function(){function t(t,n,e){var i;this.width=t,this.height=n,this.margin=e,this.regions=new Fn(i=new Pn(e.left,e.top,t-e.left-e.right,n-e.top-e.bottom),new Pn(0,e.top,e.left,i.height),new Pn(e.left+i.width,e.top,e.right,i.height),new Pn(e.left,0,i.width,e.top),new Pn(e.left,e.top+i.height,i.width,e.bottom))}return t}(),Yn=function(){function t(t,n,e,i){this.select=t,this.where=n,this.group=e,this.having=i}return t}(),f=function(){function t(t,n){this.key=t,this.value=n}return t}(),t=new f(0,"All"),P=function(){function t(t,n,e,i){this.frame=t,this.hierarchy=n,this.cells=e,this.dimension=i}return t}(),cn=function(){function t(t,n,e){this.category=t,this.indices=n,this.children=e}return t}(),h=function(){function t(t,n){this.levels=t,this.indices=n}return t}(),U=function(){function t(t,n,e,i,r){this.at=t,this.valueAt=n,this.count=e,this.domain=i,this.format=r}return t}(),en=function(){function t(t){this.fields=t}return t}(),Un=function(){function t(t,n,e){this.name=t,this.fields=n,this.func=e}return t}(),je=function(){function t(t,n){this.fields=t,this.predicate=n}return t}(),on=function(){function t(t,n){this.fields=t,this.predicate=n}return t}(),an=function(){function t(t,n){this.vectors=t,this.index=n}return t}(),Gn=function(){function t(t,n){this.vectors=t,this.indices=n}return t}(),z=function(){function t(t){this.vectors=t}return t}(),Su=function(t){return t*t},ti=function(t,n){return function(e){return t>e?t:e>n?n:e}},Ze=ti(0,1),Ji=8,di=function(t){return t.slice(0)},Rr=function(t,n){var e,i,r,o,u,a,s,c;for(r=[],o=0,a=t.length;a>o;o++)for(e=t[o],c=n(e),u=0,s=c.length;s>u;u++)i=c[u],r.push(i);return r},co=function(){var t,n;return n=arguments[0],t=2<=arguments.length?Pu.call(arguments,1):[],function(){return n.apply(null,t)}},He=function(t){return function(){return t}},$e=function(t,n){var e,i,r,o;if(t&&n&&t.length===n.length){for(e=r=0,o=t.length;o>r;e=++r)if(i=t[e],i!==n[e])return!1;return!0}return!1},Fr=function(){var t,n,e,i,r,o,u,a,s;for(n=arguments[0],r=2<=arguments.length?Pu.call(arguments,1):[],e=[],o=0,a=n.length;a>o;o++)for(t=n[o],u=0,s=r.length;s>u;u++)i=r[u],t instanceof i&&e.push(t);return e},jr=function(){var t,n,e,i,r,o,u,a;for(n=arguments[0],i=2<=arguments.length?Pu.call(arguments,1):[],r=0,u=n.length;u>r;r++)for(t=n[r],o=0,a=i.length;a>o;o++)if(e=i[o],t instanceof e)return t},qi=function(t,n){return n>t?new D(t,n):new D(n,t)},ci=function(t){var n,e,i,r,o;for(e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=0,o=t.length;o>r;r++)i=t[r],void 0!==i&&(e>=i&&(e=i),i>=n&&(n=i));return new D(e,n)},hi=function(t){return function(n){return n.min>=t&&n.max>t?1:n.min<t&&n.max<=t?-1:0}},fi=hi(0),ai=function(t,n){return new D(Math.min(t.min,n.min),Math.max(t.max,n.max))},Jr=function(t){return function(n){return n.min>t&&n.max>t?new D(t,n.max):n.min<t&&n.max<t?new D(n.min,t):n}},$r=Jr(0),Ui=function(t,n,e,i){var r,o,u,a;return u=ci(e),o=function(){return e.length},r=function(t){return e[t]},a=function(t){return i(e[t])},new Ie(t,t,n,r,o,u,a)},Ir=function(t,n,e){var i,r,o,u,a,s,c,l,h,d,g,v,p;for(p=0,g={},l=n(),o=new Array(l),u=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)h=e[t],i.push(g[h]=new f(p++,h));return i}(),c=v=0;l>=0?l>v:v>l;c=l>=0?++v:--v)a=t(c),h=void 0!==a?a:"?",(r=g[h])||u.push(g[h]=r=new f(p++,h)),o[c]=r;return i=function(t){return o[t]},d=function(t){return o[t].value},s=function(t){return o[t].value},new U(i,d,n,u,s)},Si=function(t,n,e,i){var r,o,u;return o=function(){return e.length},r=function(t){return e[t]},u=Ir(r,o,i||[]),new G(t,t,n,u.at,u.valueAt,o,u.domain,u.format)},Oi=function(t,n,e,i){var r,o;return o=_.indexBy(n,function(t){return t.name}),r=new Z(t,n,o,e,i,null,null,null),r.evaluate=function(n){var e;if(n instanceof hn)return r.evaluate(n.evaluate(r));if(n instanceof In){if(i)return r.evaluate(n.evaluate(r,i));throw new Error("Cannot compute aggregate ["+n.name+"] on an unaggregated frame.")}if(e=o[n.name])return e;throw new Error("Vector ["+n.name+"] does not exist in frame ["+t+"].")},r.attach=function(e){if(o[e.name])throw new Error("Cannot attach vector ["+e.name+"]: a vector by that name already exists in frame ["+t+"]");return n.push(e),o[e.name]=e,e},r.exists=function(t){return o[t]?!0:!1},r},gr=function(t){var n,e,i,r,o,u,a,s,c,l,f;for(u=new Array(t.indices.length),e=_.map(t.vectors,function(t){return t instanceof G?t.valueAt:t.at}),f=t.indices,a=0,c=f.length;c>a;a++)for(i=f[a],u[i]=o=new Array(t.vectors.length),r=s=0,l=e.length;l>s;r=++s)n=e[r],o[r]=n(i);return u},Fi=function(t){return new Yn(Fr(t,Un),Fr(t,je),Fr(t,en),Fr(t,on))},Ti=function(t){return _.map(t,function(t){return new H(t)})},Wi=function(t){return new hn(function(n){var e,i,r,o,u,a,s,c;if(s=n.evaluate(t),s instanceof G)return t;for(u=s.count(),e=s.at,r=new Array(u),o=c=0;u>=0?u>c:c>u;o=u>=0?++c:--c)void 0!==(a=e(o))&&(r[o]=""+a);return n.attach(i=Si("factor("+s.label+")",ye,r)),new H(i.name)})},xo=Ki([String,function(t){return Wi(new H(t))}],[H,function(t){return Wi(t)}]),ru=function(t){var n;return n=ti(0,t.length-1),function(e){return t[n(-1+Math.round(e*t.length))]}},li=function(t){var n,e,i,r,o,u,a,s;return s=function(){var n,e,i;for(i=[],n=0,e=t.length;e>n;n++)a=t[n],(a||0===a)&&i.push(a);return i}(),s.sort(function(t,n){return t-n}),e=s[0],n=s[s.length-1],u=ru(s),i=u(.25),r=u(.5),o=u(.75),[e,i,r,o,n]},Ve=function(t){var n,e,i,r,o;for(e=0,n=0,r=0,o=t.length;o>r;r++)i=t[r],void 0!==i&&(e+=i,n++);return e/n},Le=function(t){var n,e,i,r;for(n=0,i=0,r=t.length;r>i;i++)e=t[i],void 0!==e&&n++;return n},De=function(t){var n,e,i,r;for(n=Number.NEGATIVE_INFINITY,i=0,r=t.length;r>i;i++)e=t[i],void 0!==e&&e>=n&&(n=e);return n},Ge=function(t){var n,e,i,r;for(n=Number.POSITIVE_INFINITY,i=0,r=t.length;r>i;i++)e=t[i],void 0!==e&&n>=e&&(n=e);return n},Ue=function(t){var n,e,i,r;for(n=0,i=0,r=t.length;r>i;i++)e=t[i],void 0!==e&&(n+=e);return n},gi=function(t,n,e,i,r){return new In(function(o,u){var a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,_;if(d=""+n+"("+t.name+")",o.exists(d))return new H(d);for(p=u.frame.evaluate(t),a=p.at,l=new Array(u.cells.length),k=u.cells,h=m=0,b=k.length;b>m;h=++m){for(s=k[h],v=[],_=s.indices,w=0,y=_.length;y>w;w++)f=_[w],void 0!==(g=a(f))&&v.push(g);l[h]=r(v)}return o.attach(c=Ui(d,e,l,i)),new H(c.name)})},mo=function(t,n,e,i){return Ki([String,function(r){return gi(new H(r),t,n,e,i)}],[H,function(r){return gi(r,t,n,e,i)}])},wo=mo("avg",me,_.identity,Ve),bo=mo("count",me,_.identity,Le),Io=mo("max",me,_.identity,De),Fo=mo("min",me,_.identity,Ge),Zo=mo("sum",me,_.identity,Ue),To=function(){var t,n,e;return n=1<=arguments.length?Pu.call(arguments,0):[],e=function(){var e,i,r;for(r=[],e=0,i=n.length;i>e;e++)if(t=n[e],t instanceof H)r.push(t);else{if(!_.isString(t))throw new Error("Cannot group by ["+t+"]");r.push(new H(t))}return r}(),new en(e)},vo=Ki([String,[String],Function,function(t,n,e){return new Un(t,Ti(n),e)}]),Ho=function(){var t,n,e,i;return e=arguments[0],n=3<=arguments.length?Pu.call(arguments,1,i=arguments.length-1):(i=1,[]),t=arguments[i++],vo(e,n.length?n:[e],t)},po=Ki([[String],Function,function(t,n){return new je(Ti(t),n)}]),nu=function(){var t,n,e;return n=2<=arguments.length?Pu.call(arguments,0,e=arguments.length-1):(e=0,[]),t=arguments[e++],po(n,t)},go=Ki([[String],Function,function(t,n){return new on(Ti(t),n)}],[[H],Function,function(t,n){return new on(t,n)}]),Eo=function(){var t,n,e;return n=2<=arguments.length?Pu.call(arguments,0,e=arguments.length-1):(e=0,[]),t=arguments[e++],go(n,t)},_o=function(t){return function(n){return n===t}},zo=function(t){return function(n){return n!==t}},Ao=function(t){return function(n){return t>n}},Oo=function(t){return function(n){return n>t}},Xo=function(t){return function(n){return t>=n}},Wo=function(t){return function(n){return n>=t}},Mo=function(t){if(be!==Tu(t))throw new Error("like ["+t+"]: expecting RegExp");return function(n){return t.test(n)}},Yo=function(){var t;return t=1<=arguments.length?Pu.call(arguments,0):[],function(n){var e,i,r;for(i=0,r=t.length;r>i;i++)if(e=t[i],e===n)return!0;return!1}},jo=function(){var t;return t=1<=arguments.length?Pu.call(arguments,0):[],function(n){var e,i,r;for(i=0,r=t.length;r>i;i++)if(e=t[i],e===n)return!1;return!0}},ou=function(n,e){var i,r,o,u,a,s,c,l,f;return c=e.where.length?Oi(n.label,n.vectors,zr(n,e.where)):n,e.group.length?(s=Rr(e.group,function(t){return t.fields}),u=function(){var t,n,e;for(e=[],t=0,n=s.length;n>t;t++){if(a=s[t],f=c.evaluate(a),!(f instanceof G))throw new Error("Cannot group by ["+a.name+"]: not a Factor.");e.push(f)}return e}(),l={0:new cn(t,c.indices,{})},Je(l,u,0),r=[],ii(l[0].children,s.length-1,r,0,new Array(s.length)),o=new P(c,l,r,s.length),i=Be(c.label+"'",o,u),e.having.length?Oi(i.label,i.vectors,zr(i,e.having),i.cube):i):c},zr=function(t,n){var e,i,r,o,u,a,s,c,l,f,h,d,g,v,p,m;for(h=t.indices,f=0,v=n.length;v>f;f++){for(c=n[f],a=[],l=function(){var n,e,i,r;for(i=c.fields,r=[],n=0,e=i.length;e>n;n++)o=i[n],r.push(t.evaluate(o));return r}(),r=_.map(l,function(t){return t instanceof G?t.valueAt:t.at}),d=0,p=h.length;p>d;d++){for(u=h[d],e=new Array(l.length),s=g=0,m=r.length;m>g;s=++g)i=r[s],e[s]=i(u);c.predicate.apply(null,e)&&a.push(u)}h=a}return h},Be=function(t,n,e){var i,r,o;return i=_.range(n.cells.length),o=function(){var t,i,o;for(o=[],r=t=0,i=n.dimension;i>=0?i>t:t>i;r=i>=0?++t:--t)o.push(Ar(n,e[r],r));return o}(),Oi(t,o,i,n)},Je=function(t,n,e){var i,r,o,u,a,s,c,l,f,h;i=n[e].at;for(s in t){for(c=t[s],u=c.children,h=c.indices,l=0,f=h.length;f>l;l++)a=h[l],r=i(a),(o=u[r.key])||(u[r.key]=o=new cn(r,[],{})),o.indices.push(a);e<n.length-1&&Je(u,n,e+1)}},ii=function(t,n,e,i,r){var o,u;for(o in t)u=t[o],r[i]=u,i===n?e.push(new h(di(r),u.indices)):ii(u.children,n,e,i+1,r)},Ar=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v;for(a=new Array(t.cells.length),s={},c=[],v=t.cells,f=d=0,g=v.length;g>d;f=++d)o=v[f],a[f]=r=o.levels[e].category,s[r.value]||(s[r.value]=r,c.push(r));return i=function(t){return a[t]},h=function(t){return a[t].value},l=function(t){return a[t].value},u=function(){return a.length},new G(n.label,n.label,n.type,i,h,u,c,l)},k={c10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],c20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],c20b:["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],c20c:["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"]},lo=function(t){return t>10?k.c20:k.c10},ei=function(t){var n,e,i,r;return r=t.rgb(),i=r[0],e=r[1],n=r[2],chroma.rgb(i,e,n)},oi=function(t){return t.css()},ui=function(t,n){return ei(t).alpha(n).css()},ur=function(t,n,e,i){var r;return r=Math.sqrt(i/Eu),t.beginPath(),t.arc(n,e,r,0,Nu,!1),t.closePath()},cr=function(t,n,e,i){var r;return r=.5*Math.sqrt(i),t.save(),t.translate(n,e),t.beginPath(),t.moveTo(r,r),t.lineTo(-r,r),t.lineTo(-r,-r),t.lineTo(r,-r),t.closePath(),t.restore()},ar=function(t,n,e,i){var r,o;return r=.5*Math.sqrt(i/5),o=3*r,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(o,r),t.lineTo(r,r),t.lineTo(r,o),t.lineTo(-r,o),t.lineTo(-r,r),t.lineTo(-o,r),t.lineTo(-o,-r),t.lineTo(-r,-r),t.lineTo(-r,-o),t.lineTo(r,-o),t.lineTo(r,-r),t.lineTo(o,-r),t.closePath(),t.restore()},sr=function(t,n,e,i){var r,o;return o=Math.sqrt(i/(2*_e)),r=o*_e,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(r,0),t.lineTo(0,o),t.lineTo(-r,0),t.lineTo(0,-o),t.closePath(),t.restore()},dr=function(t,n,e,i){var r,o;return r=Math.sqrt(i/oe),o=r*oe/2,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(0,-o),t.lineTo(r,o),t.lineTo(-r,o),t.closePath(),t.restore()},lr=function(t,n,e,i){var r,o;return r=Math.sqrt(i/oe),o=r*oe/2,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(0,o),t.lineTo(r,-o),t.lineTo(-r,-o),t.closePath(),t.restore()},hr=function(t,n,e,i){var r,o;return o=Math.sqrt(i/oe),r=o*oe/2,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(r,0),t.lineTo(-r,o),t.lineTo(-r,-o),t.closePath(),t.restore()},fr=function(t,n,e,i){var r,o;return o=Math.sqrt(i/oe),r=o*oe/2,t.save(),t.translate(n,e),t.beginPath(),t.moveTo(-r,0),t.lineTo(r,-o),t.lineTo(r,o),t.closePath(),t.restore()},Zn={circle:ur,square:cr,cross:ar,diamond:sr,triangleUp:dr,triangleDown:lr,triangleLeft:fr,triangleRight:hr},Qn={c8:["circle","square","cross","diamond","triangleUp","triangleDown","triangleLeft","triangleRight"]},fo=function(){return Qn.c8},yu=function(t){return function(n){return void 0!==n?t(n):void 0}},Xi=function(t,n){var e;return e=d3.scale.linear().domain([t.min,t.max]).range([n.min,n.max]).nice(),[yu(e),e.tickFormat,e.ticks]},Mi=function(t,n){var e,i,r,o,u,a,s;for(a=0,o={},u=0,s=t.length;s>u;u++)e=t[u],o[e.key]=a++;return i=(n.max-n.min)/t.length/2,r=n.min,yu(function(t){return r+2*o[t.key]*i+i})},wi=function(t,n){var e,i;return i=n.values,e=i.length,yu(function(t){return i[t.key%e]})},Bi=function(t,n){return yu(d3.scale.linear().domain([t.min,t.max]).range([n.min,n.max]))},xi=function(t,n){return yu(d3.scale.linear().domain([t.min,t.mid,t.max]).range([n.min,n.mid,n.max]))},Ri=function(t,n){return yu(chroma.scale([n.min,n.max]).domain([t.min,t.max]).mode("lch"))},_i=function(t,n){var e,i;return e=chroma.scale([n.min,n.mid]).domain([t.min,t.mid]).mode("lch"),i=chroma.scale([n.mid,n.max]).domain([t.mid,t.max]).mode("lch"),function(n){return void 0!==n?n<t.mid?e(n):i(n):void 0}},yi=Ki([$n,x,Ri],[R,x,_i]),Ei=Ki([$n,$n,Bi],[R,R,xi]),Ke=function(t){var n;return n=t.toString(16),1===n.length?"0"+n:n},bi=function(t){var n,e,i,r;return n=t.context,i=t.ratio,e=function(){return"#fff"},r=function(t,e){var r,o,u,a,s;return s=n.getImageData(t*i,e*i,1,1).data,a=s[0],u=s[1],o=s[2],r=s[3],255===a&&255===u&&255===o&&255===r},new g(e,r)},Yi=function(t){var n,e,i,r,o,u;return n=t.context,r=t.ratio,u=0,e={},i=function(t){var n,i,r,o;return i=u++,u>=y&&(u=0),e[i]=t,o=i>>16&255,r=i>>8&255,n=255&i,"#"+Ke(o)+Ke(r)+Ke(n)},o=function(t,i){var o,u,a,s,c,l;return l=n.getImageData(t*r,i*r,1,1).data,c=l[0],s=l[1],u=l[2],o=l[3],255===o?(a=(c<<16)+(s<<8)+u,e[a]):void 0},new pn(i,o)},Sr=function(t,n){var e,i,r,o,u,a,s;return s=t.scale,i=t.domain,a=t.range,o=t.guide,u=n.label,e=n.at,r=function(t){return s(e(t))},new En(u,r,n,i,a,o)},br=function(t,n){return new C(t.scale(n))},wr=function(t,n){var e,i,r,o,u,a,s;return n instanceof Te||n instanceof Me?(s=t.evaluate(n.field),s instanceof G?(n.range||(n.range=new l(lo(s.domain.length))),u=wi(s.domain,n.range),e=s.at,r=function(t){return chroma(u(e(t)))},new b(s.label,r,s,s.domain,n.range,null)):(i=function(){switch(fi(s.domain)){case 1:return new $n(s.domain.min,s.domain.max);case-1:return new $n(s.domain.min,s.domain.max);default:return new R(s.domain.min,0,s.domain.max)}}(),a=fi(i),o=n.range?n.range instanceof j?i instanceof $n?1===a?new Hn(n.range.mid,n.range.max):new Hn(n.range.min,n.range.mid):n.range:(i instanceof R?i=new $n(i.min,i.max):void 0,n.range):i instanceof $n?1===a?new Hn("#deebf7","#3182bd"):new Hn("#e6550d","#fee6ce"):new j("#fc8d59","#ffffbf"),u=yi(i,o),e=s.at,r=function(t){return u(e(t))},new b(s.label,r,s,i,o,null))):new C(n.value)},xr=function(t,n){var e,i,r,o,u,a;if(n instanceof Oe||n instanceof Pe){if(a=t.evaluate(n.field),a instanceof G)throw new Error("Could not encode opacity. Vector ["+a.label+"] is a Factor.");return i=new $n(a.domain.min,a.domain.max),o=n.range?new $n(Ze(n.range.min),Ze(n.range.max)):n.range=new $n(.05,1),u=Ei(i,o),e=a.at,r=function(t){return u(e(t))},new bn(a.label,r,a,i,o,null)}return new C(Ze(n.value))},Yr=function(t,n){var e,i;return t&&n?(e=t.encode,i=n.encode,new We("("+t.label+", "+n.label+")",function(t){var n,r;return n=e(t),r=i(t),r>=0&&1>r?ui(n,r):oi(n)})):void 0},Mr=function(t,n){return function(e,i,r){var o,u,a,s,c,l;if(i instanceof t){if(l=e.evaluate(i.field),l instanceof G)throw new Error("Could not encode size. Vector ["+l.label+"] is a Factor.");return u=new $n(l.domain.min,l.domain.max),s=i.range?new $n(Ze(i.range.min),Ze(i.range.max)):i.range=new $n(.05,1),c=Ei(u,s),o=l.at,a=function(t){return r*c(o(t))},new n(l.label,a,u,s,null)}return new C(r*Ze(i.value))}},Er=Mr(Xe,ee),Xr=Mr(Ae,ee),kr=Mr(Ee,ee),vr=function(t,n){var e,i,r,o,u,a;if(n instanceof Xe){if(a=t.evaluate(n.field),a instanceof G)throw new Error("Could not encode size. Vector ["+a.label+"] is a Factor.");return i=new $n(a.domain.min,a.domain.max),o=n.range?new $n(Su(n.range.min),Su(n.range.max)):n.range=new $n(Su(Ji),Su(30)),u=Ei(i,o),e=a.at,r=function(t){return u(e(t))},new ee(a.label,r,a,i,o,null)}return new C(Su(n.value))},_r=function(t,n){var e,i,r,o,u,a;if(n instanceof Ne){if(a=t.evaluate(n.field),a instanceof G)throw new Error("Could not encode lineWidth. Vector ["+a.label+"] is a Factor.");return i=new $n(a.domain.min,a.domain.max),o=n.range?new $n(n.range.min,n.range.max):n.range=new $n(1.5,15),u=Ei(i,o),e=a.at,r=function(t){return u(e(t))},new ee(a.label,r,a,i,o,null)
}return new C(n.value)},Or=function(t,n){var e,i,r,o;if(n instanceof Ye){if(o=t.evaluate(n.field),!(o instanceof G))throw new Error("Could not encode shape. Vector ["+o.label+"] is not a Factor.");return n.range||(n.range=new l(fo(o.domain.length))),r=wi(o.domain,n.range),e=o.at,i=function(t){return Zn[r(e(t))]},new Kn(o.label,i,o,o.domain,n.range,null)}return new C(Zn[n.value]||Zn.circle)},Kr=function(t,n){return[null!=t?t:new q(chroma(_.head(k.c10))),null!=n?n:new S(1)]},Zr=function(t,n,e){return[null!=t?t:new N(chroma(_.head(k.c10))),null!=n?n:new Y(1),null!=e?e:new T(1.5)]},Qr=function(t,n,e,i,r,o,u){var a,s,c,l;return a=t||n,s=e||i||r,a||s||(o&&(a=!0),u&&(s=!0)),a&&(c=Kr(t,n),t=c[0],n=c[1]),s&&(l=Zr(e,i,r),e=l[0],i=l[1],r=l[2]),[t,n,e,i,r]},yr=function(t,n){var e,i;return n.fillColor||n.fillOpacity?[e=wr(t,n.fillColor),i=xr(t,n.fillOpacity),Yr(e,i)]:[]},Nr=function(t,n){var e,i;return n.strokeColor||n.strokeOpacity||n.lineWidth?[e=wr(t,n.strokeColor),i=xr(t,n.strokeOpacity),Yr(e,i),_r(t,n.lineWidth)]:[]},ni=function(t,n,e,i,r){return t.beginPath(),t.rect(n,e,i,r),t.clip()},or=function(t,n,e){return t.lineWidth=e,t.strokeStyle=n,t.stroke()},Zi=function(t,n){return t.fillStyle=n,t.fill()},tr=function(t,n,e,i,r){return t.beginPath(),t.moveTo(n,e),t.lineTo(i,r),t.stroke()},er=function(t,n,e,i,r){return t.beginPath(),i>e?t.rect(n-r/2,e,r,i-e):t.rect(n-r/2,i,r,e-i),t.closePath()},nr=function(t,n,e,i,r){return t.beginPath(),e>n?t.rect(n,i-r/2,e-n,r):t.rect(e,i-r/2,n-e,r),t.closePath()},ir=function(t,n,e,i,r,o,u,a,s,c){var l,f;return void 0!==n&&void 0!==e&&void 0!==i&&void 0!==r&&void 0!==o&&void 0!==u&&void 0!==a&&void 0!==s&&void 0!==c?(t.strokeStyle=s,t.lineWidth=c,nr(t,e,r,u,a),t.stroke(),l=a/2,f=a/4,tr(t,i,u-l,i,u+l),tr(t,e,u,n,u),tr(t,r,u,o,u),tr(t,n,u-f,n,u+f),tr(t,o,u-f,o,u+f)):void 0},rr=function(t,n,e,i,r,o,u,a,s,c){var l,f;return void 0!==n&&void 0!==e&&void 0!==i&&void 0!==r&&void 0!==o&&void 0!==u&&void 0!==a&&void 0!==s&&void 0!==c?(t.strokeStyle=s,t.lineWidth=c,er(t,n,i,o,a),t.stroke(),l=a/2,f=a/4,tr(t,n-l,r,n+l,r),tr(t,n,i,n,e),tr(t,n,o,n,u),tr(t,n-f,e,n+f,e),tr(t,n-f,u,n+f,u)):void 0},Ii=function(t,n){var e,i,r,o,u,a,s,c,l,f,h,d,g;return o=n[0],u=n[1],c=new re([o],[u]),a=null!=(h=t.shape)?h:new O("circle"),s=null!=(d=t.size)?d:new E(Ji),g=Qr(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!1,!0),e=g[0],i=g[1],l=g[2],f=g[3],r=g[4],new Tn(c,o,u,a,s,e,i,l,f,r)},qr=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p;return s=Sr(e,n.positionX),c=Sr(i,n.positionY),l=Or(t,n.shape),f=vr(t,n.size),v=yr(t,n),o=v[0],u=v[1],r=v[2],p=Nr(t,n),d=p[0],g=p[1],h=p[2],a=p[3],new qn(s,c,l,f,r,o,u,h,d,g,a)},Gr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(u=n.positionX,a=n.positionY,s=n.shape,c=n.size,i=n.fill,l=n.stroke,o=n.lineWidth,e.save(),d=0,v=t.length;v>d;d++)r=t[d],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),e.lineWidth=2+(l?o(r):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",g=0,p=t.length;p>g;g++)r=t[g],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),l&&(e.lineWidth=o(r),e.stroke()),i&&e.fill());return e.restore()},uo=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,v;for(a=n.positionX,s=n.positionY,c=n.shape,l=n.size,f=n.stroke,o=n.lineWidth,e.save(),g=0,v=t.length;v>g;g++)r=t[g],h=a(r),d=s(r),void 0!==h&&void 0!==d&&(u=i.put(r),c(r)(e,h,d,l(r)),e.fillStyle=u,e.fill(),f&&(e.lineWidth=o(r),e.strokeStyle=u,e.stroke()));return e.restore()},mu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g;for(u=n.positionX,a=n.positionY,s=n.shape,c=n.size,i=n.fill,l=n.stroke,o=n.lineWidth,e.save(),d=0,g=t.length;g>d;d++)r=t[d],f=u(r),h=a(r),void 0!==f&&void 0!==h&&(s(r)(e,f,h,c(r)),l&&(e.lineWidth=o(r),e.strokeStyle=l(r),e.stroke()),i&&(e.fillStyle=i(r),e.fill()));return e.restore()},xu=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d;for(a=n.positionX,s=n.positionY,c=[],h=0,d=t.length;d>h;h++)u=t[h],l=a(u),f=s(u),void 0!==l&&void 0!==f&&l>=e&&r>=l&&f>=i&&o>=f&&c.push(u);return c},Wu=function(t){return _.map(t,function(t){return t.type}).join(", ")},zi=function(t,n){var e,i,o,u,a,s,c,l,f,h,d,g,v,p,w,b,y,k,_,x,C,q,S;switch(p=Wu(n)){case"String, Number":return a=n[0],h=n[1],d=new re([a],[h]),w=null!=(b=t.width)?b:new X(.8),y=Qr(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!0,!1),e=y[0],i=y[1],g=y[2],v=y[3],u=y[4],new m(d,a,void 0,h,w,e,i,g,v,u);case"String, Number, Number":return a=n[0],f=n[1],h=n[2],d=new re([a],[f,h]),w=null!=(k=t.width)?k:new X(.8),_=Qr(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!0,!1),e=_[0],i=_[1],g=_[2],v=_[3],u=_[4],new m(d,a,f,h,w,e,i,g,v,u);case"Number, String":return c=n[0],l=n[1],d=new re([c],[l]),o=null!=(x=t.height)?x:new W(.8),C=Qr(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!0,!1),e=C[0],i=C[1],g=C[2],v=C[3],u=C[4],new r(d,void 0,c,l,o,e,i,g,v,u);case"Number, Number, String":return s=n[0],c=n[1],l=n[2],d=new re([s,c],[l]),o=null!=(q=t.height)?q:new W(.8),S=Qr(t.fillColor,t.fillOpacity,t.strokeColor,t.strokeOpacity,t.lineWidth,!0,!1),e=S[0],i=S[1],g=S[2],v=S[3],u=S[4],new r(d,s,c,l,o,e,i,g,v,u);default:throw new Error("Cannot create rect marks with vectors of type ["+p+"]")}},mr=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,p,m;return s=Sr(e,n.positionX),c=n.positionY1?Sr(i,n.positionY1):br(i,0),l=Sr(i,n.positionY2),g=Er(t,n.width,e.rect.width/e.domain.length),p=yr(t,n),o=p[0],u=p[1],r=p[2],m=Nr(t,n),h=m[0],d=m[1],f=m[2],a=m[3],new v(s,c,l,g,r,o,u,f,h,d,a)},pr=function(t,n,i,r){var o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k;switch(n.space.x.length){case 1:m=n.space.x[0],l=br(i,0),f=Sr(i,m);break;default:b=n.space.x,p=b[0],m=b[1],l=Sr(i,p),f=Sr(i,m)}return w=n.space.y[0],h=Sr(r,w),s=Er(t,n.height,r.rect.height/r.domain.length),y=yr(t,n),u=y[0],a=y[1],o=y[2],k=Nr(t,n),g=k[0],v=k[1],d=k[2],c=k[3],new e(l,f,h,s,o,u,a,d,g,v,c)},Lr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w;for(u=n.positionX,a=n.positionY1,s=n.positionY2,f=n.width,i=n.fill,c=n.stroke,o=n.lineWidth,e.save(),v=0,m=t.length;m>v;v++)r=t[v],h=u(r),d=a(r),g=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==l&&(er(e,h,d,g,l),e.lineWidth=2+(c?o(r):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",p=0,w=t.length;w>p;p++)r=t[p],h=u(r),d=a(r),g=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==l&&(er(e,h,d,g,l),c&&(e.lineWidth=o(r),e.stroke()),i&&e.fill());return e.restore()},Vr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w;for(s=n.positionX1,c=n.positionX2,l=n.positionY,o=n.height,i=n.fill,f=n.stroke,a=n.lineWidth,e.save(),v=0,m=t.length;m>v;v++)u=t[v],h=s(u),d=c(u),g=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==r&&(nr(e,h,d,g,r),e.lineWidth=2+(f?a(u):1),e.stroke());for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.fillStyle=e.strokeStyle="black",p=0,w=t.length;w>p;p++)u=t[p],h=s(u),d=c(u),g=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==r&&(nr(e,h,d,g,r),f&&(e.lineWidth=a(u),e.stroke()),i&&e.fill());return e.restore()},ro=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p,m;for(a=n.positionX,s=n.positionY1,c=n.positionY2,h=n.width,l=n.stroke,o=n.lineWidth,e.save(),p=0,m=t.length;m>p;p++)r=t[p],d=a(r),g=s(r),v=c(r),f=h(r),void 0!==d&&void 0!==g&&void 0!==v&&void 0!==f&&(u=i.put(r),er(e,d,g,v,f),Zi(e,u),l&&or(e,u,o(r)));return e.restore()},io=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p,m;for(c=n.positionX1,l=n.positionX2,f=n.positionY,o=n.height,h=n.stroke,a=n.lineWidth,e.save(),p=0,m=t.length;m>p;p++)u=t[p],d=c(u),g=l(u),v=f(u),r=o(u),void 0!==d&&void 0!==g&&void 0!==v&&void 0!==r&&(s=i.put(u),nr(e,d,g,v,r),Zi(e,s),h&&or(e,s,a(u)));return e.restore()},fu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(u=n.positionX,a=n.positionY1,s=n.positionY2,f=n.width,i=n.fill,c=n.stroke,o=n.lineWidth,e.save(),v=0,p=t.length;p>v;v++)r=t[v],h=u(r),d=a(r),g=s(r),l=f(r),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==l&&(er(e,h,d,g,l),c&&or(e,c(r),o(r)),i&&Zi(e,i(r)));return e.restore()},lu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(s=n.positionX1,c=n.positionX2,l=n.positionY,o=n.height,i=n.fill,f=n.stroke,a=n.lineWidth,e.save(),v=0,p=t.length;p>v;v++)u=t[v],h=s(u),d=c(u),g=l(u),r=o(u),void 0!==h&&void 0!==d&&void 0!==g&&void 0!==r&&(nr(e,h,d,g,r),f&&or(e,f(u),a(u)),i&&Zi(e,i(u)));return e.restore()},_u=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y;for(a=n.positionX,s=n.positionY1,c=n.positionY2,h=n.width,l=[],b=0,y=t.length;y>b;b++)u=t[b],d=a(u),p=s(u),m=c(u),p>m&&(w=p,p=m,m=w),f=h(u),void 0!==d&&void 0!==p&&void 0!==m&&void 0!==f&&(g=d-f/2,v=d+f/2,e>v||g>r||i>m||p>o||l.push(u));return l},ku=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y;for(c=n.positionX1,l=n.positionX2,f=n.positionY,a=n.height,h=[],b=0,y=t.length;y>b;b++)s=t[b],d=c(s),g=l(s),p=f(s),d>g&&(v=d,d=g,g=v),u=a(s),void 0!==d&&void 0!==g&&void 0!==p&&void 0!==u&&(m=p-u/2,w=p+u/2,e>g||d>r||i>w||m>o||h.push(s));return h},ji=function(t,n){var e,i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b;switch(h=Wu(n)){case"String, Number, Number, Number, Number, Number":return g=n[0],r=n[1],o=n[2],u=n[3],a=n[4],s=n[5],c=new re([g],[r,o,u,a,s]),d=null!=(p=t.width)?p:new X(.8),m=Zr(t.strokeColor,t.strokeOpacity,t.lineWidth),l=m[0],f=m[1],i=m[2],new Dn(c,g,r,o,u,a,s,d,l,f,i);case"Number, Number, Number, Number, Number, String":return r=n[0],o=n[1],u=n[2],a=n[3],s=n[4],v=n[5],c=new re([r,o,u,a,s],[v]),e=null!=(w=t.height)?w:new X(.8),b=Zr(t.strokeColor,t.strokeOpacity,t.lineWidth),l=b[0],f=b[1],i=b[2],new Bn(c,r,o,u,a,s,v,e,l,f,i)}},Wr=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,v;return u=Sr(e,n.q0),a=Sr(e,n.q1),s=Sr(e,n.q2),c=Sr(e,n.q3),l=Sr(e,n.qn),g=Sr(i,n.positionY),r=Er(t,n.height,i.rect.height/i.domain.length),v=Nr(t,n),h=v[0],d=v[1],f=v[2],o=v[3],new jn(u,a,s,c,l,g,r,f,h,d,o)},Ur=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(u=n.positionY,a=n.q0,s=n.q1,c=n.q2,l=n.q3,f=n.qn,i=n.height,h=n.stroke,o=n.lineWidth,e.save(),d=0,v=t.length;v>d;d++)r=t[d],ir(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),2+(h?o(r):1));for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.strokeStyle="black",g=0,p=t.length;p>g;g++)r=t[g],ir(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),o(r));return e.restore()},ao=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y;for(c=n.positionY,l=n.q0,f=n.q1,h=n.q2,d=n.q3,g=n.qn,o=n.height,v=n.stroke,a=n.lineWidth,e.save(),b=0,y=t.length;y>b;b++)u=t[b],p=l(u),m=g(u),w=c(u),r=o(u),void 0!==p&&void 0!==m&&void 0!==w&&void 0!==r&&(s=i.put(u),nr(e,p,m,w,r),Zi(e,s),or(e,s,a(u)));return e.restore()},wu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g;for(u=n.positionY,a=n.q0,s=n.q1,c=n.q2,l=n.q3,f=n.qn,i=n.height,h=n.stroke,o=n.lineWidth,e.save(),d=0,g=t.length;g>d;d++)r=t[d],ir(e,a(r),s(r),c(r),l(r),f(r),u(r),i(r),h(r),o(r));return e.restore()},Cu=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,_,x,C,q;for(l=n.positionY,f=n.q0,h=n.q1,d=n.q2,g=n.q3,v=n.qn,a=n.height,m=n.stroke,c=n.lineWidth,p=[],C=0,q=t.length;q>C;C++)s=t[C],w=f(s),b=v(s),k=l(s),w>b&&(y=w,w=b,b=y),u=a(s),void 0!==w&&void 0!==b&&void 0!==k&&void 0!==u&&(_=k-u/2,x=k+u/2,e>b||w>r||i>x||_>o||p.push(s));return p},Tr=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,v;return g=Sr(e,n.positionX),o=Sr(i,n.q0),u=Sr(i,n.q1),a=Sr(i,n.q2),s=Sr(i,n.q3),c=Sr(i,n.qn),d=Er(t,n.width,e.rect.width/e.domain.length),v=Nr(t,n),f=v[0],h=v[1],l=v[2],r=v[3],new Vn(g,o,u,a,s,c,d,l,f,h,r)},Hr=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p;for(o=n.positionX,u=n.q0,a=n.q1,s=n.q2,c=n.q3,l=n.qn,h=n.width,f=n.stroke,r=n.lineWidth,e.save(),d=0,v=t.length;v>d;d++)i=t[d],rr(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),2+(f?r(i):1));for(e.restore(),e.save(),e.globalCompositeOperation="destination-out",e.strokeStyle="black",g=0,p=t.length;p>g;g++)i=t[g],rr(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),r(i));return e.restore()},so=function(t,n,e,i){var r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y;for(a=n.positionX,s=n.q0,c=n.q1,l=n.q2,f=n.q3,h=n.qn,v=n.width,d=n.stroke,o=n.lineWidth,e.save(),b=0,y=t.length;y>b;b++)r=t[b],p=a(r),m=s(r),w=h(r),g=v(r),void 0!==p&&void 0!==m&&void 0!==w&&void 0!==g&&(u=i.put(r),er(e,p,m,w,g),Zi(e,u),or(e,u,o(r)));return e.restore()},bu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g;for(o=n.positionX,u=n.q0,a=n.q1,s=n.q2,c=n.q3,l=n.qn,h=n.width,f=n.stroke,r=n.lineWidth,e.save(),d=0,g=t.length;g>d;d++)i=t[d],rr(e,o(i),u(i),a(i),s(i),c(i),l(i),h(i),f(i),r(i));return e.restore()},qu=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,_,x,C,q;for(s=n.positionX,c=n.q0,l=n.q1,f=n.q2,h=n.q3,d=n.qn,m=n.width,v=n.stroke,a=n.lineWidth,g=[],C=0,q=t.length;q>C;C++)u=t[C],w=s(u),k=c(u),_=d(u),k>_&&(x=k,k=_,_=x),p=m(u),void 0!==w&&void 0!==k&&void 0!==_&&void 0!==p&&(b=w-p/2,y=w+p/2,e>y||b>r||i>_||k>o||g.push(u));return g},Pi=function(t,n){var e,i,r,o,u,a,s;return i=n[0],r=n[1],o=new re([i],[r]),s=Zr(t.strokeColor,t.strokeOpacity,t.lineWidth),u=s[0],a=s[1],e=s[2],new xn(o,i,r,u,a,e)},Cr=function(t,n,e,i){var r,o,u,a,s,c,l;return o=Sr(e,n.positionX),u=Sr(i,n.positionY),l=Nr(t,n),s=l[0],c=l[1],a=l[2],r=l[3],new yn(o,u,a,s,c,r)},Dr=function(t,n,e){var i,r,o,u,a,s,c;for(r=n.positionX,o=n.positionY,e.save(),s=0,c=t.length;c>s;s++)i=t[s],u=r(i),a=o(i),e.lineWidth=1.5,e.strokeStyle="black",void 0!==u&&void 0!==a&&(ur(e,u,a,64),e.stroke());return e.restore()},oo=function(t,n,e,i){var r,o,u,a,s,c,l;for(o=n.positionX,u=n.positionY,e.save(),c=0,l=t.length;l>c;c++)r=t[c],a=o(r),s=u(r),void 0!==a&&void 0!==s&&(ur(e,a,s,64),e.fillStyle=i.put(r),e.fill());return e.restore()},vu=function(t,n,e){var i,r,o,u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k;if(u=n.positionX,a=n.positionY,s=n.stroke,o=n.lineWidth,s instanceof C&&o instanceof C){for(e.strokeStyle=s(),e.lineWidth=o(),e.save(),w=!1,m=0,y=t.length;y>m;m++)r=t[m],f=u(r),g=a(r),void 0!==f&&void 0!==g?w?e.lineTo(f,g):(e.beginPath(),w=!0,e.moveTo(f,g)):(w&&e.stroke(),w=!1);return e.restore()}for(e.save(),e.lineCap="round",w=!1,h=void 0,v=void 0,c=void 0,b=0,k=t.length;k>b;b++)r=t[b],d=u(r),p=a(r),void 0!==d&&void 0!==p?(l=s(r),w&&(l!==c?(i=e.createLinearGradient(h,v,d,p),i.addColorStop(0,c||qe),i.addColorStop(1,l||qe),e.strokeStyle=i):e.strokeStyle=l,e.lineWidth=o(r),e.beginPath(),e.moveTo(h,v),e.lineTo(d,p),e.stroke()),w=!0,h=d,v=p,c=l):w=!1;return e.restore()},Ni=Ki([Sn,Array,Ii],[kn,Array,Pi],[An,Array,zi],[zn,Array,ji]),Wn=new tn(qr,uo,Gr,mu,xu),_n=new tn(Cr,oo,Dr,vu,xu),p=new tn(mr,ro,Lr,fu,_u),i=new tn(pr,io,Vr,lu,ku),Rn=new tn(Wr,ao,Ur,wu,Cu),Ln=new tn(Tr,so,Hr,bu,qu),So=Ki([Z,_.identity],[Function,function(t){return new A(t)}]),tu=Ki([Number,function(t){return new wn(t)}],[Boolean,function(t){return new o(t)}],[Date,function(t){return new I(t)}],[String,function(t){return new ue(t)}]),ko=function(){var t;t=1<=arguments.length?Pu.call(arguments,0):[]},Do=Ki([Array,function(t){return new l(t)}],[Number,function(t){return t>0?new $n(0,t):0>t?new $n(t,0):new R(-1,0,1)}],[String,function(t){return new Hn(t,"black")}],[Number,Number,function(t,n){return n>=t?new $n(t,n):new $n(n,t)}],[String,String,function(t,n){return new Hn(t,n)}],[Number,Number,Number,function(t,n,e){var i,r,o,u;return u=_.sortBy([t,n,e],_.identity),i=u[0],r=u[1],o=u[2],new R(i,r,o)}],[String,String,String,function(t,n,e){return new j(t,n,e)}]),ri=function(t){var n,e,i,r,o;for(o=[],i=0,r=t.length;r>i;i++)if(n=t[i],n instanceof H)o.push(new M(n));else switch(e=Tu(n)){case ye:o.push(new M(new H(n)));break;default:throw new Error("Cannot create position coordinates from ["+n+"] of type ["+e+"].")}return o},Lo=function(){var t;return t=1<=arguments.length?Pu.call(arguments,0):[],new On(ri(t))},Co=Ki([ue,function(t){return new q(chroma(t.value))}],[String,function(t){return new Te(new H(t))}],[H,function(t){return new Te(t)}],[String,x,function(t,n){return new Te(new H(t),n)}],[H,x,function(t,n){return new Te(t,n)}],[String,l,function(t,n){return new Te(new H(t),n)}],[H,l,function(t,n){return new Te(t,n)}]),qo=Ki([wn,function(t){return new S(t.value)}],[String,function(t){return new Oe(new H(t))}],[H,function(t){return new Oe(t)}],[String,$n,function(t,n){return new Oe(new H(t),n)}],[H,$n,function(t,n){return new Oe(t,n)}]),Ko=Ki([ue,function(t){return new N(chroma(t.value))}],[String,function(t){return new Me(new H(t))}],[H,function(t){return new Me(t)}],[String,x,function(t,n){return new Me(new H(t),n)}],[H,x,function(t,n){return new Me(t,n)}],[String,l,function(t,n){return new Me(new H(t),n)}],[H,l,function(t,n){return new Me(t,n)}]),Qo=Ki([wn,function(t){return new Y(t.value)}],[String,function(t){return new Pe(new H(t))}],[H,function(t){return new Pe(t)}],[String,$n,function(t,n){return new Pe(new H(t),n)}],[H,$n,function(t,n){return new Pe(t,n)}]),Qi=function(t,n){return Ki([wn,function(n){return new t(n.value)}],[String,function(t){return new n(new H(t))}],[H,function(t){return new n(t)}],[String,$n,function(t,e){return new n(new H(t),e)}],[H,$n,function(t,e){return new n(t,e)}])},Jo=Qi(E,Xe),eu=Qi(X,Ae),No=Qi(W,Ee),Po=Ki([wn,function(t){return new T(t.value)}],[String,function(t){return new Ne(new H(t))}],[H,function(t){return new Ne(t)}],[String,$n,function(t,n){return new Ne(new H(t),n)}],[H,$n,function(t,n){return new Ne(t,n)}]),$o=Ki([ue,function(t){return new O(t.value)}],[String,function(t){return new Ye(new H(t))}],[H,function(t){return new Ye(t)}],[String,l,function(t,n){return new Ye(new H(t),n)}],[H,l,function(t,n){return new Ye(t,n)}]),Vo=function(){var t,n,e,i,r,o,u,a,s;return i=1<=arguments.length?Pu.call(arguments,0):[],r=jr(i,On),o=jr(i,Jn),u=jr(i,ne),t=jr(i,K),n=jr(i,Q),a=jr(i,se),s=jr(i,ce),e=jr(i,ln),new Sn(r,o,u,t,n,a,s,e)},Go=function(){var t,n,e,i,r,o,u,a,s;return r=1<=arguments.length?Pu.call(arguments,0):[],o=jr(r,On),s=jr(r,Re),e=jr(r,un),t=jr(r,K),n=jr(r,Q),u=jr(r,se),a=jr(r,ce),i=jr(r,ln),new An(o,s,e,t,n,u,a,i)},Bo=function(){var t,n,e,i,r;return n=1<=arguments.length?Pu.call(arguments,0):[],e=jr(n,On),i=jr(n,se),r=jr(n,ce),t=jr(n,ln),new kn(e,i,r,t)},Uo=function(){var t,n,e,i,r,o,u;return e=1<=arguments.length?Pu.call(arguments,0):[],i=jr(e,On),u=jr(e,Re),t=jr(e,un),r=jr(e,se),o=jr(e,ce),n=jr(e,ln),new zn(i,u,t,r,o,n)},Ro=function(t,n){var e;return e=function(t,n){var i,r,o,u;if(_.isArray(t)){for(r=t.length,o=[];r--;)i=t[r],null!==i&&_.isObject(i)?(e(i,n),o.push(n(i))):o.push(void 0);return o}u=[];for(r in t)Au.call(t,r)&&(i=t[r],null!==i&&_.isObject(i)?(e(i,n),u.push(n(i))):u.push(void 0));return u},function(i){var r;return r=t.parse(i),e(r,function(t){var n;"CallExpression"===t.type&&"Identifier"===t.callee.type?_.isFunction(ho[n=t.callee.name])&&(t.callee={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"plot"},property:{type:"Identifier",name:n}}):"Identifier"===t.type&&_.isFunction(ho[n=t.name])&&(delete t.name,t.type="MemberExpression",t.computed=!1,t.object={type:"Identifier",name:"plot"},t.property={type:"Identifier",name:n})}),n.generate(r)}},yo={maxCanvasSize:new te(795,600),visualizationSize:new te(300,300),axisLabelFont:"10px monospace",axisTickColor:"#4d4d4d",axisTitleFont:"bold 10px monospace",axisLabelColor:"#4d4d4d",gridLineColor:"#eee"},iu=function(t){return""+Math.round(t)+"px"},ki=function(t,n){var e,i,r,o;e=document.createElement(t),r=e.style;for(i in n)o=n[i],r[i]=o;return e},uu=function(t){for(var n;n=t.firstChild;)t.removeChild(n)},Di=function(t){var n,e,i,r,o,u,a,s;u=function(){var n;n=[];for(o in t)a=t[o],i=function(){var t;t=[];for(r in a)s=a[r],t.push(""+r+":"+s);return t}(),n.push(""+o+"{"+i.join(";")+";}");return n}(),n=document.createElement("style"),n.type="text/css",n.innerHTML=u.join("\n"),e=_.head(document.getElementsByTagName("head")),e.appendChild(n)},Gi=function(t){var n,e,i,r,o,u,a;e=document.createElement("table"),e.appendChild(i=document.createElement("tbody"));for(n in t)a=t[n],i.appendChild(u=document.createElement("tr")),u.appendChild(r=document.createElement("td")),r.appendChild(document.createTextNode(""+n+":")),u.appendChild(o=document.createElement("th")),o.appendChild(document.createTextNode(a));return e},mi=function(t){var n,e,i,r,o,u,a;return a=t.width,o=t.height,r=document.createElement("canvas"),e=r.getContext("2d"),i=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,u=i/n,r.style.position="absolute",i!==n?(r.width=a*u,r.height=o*u,e.scale(u,u),r.style.width=iu(a),r.style.height=iu(o)):(r.width=a,r.height=o),new s(r,e,t,u)},Hi=function(t){var n,e,i,r,o,u,a,s,c,l,f,h;return h=function(){var n,e;for(e=[],a=n=1;5>=n;a=++n)e.push(mi(t));return e}(),n=h[0],o=h[1],u=h[2],l=h[3],i=h[4],r=ki("div",{position:"relative",width:iu(t.width),height:iu(t.height)}),s=ki("div",{position:"absolute",left:iu(0),top:iu(0),width:iu(0),height:iu(0),display:"none",outline:"1px dotted #999",background:"rgba(0, 0, 0, 0.05)"}),f=ki("div",{position:"absolute",left:iu(0),top:iu(0),display:"none"}),f.className="vortex-tooltip",r.appendChild(n.element),r.appendChild(o.element),r.appendChild(s),r.appendChild(u.element),r.appendChild(f),c=Yi(l),e=bi(i),new Fe(t,r,n,o,u,l,i,s,f,c,e)},Br=function(t){var n,e,i;return e=null!=(i=t.target)?i:t.srcElement,n=e.getBoundingClientRect(),[t.clientX-n.left,t.clientY-n.top]},Qe=function(t,n,e,i,r){var o,u,a,s,c,l,f,h,d,g;u=$(document),o=$(t),s=n.style,c=h=l=d=f=g=0,a=!1,o.on("mousemove",function(t){var n;return c=t.offsetX,h=t.offsetY,(void 0===c||void 0===h)&&(n=Br(t),c=n[0],h=n[1]),a?(s.left=iu(c>l?l:c),s.top=iu(h>d?d:h),s.width=iu(Math.abs(c-l)),s.height=iu(Math.abs(h-d))):e(c,h)}),o.on("mousedown",function(t){var n;return t.preventDefault(),l=t.offsetX,d=t.offsetY,(void 0===l||void 0===d)&&(n=Br(t),l=n[0],d=n[1]),a=!0,s.display="block",s.left=iu(l),s.top=iu(d),u.on("mouseup",function(t){var n;return t.preventDefault(),f=t.offsetX,g=t.offsetY,(void 0===f||void 0===g)&&(n=Br(t),f=n[0],g=n[1]),a=!1,s.display="none",s.width=iu(0),s.height=iu(0),u.off("mouseup"),Math.abs(l-f)>5||Math.abs(d-g)>5?i(l,d,f,g):r(l,d)})})},Ci=function(){var t,n,e;return e={},t=function(t,n){var i;return(i=e[t])?i.push(n):e[t]=[n]},n=function(t,n){var i,r,o,u,a;if(t)if(n){if(o=e[t])for(i=u=0,a=o.length;a>u;i=++u)if(r=o[i],r===n){o.splice(i,1);break}}else delete e[t]},Ki=function(){var t,n,i,r,o,u;if(n=arguments[0],t=2<=arguments.length?Pu.call(arguments,1):[],r=e[n])for(o=0,u=r.length;u>o;o++)i=r[o],i.apply(null,t)},[t,n,Ki]},$i=function(t,n,e,i,r,o){var u,a,s,c,l,f,h,d,g,v,p,m,w,b,y,k,_,x,C,q,S,W,T;return T=Hi(t),u=T.baseCanvas,h=T.highlightCanvas,g=T.hoverCanvas,s=T.clipCanvas,m=T.maskCanvas,v=T.marquee,x=T.tooltip,p=T.mask,a=T.clip,C=t.regions.center,S=n.indices,q=void 0,_=function(n,i){var r,o,u,c,l;if(o=p.test(n,i),void 0!==o)for(r=s.context,r.clearRect(0,0,t.width,t.height),c=0,l=e.length;l>c;c++)if(u=e[c],r.save(),r.translate(C.left,C.top),u.mask([o],u.encoders,r,a),r.restore(),a.test(n,i))return o},c=function(t,n,e){var i;return i=Gi(e),uu(x),x.appendChild(i),x.style.display="block",w(t,n)},W=7,w=function(n,e){var i,r,o,u;return u=x.clientWidth,o=x.clientHeight,i=n+W,r=e-W-o,i+u>t.width&&(i=n-W-u),0>r&&(r=e+W),x.style.left=iu(i),x.style.top=iu(r)},l=function(){return x.style.display="none"},d=function(i,r){var u,a,s,f,h,d,v,p,m,b,y,k;if(f=_(i,r),f!==q){if(q=f,s=g.context,s.clearRect(0,0,t.width,t.height),l(),void 0!==f){for(s.save(),s.translate(C.left,C.top),p=0,b=e.length;b>p;p++)h=e[p],h.highlight([f],h.encoders,s);for(s.restore(),o("hover",new an(n.vectors,f)),d={},m=0,y=e.length;y>m;m++){h=e[m],k=h.encodings;for(u in k)a=k[u],a&&(v=a.vector)&&(d[v.name]=v.format(f))}c(i,r,d)}}else w(i,r)},f=function(n){var i,r,o,a;if(i=h.context,i.clearRect(0,0,t.width,t.height),n.length){for(u.element.style.opacity=.5,i.save(),i.translate(C.left,C.top),o=0,a=e.length;a>o;o++)r=e[o],r.highlight(n,r.encoders,i),r.render(n,r.encoders,i);i.restore()}else u.element.style.opacity=1},y=function(t,e){var i;i=_(t,e),void 0!==i?(f([i]),o("select",new Gn(n.vectors,[i]))):(f([]),o("deselect",new z(n.vectors)))},k=function(t,i,r,u){var a,s,c,l,h,d,g,v;for(l=-C.left+(t>r?r:t),c=-C.left+(t>r?t:r),d=-C.top+(i>u?u:i),h=-C.top+(i>u?i:u),g=0,v=e.length;v>g;g++)a=e[g],s=a.select(S,a.encoders,l,d,c,h),f(s),s.length?o("select",new Gn(n.vectors,s)):o("deselect",new z(n.vectors))},b=function(){var n,o,a,s,c;for(n=u.context,a=m.context,du(n,i,C),gu(n,r,C),n.save(),n.translate(C.left,C.top),a.save(),a.translate(C.left,C.top),s=0,c=e.length;c>s;s++)o=e[s],o.render(S,o.encoders,n),o.mask(S,o.encoders,a,p);a.restore(),n.restore(),su(n,i,t.regions.bottom),cu(n,r,t.regions.left)},Qe(g.element,v,d,k,y),new ze(T,n,_,f,d,y,k,b)},au=function(t,n,e,i,r){var o,u,a,s,l,f,h,d,g,v,p,m,w,b,y,k,_,x;if(t.font=yo.axisLabelFont,t.fillStyle=yo.axisLabelColor,t.strokeStyle=yo.axisTickColor,t.textBaseline="middle",m=Yu+4,l=e-m,t.save(),ni(t,m,0,l,i),t.textAlign="right",p=e-5,a=e-6,n instanceof c){for(_=n.guide(),w=0,y=_.length;y>w;w++)o=_[w],u=o.value,d=n.scale(o),v=-.5+Math.round(d),tr(t,p,v,e,v),t.fillText(u,a,d,l-6);tr(t,e-.5,0,e-.5,i)}else{if(!(n instanceof fn))throw new Error("Invalid axis type.");for(h=6,f=i-6,x=n.guide(),b=0,k=x.length;k>b;b++)g=x[b],u=g.label,d=n.scale(g.value),v=Math.max(.5,-.5+Math.round(d)),tr(t,p,v,e,v),s=h>d?h:d>f?f:d,t.fillText(u,a,s,l-6);tr(t,e-.5,0,e-.5,i)}return t.restore(),t.font=yo.axisTitleFont,t.textAlign="center",t.translate(m/2,i/2),t.rotate(r*rn),t.fillText(n.label,0,0,i),t.restore()},hu=function(t,n,e,i){var r,o,u,a,s;if(t.strokeStyle=yo.gridLineColor,n instanceof c)tr(t,0,.5,e,.5),tr(t,0,i-.5,e,i-.5);else if(n instanceof fn)for(s=n.guide(),u=0,a=s.length;a>u;u++)r=s[u],o=Math.max(.5,-.5+Math.round(n.scale(r.value))),tr(t,0,o,e,o)},du=function(t,n,e){return t.save(),t.translate(e.left,e.top+e.height),t.rotate(-rn),hu(t,n,e.height,e.width),t.restore()},gu=function(t,n,e){return t.save(),t.translate(e.left,e.top),hu(t,n,e.width,e.height),t.restore()},su=function(t,n,e){return t.save(),t.translate(e.left,e.top+e.height),t.rotate(-rn),au(t,n,e.height,e.width,1),t.restore()},cu=function(t,n,e){return t.save(),t.translate(e.left,e.top),au(t,n,e.width,e.height,-1),t.restore()},Pr=function(t,n){var e,i,r,o;for(o=[],i=0,r=n.length;r>i;i++)e=n[i],o.push(t.evaluate(e.field));return o},Vi=function(t){var n,e,i,r,o,u;for(e=null,n=null,u=null,r=0,o=t.length;o>r;r++)if(i=t[r],null===e)switch(e=i.type){case ye:u=i,n=i.domain;break;case me:n=i.domain;break;default:throw new Error("ni")}else{if(e!==i.type)throw new Error("Incompatible axis vector ["+i.label+"]. Expect type ["+e+"], got ["+i.type+"]");switch(e){case ye:if(u!==i)throw new Error("Incompatible categorical vector ["+i.label+"]. Expected ["+u.label+"].");break;case me:n=ai(n,i.domain);break;default:throw new Error("ni")}}return new ie(e,t,n)},Li=function(t,n,e){return new re(Pr(t,n),Pr(t,e))},pi=function(t){var n,e;return n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(e.label);return r}(),n.join(", ")},si=function(t,n){var e,i,r,o,a,s,l,f,h,d,g,v,p;if(l=new Pn(0,0,400,400),e=vi(t,"",n,new $n(0,l.width),l),s=Yu+4+6+10,e instanceof c){for(a=0,i=e.guide(),h=0,g=i.length;g>h;h++)r=i[h],a<(o=r.value.length)&&(a=o);return new u(Math.ceil(a*Yu+s),Math.ceil(i.length*(Yu+8)))}if(e instanceof fn){for(a=0,i=e.guide(),p=e.guide(),d=0,v=p.length;v>d;d++)f=p[d],a<(o=f.label.length)&&(a=o);return new u(Math.ceil(a*Yu+s),yo.visualizationSize.height)}throw new Error("Invalid axis type.")},vi=function(t,n,e,i,r){var o,u,a,s,l;switch(t){case ye:return u=Mi(e,i),o=function(){return e},new c(t,n,u,e,i,r,o);case me:return l=Xi(e,i),u=l[0],a=l[1],s=l[2],o=function(t){var n,e,i,r,o,u;for(null==t&&(t=10),n=a(t),o=s(t),u=[],i=0,r=o.length;r>i;i++)e=o[i],u.push(new Ce(e,n(e)));return u},new fn(t,n,u,e,i,r,o);default:throw new Error("Unhandled axis type ["+t+"].")}},pu=function(t,n){var e,i,r,o,s,c,l,f,h,d,g,v,p,m,w,b,y,k,x,C,q,S,W,T,O,E;return m=Fi(n),g=ou(t,m),p=_.map(Fr(n,vn),function(t){var n,e;return e=function(){var e,i,r,o;for(r=t.position.coordinates,o=[],e=0,i=r.length;i>e;e++)n=r[e],o.push(g.evaluate(n.field));return o}(),Ni(t,e)}),x=_.map(p,function(t){return t.space}),S=Rr(x,function(t){return t.x}),W=Rr(x,function(t){return t.y}),y=Vi(S),k=Vi(W),h=y.type===me&&k.type===ye?$r(y.domain):y.domain,d=k.type===me&&y.type===ye?$r(k.domain):k.domain,e=si(y.type,h),i=si(k.type,d),l=null!=(O=jr(n,u))?O:new u(Math.min(yo.maxCanvasSize.width,i.width+e.height),Math.min(yo.maxCanvasSize.height,e.width+i.height)),f=new a(l.width,l.height,new dn(Math.min(.3*yo.maxCanvasSize.width,i.width),0,0,Math.min(.3*yo.maxCanvasSize.height,e.width))),r=f.regions.bottom,o=f.regions.left,w=new $n(0,r.width),b=k.type===me?new $n(o.height,0):new $n(0,o.height),s=vi(y.type,pi(S),h,w,r),c=vi(k.type,pi(W),d,b,o),v=_.map(p,function(t){var n,e,i,r,o;i=t.geometry,e=i.encode(g,t,s,c),n={};for(r in e)o=e[r],(null!=o?o.encode:void 0)&&(n[r]=o.encode);return new sn(e,n,i.mask,i.highlight,i.render,i.select)}),E=Ci(),C=E[0],q=E[1],Ki=E[2],T=$i(f,g,v,s,c,Ki),T.render(),new Cn(T.viewport.container,C,q)},Ai=Ki([A,Array,Function,function(t,n,e){return t.read(function(t,i){return t?e(t):Ai(i,n,e)})}],[Z,Array,Function,function(t,n,e){var i;try{return e(null,pu(t,n))}catch(r){return i=r,e(i)}}]),eo=function(){return Di({".vortex-tooltip":{background:"#2c2c2c",color:"#fff","font-size":"12px"},".vortex-tooltip th, .vortex-tooltip td":{padding:"0px 4px","vertical-align":"middle"},".vortex-tooltip th":{"text-align":"left"}})},Mu=null,Yu=18,no=function(){var t,n;return Mu=t=mi(new u(100,100)),n=t.context,n.font=yo.axisLabelFont,Yu=n.measureText("M").width},Xu=!1,to=function(){return Xu?void 0:(eo(),no(),Xu=!0)},ho=function(){var t,n;return n=1<=arguments.length?Pu.call(arguments,0):[],(t=jr(n,A,Z))?(to(),function(e){return Ai(t,_.without(n,t),e)}):function(){var t;return t=1<=arguments.length?Pu.call(arguments,0):[],ho.apply(null,n.concat(t))}},ho.VERSION="0.1.0",ho.from=So,ho.value=tu,ho.domain=ko,ho.range=Do,ho.position=Lo,ho.fillColor=Co,ho.fillOpacity=qo,ho.strokeColor=Ko,ho.strokeOpacity=Qo,ho.size=Jo,ho.width=eu,ho.height=No,ho.lineWidth=Po,ho.shape=$o,ho.factor=xo,ho.groupBy=To,ho.select=Ho,ho.where=nu,ho.having=Eo,ho.eq=_o,ho.ne=zo,ho.lt=Ao,ho.gt=Oo,ho.le=Xo,ho.ge=Wo,ho.like=Mo,ho.avg=wo,ho.count=bo,ho.max=Io,ho.min=Fo,ho.sum=Zo,ho.parse=Ro,ho.point=Vo,ho.rect=Go,ho.path=Bo,ho.schema=Uo,ho.createFrame=Oi,ho.createVector=Ui,ho.createFactor=Si,null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=ho:window.plot=ho}).call(this);
